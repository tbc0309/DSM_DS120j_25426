/* Copyright (c) 2020 Synology Inc. All rights reserved. */

Ext.define("SYNO.SDS.LogCenter.FlotrPanelDevice",{extend:"Ext.Panel",initialChartType:null,chartType:null,flotr:null,constructor:function(b){var a={margins:{top:10,right:10,bottom:10,left:0},border:false,flex:2};this.initialChartType=SYNO.SDS.Utils.clone(b.chartType);Ext.apply(a,b);this.callParent([a])},initEvents:function(){this.callParent(arguments);this.mon(this,"afterlayout",function(){if(!this.collapsed&&!this.flotr){this.drawChart()}},this);this.mon(this,"expand",function(){this.drawChart()},this);if(this.store){this.mon(this.store,"datachanged",this.drawChart,this)}},genSeries:function(b){var a;for(a=0;a<this.dataSet.length;a++){b[a]={};Ext.apply(b[a],this.dataSet[a]);delete b[a].x;delete b[a].y;b[a].data=[];b[a].Label=""}if(this.store){for(a=0;a<this.store.getCount();a++){var c=this.store.getAt(a);b[a].data.push([c.get("device"),c.get("percent")]);b[a].Label=c.get("dev")}}},drawChart:function(){if(0===this.store.getCount()){return}var a=[];this.genSeries(a);this.chartType.pie.fillColor=null;this.flotr=Flotr.draw(this.body.dom,a,this.chartType)},drawEmptyChart:function(){var a=[];a[0]={};a[0].data=[];a[0].data.push(["No device",100]);a[0].Label="No device";a[0].color="grey";this.chartType.pie.fillColor="#FFFFFF";this.flotr=Flotr.draw(this.body.dom,a,this.chartType)},onResize:function(){this.callParent(arguments);this.drawChart()}});Ext.define("SYNO.SDS.LogCenter.FlotrPanel",{extend:"Ext.Panel",store:null,xAxisAltered:false,totalRecords:0,oldYMax:0,oldXMax:0,isNetPanel:false,constructor:function(b){var a={margins:{top:10,right:10,bottom:0,left:0},border:false,flex:7};this.initialChartType=SYNO.SDS.Utils.clone(b.chartType);this.oldYMax=b.chartType.yaxis.max;this.oldXMax=b.chartType.xaxis.max;Ext.apply(a,b);this.callParent([a])},initEvents:function(){this.callParent(arguments);if(this.header){this.mon(this.header,"dblclick",this.toggleCollapse,this)}this.mon(this,"afterlayout",function(){if(!this.collapsed&&!this.flotr){this.drawChart()}},this);this.mon(this,"expand",function(){this.drawChart()},this);if(this.store){this.mon(this.store,"datachanged",this.drawChart,this);this.mon(this.store,"clear",this.onClear,this)}},reload:function(d,b){var c=this;if(c.isVisible()){var a=c.getEl();a.mask(_T("common","loading"));d.apply(b||c,arguments);a.unmask()}else{d.apply(b||c,arguments)}},resetChartType:function(){var a=this;Ext.apply(a.chartType,{xaxis:a.initialChartType.xaxis});a.xAxisAltered=false;a.oldYMax=a.initialChartType.yaxis.max;a.chartType.yaxis.max=a.initialChartType.yaxis.max;a.drawChart()},onClear:function(){var a=this;a.reload(a.resetChartType)},alterXAxis:function(){var b,a;if(this.store.getCount()<=0){return false}b=this.store.getAt(this.store.getCount()-1);a=b.get(this.dataSet[0].x);if((a/60)>=this.oldXMax){this.totalRecords=(this.isNetPanel&&0<this.totalRecords)?this.totalRecords:this.store.getCount();Ext.apply(this.chartType,{xaxis:{noTicks:5,max:null,min:null,mode:"time",timeFormat:"%h:%M",tickDecimals:0,tickFormatter:function(c){return SYNO.SDS.LogCenter.FlotrTimeGet(parseInt(c,10)*1000)}},mouse:{track:true,trackAll:true,relative:false,radius:0,position:"nw",color:"purple",trackDecimals:0,trackStyle:"",trackFormatter:this.trackFormatter.createDelegate(this)},crosshair:{mode:"x",color:"#FA4444",hideCursor:false},grid:{color:"#B4BEC8",backgroundColor:"#F5F5F5",tickColor:"#E4E6E9",outlineWidth:1,verticalLines:false},legend:{backgroundColor:null,backgroundOpacity:0.75,show:false}});this.xAxisAltered=true}},getRoundUp:function(d){var c=1;for(var b=1;b<32;++b){var a;c*=10;a=d/c;if(a<10){a=Math.round(a);if(a%2){++a}else{a+=2}return a*c}}return d},alterYAxis:function(a){if(this.store.getCount()>0){if(a>this.oldYMax){this.chartType.yaxis.max=this.getRoundUp(a)}else{this.chartType.yaxis.max=this.oldYMax}}},genSeries:function(h){var d,b,g=null;var f=0;var c=[];for(b=0;b<this.dataSet.length;b++){c[b]={};Ext.apply(c[b],this.dataSet[b]);delete c[b].x;delete c[b].y;c[b].data=[]}var e=(this.xAxisAltered)?this.totalRecords:this.store.getCount();if(this.store){for(d=this.store.getCount()-e;d<this.store.getCount();d++){g=this.store.getAt(d);for(b=0;b<this.dataSet.length;b++){c[b].data.push([g.get(this.dataSet[b].x),g.get(this.dataSet[b].y)]);c[b].label=g.get(this.dataSet[b].dev)}}}for(d=0;d<c.length;d++){if(!c[d].show){continue}h.push(c[d]);for(b=0;b<c[d].data.length;b++){var a=c[d].data[b][1];f=(a>f)?a:f}}return f},drawChart:function(){if(this.collapsed||this.isDestroyed){return true}if(!this.body||this.body.getSize(true).width<=1||this.body.getSize(true).height<=1){return}if(false===this.xAxisAltered){this.alterXAxis()}var a=[];var b=this.genSeries(a);this.alterYAxis(b);this.flotr=LogCenterFlotr.draw(this.body.dom,a,this.chartType)},onResize:function(){this.callParent(arguments);this.drawChart()},trackFormatter:function(e){var d;var c=e.nearest.allSeries;var a=e.index;var b=0;d='<div class="info-list info-list-l"><div class="info-list-r"><div class="info-list-m">';d+='<div class="info-list-time">';d+='<div class="time-text">'+SYNO.SDS.LogCenter.FlotrTimeGet(parseInt(e.x,10))+"</div>";d+="<div>";d+='<hr style="margin:0px;height:1px;border:0px;background-color:#D5D5D5;color:#E6E6E7;"/>';d+='<table class= "info-list-table"><tbody>';for(b=0;b<c.size();b++){d+='<tr class= "info-list-raw" style="color:'+c[b].color+'">';d+='<td class="info-list-name">';d+=c[b].label+" ";d+="</td>";d+='<td class="info-list-value">';d+=c[b].data[a][1];d+="</td>"}d+="</tbody></table>";d+="</div></div></div>";return d}});Ext.define("SYNO.SDS.LogCenter.LogView",{extend:"Ext.Panel",constructor:function(a){var b;a.owner=a.appWin;this.FLOTR_EPS=72;this.FLOTR_DEV=28;this.PANEL_LOG=36+19*4;this.PANEL_STATICS_HEIGHT=300+3;this.PANEL_STATICS_WIDTH=740;this.PANEL_EPS_HEIGHT=240;this.PANEL_EPS_WIDTH=520;this.PANEL_DEV_WIDTH=200;this.PANEL_EPSDEVSEL_HEIGHT=30;this.TOTAL="#959595";this.DEV_1="#3799FA";this.DEV_2="#80D24C";this.DEV_3="#FCBD00";this.OTHERS="#959595";this.fsNumberShow=true;this.EpsScale=SYNO.SDS.LogCenter.SCALE_6MIN;this.LogScaleDesc=null;this.IntDev=[];this.SrcDevDesc=[];this.SrcDevPer=[];this.SrcDevCombo=[];this.LastEpsResult=[];this.LastEpsTime=0;Ext.apply(this,a);b=this.fillConfig(a);this.callParent([b])},initEvents:function(){this.mon(this,"afterlayout",function(a,b){Ext.get("overlay_btn_pause").addListener("click",function(c,d){this.onClickPause()},this);Ext.get("overlay_plus").addListener("click",function(c,d){this.onClickPlus()},this);Ext.get("overlay_minus").addListener("click",function(c,d){this.onClickMinus()},this);Ext.getCmp(this.SrcDevCombo[0]).addListener("select",function(c,d){this.onSelectDevice(0)},this);Ext.getCmp(this.SrcDevCombo[1]).addListener("select",function(c,d){this.onSelectDevice(1)},this);Ext.getCmp(this.SrcDevCombo[2]).addListener("select",function(c,d){this.onSelectDevice(2)},this);Ext.getCmp(this.SrcDevCombo[0]).addListener("beforequery",function(c,d){Ext.getCmp(this.SrcDevCombo[0]).getStore().baseParams.dev_1=Ext.getCmp(this.SrcDevCombo[0]).getValue();Ext.getCmp(this.SrcDevCombo[0]).getStore().baseParams.dev_2=Ext.getCmp(this.SrcDevCombo[1]).getValue();Ext.getCmp(this.SrcDevCombo[0]).getStore().baseParams.dev_3=Ext.getCmp(this.SrcDevCombo[2]).getValue()},this);Ext.getCmp(this.SrcDevCombo[1]).addListener("beforequery",function(c,d){Ext.getCmp(this.SrcDevCombo[1]).getStore().baseParams.dev_1=Ext.getCmp(this.SrcDevCombo[0]).getValue();Ext.getCmp(this.SrcDevCombo[1]).getStore().baseParams.dev_2=Ext.getCmp(this.SrcDevCombo[1]).getValue();Ext.getCmp(this.SrcDevCombo[1]).getStore().baseParams.dev_3=Ext.getCmp(this.SrcDevCombo[2]).getValue()},this);Ext.getCmp(this.SrcDevCombo[2]).addListener("beforequery",function(c,d){Ext.getCmp(this.SrcDevCombo[2]).getStore().baseParams.dev_1=Ext.getCmp(this.SrcDevCombo[0]).getValue();Ext.getCmp(this.SrcDevCombo[2]).getStore().baseParams.dev_2=Ext.getCmp(this.SrcDevCombo[1]).getValue();Ext.getCmp(this.SrcDevCombo[2]).getStore().baseParams.dev_3=Ext.getCmp(this.SrcDevCombo[2]).getValue()},this);this.fsNumber.addListener("collapse",function(c,d){this.fsNumberShow=false;this.PanelLog.setHeight(this.appWin.getInnerHeight()-100);this.PanelLog.doLayout()},this);this.fsNumber.addListener("expand",function(c,d){this.fsNumberShow=true;this.PanelLog.setHeight(this.appWin.getInnerHeight()-this.PANEL_STATICS_HEIGHT-107);this.PanelLog.doLayout()},this);this.appWin.addListener("resize",function(d,f,c){var e=this.appWin.getInnerHeight()-this.PANEL_STATICS_HEIGHT-107;if(!this.fsNumberShow){e=this.appWin.getInnerHeight()-100}this.PanelLog.setHeight(e);this.PanelLog.doLayout()},this)},this,{single:true})},createEpsPanel:function(){this.EpsStore=new Ext.data.SimpleStore({autoDestroy:true,fields:["value","display"],data:[],pruneModifiedRecords:true});this.dataSet=[{x:"time",y:"eps",dev:"dev",color:this.TOTAL,show:true},{x:"time",y:"dev1",dev:"dev1_name",color:this.DEV_1,show:false},{x:"time",y:"dev2",dev:"dev2_name",color:this.DEV_2,show:false},{x:"time",y:"dev3",dev:"dev3_name",color:this.DEV_3,show:false}];return new SYNO.SDS.LogCenter.FlotrPanel({collapsible:false,store:this.EpsStore,width:500,height:240,hideMode:"offsets",totalRecords:0,itemId:"eps_flotr",dataSet:this.dataSet,chartType:{lines:{show:true},xaxis:{noTicks:5,max:null,min:null,tickDecimals:0},yaxis:{noTicks:5,max:10,min:0,tickDecimals:0,autoscaleMargin:1},grid:{color:"#B4BEC8",backgroundColor:"#F5F5F5",tickColor:"#E4E6E9",outlineWidth:1,verticalLines:false},legend:{backgroundColor:null,backgroundOpacity:0.75},shadowSize:0}})},createDevicePanel:function(){this.DevStore=new Ext.data.SimpleStore({autoDestroy:true,fields:["value","display"],data:[],pruneModifiedRecords:true});this.DevicePanel=new SYNO.SDS.LogCenter.FlotrPanelDevice({collapsible:false,store:this.DevStore,height:120,hideMode:"offsets",border:false,totalRecords:0,itemId:"device_flotr",dataSet:[{x:"device",y:"percent",dev:"dev",color:this.DEV_1},{x:"device",y:"percent",dev:"dev",color:this.DEV_2},{x:"device",y:"percent",dev:"dev",color:this.DEV_3},{x:"device",y:"percent",dev:"dev",color:this.OTHERS}],chartType:{grid:{verticalLines:false,horizontalLines:false,outlineWidth:0,labelMargin:0,label:{show:true}},xaxis:{showLabels:false},yaxis:{showLabels:false},pie:{show:true,lineWidth:0,explode:0,sizeRatio:0.834,fill:true,fillOpacity:0.6,startAngle:0.5,labelFormatter:function(a){return""}},shadowSize:0,legend:{show:false},colors:["#fadb63","#7895d2"]}});this.SrcDevDesc[0]=Ext.id();this.SrcDevDesc[1]=Ext.id();this.SrcDevDesc[2]=Ext.id();this.SrcDevDesc[3]=Ext.id();this.SrcDevPer[0]=Ext.id();this.SrcDevPer[1]=Ext.id();this.SrcDevPer[2]=Ext.id();this.SrcDevPer[3]=Ext.id();return new Ext.Panel({border:true,height:this.PANEL_EPS_HEIGHT-20-3,cls:"syno-syslog-white-bg",items:[this.DevicePanel,this.createSourceDesc(this.SrcDevDesc[0],this.SrcDevPer[0],"syno-syslog-blue-desc","syno-syslog-blue-box"),this.createSourceDesc(this.SrcDevDesc[1],this.SrcDevPer[1],"syno-syslog-green-desc","syno-syslog-green-box"),this.createSourceDesc(this.SrcDevDesc[2],this.SrcDevPer[2],"syno-syslog-yellow-desc","syno-syslog-yellow-box"),this.createSourceDesc(this.SrcDevDesc[3],this.SrcDevPer[3],"syno-syslog-grey-desc","syno-syslog-grey-box")]})},createSourceDesc:function(d,c,a,b){return new Ext.Panel({border:false,layout:"hbox",padding:"0px 18px 0px 18px",items:[{xtype:"displayfield",cls:b},{id:d,xtype:"displayfield",labelAlign:"right",value:"",height:22,flex:7,cls:a},{id:c,xtype:"displayfield",value:"",height:22,flex:3,cls:a}]})},storeIntDevGet:function(){return new SYNO.API.Store({proxy:new SYNO.API.Proxy({api:"SYNO.Core.SyslogClient.Status",method:"device_enum",version:1}),reader:new Ext.data.JsonReader({root:"items",totalProperty:"total",id:"value"},[{name:"value",mapping:"value"},{name:"display",mapping:"display"}]),baseParams:{action:"dev_enum",dev_1:"",dev_2:"",dev_3:""}})},createOverlayIconPause:function(){return new Ext.Container({border:false,id:"overlay_btn_pause",cls:"syno-syslog-polling-pause"})},createOverlayIconPlus:function(){return new Ext.Container({border:false,id:"overlay_plus",cls:"syno-syslog-scale-plus"})},createOverlayIconMinus:function(){return new Ext.Container({border:false,id:"overlay_minus",cls:"syno-syslog-scale-minus"})},createEpsCtrlPanel:function(){this.OverlayIconPause=this.createOverlayIconPause();this.OverlayIconPlus=this.createOverlayIconPlus();this.OverlayIconMinus=this.createOverlayIconMinus();return new Ext.Panel({border:false,height:this.PANEL_EPS_HEIGHT,flex:7,items:[this.createEpsPanel(),this.OverlayIconPause,this.OverlayIconPlus,this.OverlayIconMinus]})},createDev:function(b,a){return new Ext.Panel({border:false,items:[{xtype:"syno_combobox",width:146,mode:"remote",id:b,value:"None",editable:false,store:this.storeIntDevGet(),forceSelection:true,allowBlank:false,displayField:"display",valueField:"value",typeAhead:true,triggerAction:"all",lazyRender:true,listeners:{beforequery:function(c){delete c.combo.lastQuery}}}]})},createEpsDevSel:function(){this.SrcDevCombo[0]=Ext.id();this.SrcDevCombo[1]=Ext.id();this.SrcDevCombo[2]=Ext.id();return new Ext.Panel({layout:"hbox",height:this.PANEL_EPSDEVSEL_HEIGHT,border:false,items:[{xtype:"displayfield",width:20},this.createDev(this.SrcDevCombo[0],"syno-syslog-blue-box"),{xtype:"displayfield",width:19},this.createDev(this.SrcDevCombo[1],"syno-syslog-green-box"),{xtype:"displayfield",width:19},this.createDev(this.SrcDevCombo[2],"syno-syslog-yellow-box")]})},createPanelEps:function(){return new Ext.Panel({width:this.PANEL_EPS_WIDTH,height:this.PANEL_STATICS_HEIGHT,border:false,items:[{xtype:"displayfield",id:this.LogScaleDesc=Ext.id(),itemId:"log_scale",cls:"syno-syslog-overview-title",value:_TT("SYNO.SDS.LogCenter.Instance","logview","utilization")+" ("+_TT("SYNO.SDS.LogCenter.Instance","logstatus","interval_6_mins")+")"},this.createEpsCtrlPanel(),{xtype:"displayfield",value:"",height:11},this.createEpsDevSel()]})},createPanelDev:function(){this.PanelDevice=new Ext.Panel({width:this.PANEL_DEV_WIDTH,height:this.PANEL_STATICS_HEIGHT,border:false,cls:"piechart-top-space",items:[this.createDevicePanel()]});return this.PanelDevice},createPanelStatistic:function(){return new Ext.Panel({layout:"hbox",width:this.PANEL_STATICS_WIDTH,height:this.PANEL_STATICS_HEIGHT,border:false,items:[this.createPanelEps(),this.createPanelDev()]})},fillConfig:function(a){this.PanelLog=new SYNO.SDS.LogCenter.LogPanel();this.fsNumber=new SYNO.ux.FieldSet({name:"fs_number",title:_TT("SYNO.SDS.LogCenter.Instance","logstatus","eps_statistic"),collapsible:true,items:[this.createPanelStatistic()]});this.fsLog=new SYNO.ux.FieldSet({title:String.format(_TT("SYNO.SDS.LogCenter.Instance","logstatus","latest_log"),50),name:"fs_latest",collapsible:true,cls:"overview-log",items:[this.PanelLog]});var b={labelAlign:"left",border:false,trackResetOnLoad:true,items:[this.fsNumber,this.fsLog]};Ext.apply(b,a);return b},updateEpsFlotr:function(b){var a;if(!b){return}this.EpsStore.removeAll();for(a=0;a<b.length;a++){this.EpsStore.add(new Ext.data.Record(Ext.applyIf({time:parseInt(b[a].time_stamp,10)*1000,eps:parseInt(b[a].log_count,10),dev1:parseInt(b[a].dev_1,10),dev2:parseInt(b[a].dev_2,10),dev3:parseInt(b[a].dev_3,10),dev:"Total",dev1_name:Ext.getCmp(this.SrcDevCombo[0]).getValue(),dev2_name:Ext.getCmp(this.SrcDevCombo[1]).getValue(),dev3_name:Ext.getCmp(this.SrcDevCombo[2]).getValue()})))}this.EpsStore.fireEvent("datachanged")},updateEmptyDevice:function(){this.DevicePanel.drawEmptyChart();Ext.getCmp(this.SrcDevDesc[0]).setValue("None");Ext.getCmp(this.SrcDevDesc[1]).setValue("None");Ext.getCmp(this.SrcDevDesc[2]).setValue("None");Ext.getCmp(this.SrcDevDesc[3]).setValue("None");Ext.getCmp(this.SrcDevPer[0]).setValue(" ");Ext.getCmp(this.SrcDevPer[1]).setValue(" ");Ext.getCmp(this.SrcDevPer[2]).setValue(" ");Ext.getCmp(this.SrcDevPer[3]).setValue(" ")},showMultiDeviceInfo:function(a){if(a){this.PanelDevice.show();this.DevicePanel.show();Ext.getCmp(this.SrcDevCombo[0]).show();Ext.getCmp(this.SrcDevCombo[1]).show();Ext.getCmp(this.SrcDevCombo[2]).show()}else{this.PanelDevice.hide();this.DevicePanel.hide();Ext.getCmp(this.SrcDevCombo[0]).hide();Ext.getCmp(this.SrcDevCombo[1]).hide();Ext.getCmp(this.SrcDevCombo[2]).hide()}this.dataSet[1].show=a;this.dataSet[2].show=a;this.dataSet[3].show=a},updateDeviceFlotr:function(c){var b,a=0;if(!c){this.updateEmptyDevice();return}for(b=0;b<c.length;b++){a+=parseInt(c[b].log_count,10)}this.DevStore.removeAll();for(b=0;b<c.length;b++){this.DevStore.add(new Ext.data.Record(Ext.applyIf({device:c[b].log_device,percent:parseInt(c[b].log_count,10)/a,dev:c[b].log_device})))}for(b=c.length;b<SYNO.SDS.LogCenter.DEV_MAX+1;b++){this.DevStore.add(new Ext.data.Record(Ext.applyIf({device:0,percent:0,dev:""})))}this.DevStore.fireEvent("datachanged")},updateDevInfo:function(a){var h=0,d=0;var j=[],g=[],c=[];if(!a){return}j[0]=Ext.getCmp(this.SrcDevCombo[0]);j[1]=Ext.getCmp(this.SrcDevCombo[1]);j[2]=Ext.getCmp(this.SrcDevCombo[2]);g[0]=Ext.getCmp(this.SrcDevDesc[0]);g[1]=Ext.getCmp(this.SrcDevDesc[1]);g[2]=Ext.getCmp(this.SrcDevDesc[2]);g[3]=Ext.getCmp(this.SrcDevDesc[3]);c[0]=Ext.getCmp(this.SrcDevPer[0]);c[1]=Ext.getCmp(this.SrcDevPer[1]);c[2]=Ext.getCmp(this.SrcDevPer[2]);c[3]=Ext.getCmp(this.SrcDevPer[3]);for(d=0;d<a.length;d++){h+=parseInt(a[d].log_count,10)}for(d=0;d<a.length;d++){var k,b,f,e,l;if(""===a[d].log_device||"_NONE_"===a[d].log_device){j[d].setValue("None");g[d].setValue("None: ");c[d].setValue("0%");continue}if(d<SYNO.SDS.LogCenter.DEV_MAX){j[d].setValue(a[d].log_device);this.IntDev[d]=a[d].log_device}k=parseInt(a[d].log_count,10)/h;b=Math.round(k*100);f=Ext.util.Format.ellipsis(a[d].log_device,11);e=f+": ";l=a[d].log_device;g[d].setValue(e);g[d].el.dom.qtip=l;c[d].setValue(b+"%")}},updateRecentLogs:function(a){if(!a){this.PanelLog.dataUpdate([]);return}this.PanelLog.dataUpdate(a)},updateScalingCtrl:function(){var a=_TT("SYNO.SDS.LogCenter.Instance","logview","utilization")+" ("+SYNO.SDS.LogCenter.ScaleMapping[this.EpsScale]+")";Ext.getCmp(this.LogScaleDesc).setValue(a);if(this.EpsScale===SYNO.SDS.LogCenter.SCALE_6MIN){Ext.getCmp("overlay_plus").disable()}else{Ext.getCmp("overlay_plus").enable()}if(this.EpsScale===SYNO.SDS.LogCenter.SCALE_1DAY){Ext.getCmp("overlay_minus").disable()}else{Ext.getCmp("overlay_minus").enable()}},updateStore:function(a,c){if(this.fsNumberShow){var b=this.server_enable;this.showMultiDeviceInfo(b);if(b){this.updateDeviceFlotr(c.device);this.updateDevInfo(c.device)}this.updateEpsFlotr(c.eps);this.updateScalingCtrl()}this.updateRecentLogs(c.logs)},onAjaxRequestDone:function(h,e,g,b){if(this.isDestroyed){return}if(h){var f={};var a=[],c=[],d=[];Ext.each(e.result,function(j){if(j.hasOwnProperty("data")){if("latestlog_get"===j.method){f.logs=[];if(j.data.hasOwnProperty("logs")){f.logs=j.data.logs}}else{if("eps_get"===j.method){f.eps=[];if(j.data.hasOwnProperty("eps")){f.eps=j.data.eps}}else{if("cnt_get"===j.method){f.device=[];if(j.data.hasOwnProperty("device")){f.device=j.data.device}}}}}});this.latestResp=f;c=this.LastEpsResult;if(f.eps){d=f.eps}c.splice(0,d.length);a=c.concat(d);f.eps=a;this.updateStore(1,f);this.LastEpsResult=a;if(0!==a.length){this.setLastEpsTime(a[a.length-1].time_stamp)}}},startPollingTask:function(){var b={api:"SYNO.Core.SyslogClient.Status",method:"latestlog_get",version:"1"};var a={api:"SYNO.Core.SyslogClient.Status",method:"eps_get",version:"1",params:{dev_1:this.IntDev[0],dev_2:this.IntDev[1],dev_3:this.IntDev[2],scale:this.EpsScale,date_from:this.getLastEpsTime()}};var c={api:"SYNO.Core.SyslogClient.Status",method:"cnt_get",version:"1",params:{dev_1:this.IntDev[0],dev_2:this.IntDev[1],dev_3:this.IntDev[2]}};this.task=this.addWebAPITask({id:"task_get_syslog_status",interval:3000,webapi:{compound:{stopwhenerror:false,params:[b,a,c]}},callback:this.onAjaxRequestDone,scope:this});this.task.start()},stopPollingTask:function(){this.task.stop();this.removeTask("task_get_syslog_status")},getLastEpsTime:function(){return this.LastEpsTime},setLastEpsTime:function(a){this.LastEpsTime=a},resumePollingTask:function(){if(this.PauseStatus){this.changeStatusPlay()}else{this.startPollingTask()}},reloadAllLogs:function(){this.setLastEpsTime(0)},onSelectDevice:function(a){this.stopPollingTask();var c=this.SrcDevCombo[a];var b=Ext.getCmp(c).getValue();this.IntDev[a]=b;this.reloadAllLogs();this.resumePollingTask()},onChangeScale:function(a){if((this.EpsScale===SYNO.SDS.LogCenter.SCALE_6MIN&&a)||(this.EpsScale===SYNO.SDS.LogCenter.SCALE_1DAY&&!a)){return}this.stopPollingTask();if(a){this.EpsScale--}else{this.EpsScale++}this.reloadAllLogs();this.resumePollingTask()},changeStatusPlay:function(){Ext.getCmp("overlay_btn_pause").removeClass("syno-syslog-polling-play");Ext.getCmp("overlay_btn_pause").addClass("syno-syslog-polling-pause");this.startPollingTask();this.PauseStatus=false},changeStatusPause:function(){Ext.getCmp("overlay_btn_pause").removeClass("syno-syslog-polling-pause");Ext.getCmp("overlay_btn_pause").addClass("syno-syslog-polling-play");this.stopPollingTask();this.PauseStatus=true},onClickPause:function(){if(this.PauseStatus){this.changeStatusPlay()}else{this.changeStatusPause()}},onClickPlus:function(){this.onChangeScale(true)},onClickMinus:function(){this.onChangeScale(false)},onPageActivate:function(){if(SYNO.SDS.Config.FnMap.hasOwnProperty("SYNO.SDS.LogCenter.ExtReceiveLog")){this.appWin.sendWebAPI({api:"SYNO.LogCenter.RecvRule",method:"list",version:1,callback:function(e,c,d,b){if(e){this.server_enable=(c.total>0)?true:false;this.showMultiDeviceInfo(this.server_enable)}},scope:this})}this.EpsScale=SYNO.SDS.LogCenter.SCALE_6MIN;this.resumePollingTask();this.doLayout();var a=this.appWin.getInnerHeight()-this.PANEL_STATICS_HEIGHT-107;if(!this.fsNumberShow){a=this.appWin.getInnerHeight()-100}this.PanelLog.setHeight(a);this.PanelLog.doLayout()},onPageDeactivate:function(){this.stopPollingTask();this.reloadAllLogs()}});Ext.define("SYNO.SDS.LogCenter.LogPanel",{extend:"SYNO.ux.GridPanel",constructor:function(b){var d=[{dataIndex:"ldate",header:_TT("SYNO.SDS.LogCenter.Instance","logattr","attr_date"),width:90,align:"left",renderer:function(f){return SYNO.SDS.DateTimeFormatter(Date.parseDate(f,"Y-m-d"),{type:"date"})}},{dataIndex:"ltime",header:_TT("SYNO.SDS.LogCenter.Instance","logattr","attr_time"),width:90,align:"left",renderer:function(f){return SYNO.SDS.DateTimeFormatter(Date.parseDate(f,"H:i:s"),{type:"timesec"})}},{dataIndex:"prio",header:_TT("SYNO.SDS.LogCenter.Instance","logattr","attr_priority"),width:90,align:"left",renderer:SYNO.SDS.LogCenter.LevelRenderer},{dataIndex:"host",header:_TT("SYNO.SDS.LogCenter.Instance","logattr","attr_host"),width:100,align:"left"},{dataIndex:"fac",header:_TT("SYNO.SDS.LogCenter.Instance","logattr","attr_facility"),width:90,align:"left"},{dataIndex:"prog",header:_TT("SYNO.SDS.LogCenter.Instance","logattr","attr_program"),width:100,align:"left"},{dataIndex:"msg",name:"msg",id:"msg",header:_TT("SYNO.SDS.LogCenter.Instance","logattr","attr_msg"),width:100,align:"left",hideable:false,menuDisabled:true,renderer:SYNO.SDS.LogCenter.LogRenderer}];var a=new Ext.grid.ColumnModel({defaults:{sortable:false,menuDisabled:false},columns:d});var e=this.logDSInitJson();var c={height:148,viewConfig:{forceFit:false,trackResetOnLoad:false,templates:{cell:new Ext.XTemplate('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} x-selectable {css}" style="{style}" tabIndex="0" {cellAttr}>','<div class="{this.selectableCls} x-grid3-cell-inner x-grid3-col-{id}" {attr}>{value}</div>',"</td>",{selectableCls:SYNO.SDS.Utils.SelectableCLS})}},title:null,ds:e,cm:a,loadMask:true,autoExpandMin:50,autoExpandColumn:"msg",monitorWindowResize:true,enableColumnMove:false,enableDragDrop:false,enableColLock:false,stripeRows:true};this.dsLog=e;this.callParent([c])},logDSInitJson:function(){var b=["id","host","ip","fac","prio","llevel","utcsec","tzoffset","ldate","ltime","prog","msg"];var a=new Ext.data.JsonStore({autoDestroy:true,root:"data",fields:b});return a},dataUpdate:function(a){this.dsLog.loadData({data:a},false)}});Ext.define("SYNO.SDS.LogCenter.GeneralLogBuilder",{extend:"Object",create:function(e){var d=[["system",_T("log","log_link_system")],["netbackup",_T("log","log_link_netbkp")]],h=_T("log","general"),g="general",c="general";var b=this.getStore(e.appInst),f=this.getColumnModel(),a={logType:d,title:h,itemId:g,fileTitle:c,ds:b,cm:f};Ext.applyIf(e,a);return new SYNO.SDS.LogCenter.BaseLog(e)},getStore:function(a){var b=new SYNO.API.Store({appWindow:a,proxy:new SYNO.API.Proxy({api:"SYNO.Core.SyslogClient.Log",method:"list",version:1}),reader:new Ext.data.JsonReader({root:"items",totalProperty:"total"},["logtype","level","time","who","descr"]),remoteSort:false,sortInfo:{field:"time",direction:"DESC"},autoDestroy:true});return b},getColumnModel:function(){var b=SYNO.SDS.LogCenter.LevelRenderer,c=SYNO.SDS.LogCenter.Utils.datetimeRenderer,d=SYNO.SDS.LogCenter.Utils.htmlEncodeRender;var a=new Ext.grid.ColumnModel({columns:[{header:_TT("SYNO.SDS.LogCenter.Instance","logattr","attr_priority"),menuText:_T("log","logattr"),dataIndex:"level",width:90,align:"center",renderer:b},{header:_T("tree","leaf_log"),dataIndex:"logtype",width:90,align:"center",renderer:d},{header:_T("log","log_time"),dataIndex:"time",width:160,align:"center",renderer:c},{header:_T("log","log_account"),dataIndex:"who",width:120,align:"center",renderer:d},{id:"descr",header:_T("log","log_action"),dataIndex:"descr",css:"white-space:normal;",width:300,hideable:false,menuDisabled:true,renderer:d}],defaults:{sortable:false,menuDisabled:false}});return a}});Ext.define("SYNO.SDS.LogCenter.ConnectionLogBuilder",{extend:"Object",create:function(e){var d=[["connection",_T("log","log_link_connection")]],h=_T("log","log_link_connection"),g="connection",c="log_link_connection";var b=this.getStore(e.appInst),f=this.getColumnModel(),a={logType:d,title:h,itemId:g,fileTitle:c,ds:b,cm:f};Ext.applyIf(e,a);return new SYNO.SDS.LogCenter.BaseLog(e)},getStore:function(a){var b=new SYNO.API.Store({appWindow:a,proxy:new SYNO.API.Proxy({api:"SYNO.Core.SyslogClient.Log",method:"list",version:1}),reader:new Ext.data.JsonReader({root:"items",totalProperty:"total"},["logtype","level","time","who","descr"]),remoteSort:false,sortInfo:{field:"time",direction:"DESC"},autoDestroy:true});return b},getColumnModel:function getLogCM(){var b=SYNO.SDS.LogCenter.LevelRenderer,c=SYNO.SDS.LogCenter.Utils.datetimeRenderer,d=SYNO.SDS.LogCenter.Utils.htmlEncodeRender;var a=new Ext.grid.ColumnModel({columns:[{menuText:_T("log","logattr"),header:_TT("SYNO.SDS.LogCenter.Instance","logattr","attr_priority"),dataIndex:"level",width:90,align:"center",renderer:b},{header:_T("tree","leaf_log"),dataIndex:"logtype",width:90,align:"center",renderer:d},{header:_T("log","log_time"),dataIndex:"time",width:160,align:"center",renderer:c},{header:_T("log","log_account"),dataIndex:"who",width:120,align:"center",renderer:d},{id:"descr",header:_T("log","log_action"),dataIndex:"descr",css:"white-space:normal;",width:300,hideable:false,menuDisabled:true,renderer:d}],defaults:{sortable:false,menuDisabled:false}});return a}});Ext.define("SYNO.SDS.LogCenter.BaseLogUI",{extend:"Ext.Panel",itemsPerPage:1000,logType:[["syslog",_T("log","log_link_system")]],title:_T("tree","leaf_log"),itemId:"logPanel",appInst:undefined,baseURL:undefined,topwin:undefined,store:undefined,columnModel:undefined,constructor:function(a){Ext.copyTo(this,a,["listeners","baseURL","topwin","appInst","logType","title","itemId","jsConfig"]);this.store=a.ds;this.columnModel=a.cm;this.itemsPerPage=a.appInst.appInstance.getUserSettings(this.itemId+"-dsPageLimit")||this.itemsPerPage;Ext.apply(a,this);this.callParent([a])},getPageRecordStore:function(){var a=new Ext.data.SimpleStore({fields:["value","display"],data:[[100,100],[500,500],[1000,1000],[3000,3000]]});return a},initPageComboBox:function(a){var b=new SYNO.ux.ComboBox({name:"page_rec",hiddenName:"page_rec",hiddenId:Ext.id(),store:a,displayField:"display",valueField:"value",triggerAction:"all",value:this.itemsPerPage,editable:false,width:70,mode:"local",listeners:{select:{fn:this.onChangeDisplayRecord,scope:this}}});return b},initPagingToolbar:function(){var a=new SYNO.ux.PagingToolbar({store:this.store,displayInfo:true,pageSize:this.itemsPerPage,showRefreshBtn:true,items:["-",_T("common","items_perpage"),this.initPageComboBox(this.getPageRecordStore()),"-",{xtype:"tbtext",text:"",itemId:"infoLevel"},"-",{xtype:"tbtext",text:"",itemId:"warnLevel"},"-",{xtype:"tbtext",text:"",itemId:"errorLevel"},"-"]});return a},initSearchForm:function(){var a=new SYNO.SDS.LogCenter.SearchFormPanel({cls:"syno-sds-fs-search-panel",renderTo:Ext.getBody(),shadow:false,jsConfig:this.jsConfig,hidden:true,owner:this,logType:this.logType});a.hideItems(["logType","logTypeLabel"]);return a},initComponent:function(){this.searchPanel=this.initSearchForm();this.paging=this.initPagingToolbar();this.grid=new SYNO.ux.GridPanel({view:new SYNO.ux.FleXcroll.grid.BufferView({rowHeight:27,scrollDelay:30,borderHeight:1,forceFit:false,templates:{cell:new Ext.XTemplate('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} x-selectable {css}" style="{style}" tabIndex="0" {cellAttr}>','<div class="{this.selectableCls} x-grid3-cell-inner x-grid3-col-{id}" {attr}>{value}</div>',"</td>",{selectableCls:SYNO.SDS.Utils.SelectableCLS})}}),region:"center",plugins:"menutextcolumnmodelplugin",store:this.store,colModel:this.columnModel,bbar:this.paging,loadMask:true,autoExpandColumn:"descr",cls:"syno-syslog-remove-sort-icon",stripeRows:true});Ext.apply(this,{itemId:this.itemId,border:false,header:false,layout:"border",items:[this.grid]});this.callParent([this])},getInfoCompoent:function(){return this.paging.getComponent("infoLevel")},getWarnCompoent:function(){return this.paging.getComponent("warnLevel")},getErrorCompoent:function(){return this.paging.getComponent("errorLevel")}});Ext.define("SYNO.SDS.LogCenter.BaseLog",{extend:"SYNO.SDS.LogCenter.BaseLogUI",searchBuffer:200,constructor:function(a){this.callParent([a]);this.searchBuffer=a.searchBuffer||this.searchBuffer;this.lastColumeWidth=[]},initEvents:function(){this.mon(this.searchPanel,"search",this.onSearch,this,{buffer:this.searchBuffer});this.mon(this,"activate",this.onActive,this);this.mon(this.grid.getStore(),"load",this.onAfterStoreLoad,this);this.mon(this.grid.getStore(),"beforeload",this.onBeforeStoreLoad,this);this.mon(this.grid.getStore(),"loadexception",this.onLoadException,this)},onChangeDisplayRecord:function(c,d,b){var a=this.grid.getStore();if(this.itemsPerPage!==c.getValue()){this.itemsPerPage=c.getValue();this.paging.pageSize=this.itemsPerPage;a.load({params:{start:0,limit:this.itemsPerPage}});this.appInst.appInstance.setUserSettings(this.itemId+"-dsPageLimit",this.itemsPerPage)}},getLogTypes:function(a){var b=[];this.logType.each(function(c){b.push(c[0])});return b.join(a||",")},isTheSame:function(b,a){for(var c in a){if(a[c]!==b[c]){return false}}return true},onSearch:function(b,c){var a=this.grid.getStore();if(!this.isTheSame(a.baseParams,c)){Ext.apply(a.baseParams,c);this.loadData()}},onActive:function(){var a=this.grid.getStore(),b={target:"LOCAL",logtype:this.getLogTypes(),date_from:0,date_to:0,keyword:"",level:""};Ext.applyIf(a.baseParams,b);if(this.requestLogType){Ext.apply(a.baseParams,{logtype:this.requestLogType})}this.loadData();delete this.requestLogType},loadData:function(){var a=this.grid.getStore(),b={start:0,limit:this.itemsPerPage};a.load({params:b})},onLoadException:function(a,c,e,b){if(!e.items){var d=SYNO.API.getErrorString(e.code);if(5008==e.code){d=_T("log","no_active_log")}this.grid.getGridEl().mask(d)}},saveColumnWidth:function(){this.lastColumeWidth.clear();for(var a=0;a<this.columnModel.columns.length;a++){this.lastColumeWidth.push(this.columnModel.getColumnWidth(a))}},restoreColumnWidth:function(){for(var a=0;a<this.lastColumeWidth.length;a++){this.columnModel.setColumnWidth(a,this.lastColumeWidth[a],false)}},onBeforeStoreLoad:function(a,b){this.saveColumnWidth();this.grid.getGridEl().unmask()},onAfterStoreLoad:function(a,e,c){this.restoreColumnWidth();var d,b;if(e.length<1){if(c.params.target=="LOCAL"){this.grid.getGridEl().mask(_T("log","no_log_available"))}else{this.grid.getGridEl().mask(_T("log","no_ietf_log_available"))}this.topwin.enableExportButton(false);this.topwin.enableClearButton(false)}else{this.grid.getGridEl().unmask();this.topwin.enableExportButton(true);this.topwin.enableClearButton(true)}d=a.reader.jsonData;b='<div class="{0}" ext:qtip="{1}">{2}</div>';this.setLogLevelText(this.getInfoCompoent(),b,"syno-log-info",_T("log","info_level"),d.infoCount);this.setLogLevelText(this.getWarnCompoent(),b,"syno-log-warn",_T("log","warn_level"),d.warnCount);this.setLogLevelText(this.getErrorCompoent(),b,"syno-log-err",_T("log","error_level"),d.errorCount);this.setPagingToolbar(a,this.grid,this.paging)},setPagingToolbar:function(a,b,c){this.setPagingToolbarVisible(c,a.getTotalCount()>this.itemsPerPage)},setPagingToolbarVisible:function(b,c){var a=0;for(a=0;a<13;a++){if(a===9||a===10||a===11){continue}b.items.items[a].setVisible(c)}b.setButtonsVisible(true)},setLogLevelText:function(b,a,c,e,d){if(b){d=d||"0";b.setText(String.format(a,c,e,d))}},onExportCSV:function(){this.onLogSave("csv")},onExportHtml:function(){this.onLogSave("html")},onLogSave:function(a){if(_S("demo_mode")){this.appInst.getMsgBox().alert(this.appInst.title,_JSLIBSTR("uicommon","error_demo"));return}this.saveLog(a)},saveLog:function(b){var a=this.grid.getStore();this.appInst.downloadWebAPI({webapi:{api:"SYNO.Core.SyslogClient.Log",version:1,method:"export",params:{target:a.baseParams.target,logtype:a.baseParams.logtype,level:a.baseParams.level,sort:a.sortInfo.field,dir:a.sortInfo.direction,date_from:a.baseParams.date_from,date_to:a.baseParams.date_to,keyword:a.baseParams.keyword,format:b}}})},onLogClear:function(){if(_S("demo_mode")){this.appInst.getMsgBox().alert(this.appInst.title,_JSLIBSTR("uicommon","error_demo"));return}this.topwin.getMsgBox().confirm(_T("tree","leaf_log"),_T("log","log_cfrm_clear"),function(a,b){if(a==="yes"){this.clearLog()}},this)},clearLog:function(){var a=this.grid.getStore();a.load({params:{action:"clear",logtype:this.getLogTypes()}})},destroy:function(){if(this.rowNav){Ext.destroy(this.rowNav);this.rowNav=null}this.callParent([this])}});Ext.define("SYNO.SDS.LogCenter.FileTransferLog",{extend:"SYNO.SDS.LogCenter.BaseLog",initSearchForm:function(){var a=new SYNO.SDS.LogCenter.SearchFormPanel({cls:"syno-sds-fs-search-panel",renderTo:Ext.getBody(),shadow:false,jsConfig:this.jsConfig,hidden:true,owner:this,logType:this.logType});a.hideItems(["logLevel","logLevelLabel"]);a.allLogType="filexfer";return a},initPagingToolbar:function(){var a=new SYNO.ux.PagingToolbar({store:this.store,displayInfo:true,pageSize:this.itemsPerPage,showRefreshBtn:true,items:["-",_T("common","items_perpage"),this.initPageComboBox(this.getPageRecordStore()),"-"]});return a},onLoadException:function(a,c,e,b){if(!e.items){var d=SYNO.API.getErrorString(e.code);if(5008==e.code){d=_T("log","no_active_log")}this.grid.getGridEl().mask(d);this.topwin.enableExportButton(false);this.topwin.enableClearButton(false)}},onAfterStoreLoad:function(a,c,b){if(c.length<1){if(b.params.target=="LOCAL"){this.grid.getGridEl().mask(_T("log","no_log_available"))}else{this.grid.getGridEl().mask(_T("log","no_ietf_log_available"))}this.topwin.enableExportButton(false);this.topwin.enableClearButton(false)}else{this.grid.getGridEl().unmask();this.topwin.enableExportButton(true);this.topwin.enableClearButton(true)}}});Ext.define("SYNO.SDS.LogCenter.FileTransferLogBuilder",{extend:"Object",create:function(e){var d=[["ftp",_T("log","log_ftp_xfer")],["filestation",_T("log","log_filebrowser_xfer")],["webdav",_T("log","log_webdav_xfer")],["cifs",_T("log","log_smb_xfer")],["afp",_T("log","log_afp_xfer")],["tftp",_T("log","log_tftp_xfer")]],h=_T("log","file_transfer"),g="fileTransfer",c="file_transfer";var b=this.getStore(e.appInst),f=this.getColumnModel(),a={logType:d,title:h,itemId:g,fileTitle:c,ds:b,cm:f};Ext.applyIf(e,a);return new SYNO.SDS.LogCenter.FileTransferLog(e)},getStore:function(a){var b=new SYNO.API.Store({appWindow:a,proxy:new SYNO.API.Proxy({api:"SYNO.Core.SyslogClient.Log",method:"list",version:1}),reader:new Ext.data.JsonReader({root:"items",totalProperty:"total"},["logtype","time","ip","username","cmd","filesize","descr","isdir"]),sortInfo:{field:"time",direction:"DESC"},autoDestroy:true,remoteSort:false});return b},getColumnModel:function getLogCM(){var c=SYNO.SDS.LogCenter.Utils.datetimeRenderer;var e=SYNO.SDS.LogCenter.Utils.htmlEncodeRender;var d=function(g,f){g=(g==="true")?_T("common","folder"):_T("common","file");return e(g,f)};var b=function(l,j,f,h,k,g){if(f.get("isdir")==="true"||f.get("cmd")==="create"||f.get("cmd")==="AFP_CREATEFILE"){l="NA"}return e(l,j)};var a=new Ext.grid.ColumnModel({columns:[{header:_T("tree","leaf_log"),dataIndex:"logtype",width:90,align:"center",renderer:e},{header:_T("log","log_time"),dataIndex:"time",width:160,align:"center",renderer:c},{header:_T("pppoe","pppoe_IP"),dataIndex:"ip",width:105,align:"center",renderer:e},{header:_T("log","log_account"),dataIndex:"username",width:115,align:"center",renderer:e},{header:_T("log","log_action"),dataIndex:"cmd",width:100,align:"center",renderer:e},{header:_T("log","log_file_folder"),dataIndex:"isdir",width:100,align:"center",renderer:d},{header:_T("log","log_filesize"),dataIndex:"filesize",width:100,align:"center",renderer:b},{id:"descr",header:_T("log","log_filename"),dataIndex:"descr",width:300,align:"left",hideable:false,menuDisabled:true,renderer:e}],defaults:{sortable:false,forceFit:false,menuDisabled:false}});return a}});Ext.define("SYNO.SDS.LogCenter.DiskLogBuilder",{extend:"Object",create:function(e){var d=[["disk",_T("log","disk_related")]],h=_T("log","disk_related"),g="disk",c="disk_related";var b=this.getStore(e.appInst),f=this.getColumnModel(),a={logType:d,title:h,itemId:g,fileTitle:c,ds:b,cm:f};Ext.applyIf(e,a);return new SYNO.SDS.LogCenter.BaseLog(e)},getStore:function(a){var b=new SYNO.API.Store({appWindow:a,proxy:new SYNO.API.Proxy({api:"SYNO.Core.SyslogClient.Log",method:"list",version:1}),reader:new Ext.data.JsonReader({root:"items",totalProperty:"total"},["level","time","model","serial","container","slot","msg"]),remoteSort:false,sortInfo:{field:"time",direction:"DESC"},autoDestroy:true});return b},getColumnModel:function getLogCM(){var b=SYNO.SDS.LogCenter.LevelRenderer,c=SYNO.SDS.LogCenter.Utils.datetimeRenderer,d=SYNO.SDS.LogCenter.Utils.htmlEncodeRender;var a=new Ext.grid.ColumnModel({columns:[{menuText:_T("log","logattr"),header:_TT("SYNO.SDS.LogCenter.Instance","logattr","attr_priority"),dataIndex:"level",width:90,align:"center",renderer:b},{header:_T("log","log_time"),dataIndex:"time",width:160,align:"center",renderer:c},{header:_T("volume","volume_diskmodel"),dataIndex:"model",width:80,align:"center",renderer:d},{header:_T("smart","smart_disk_serial"),dataIndex:"serial",width:80,align:"center",renderer:d},{header:_T("volume","volume_e_unit"),dataIndex:"container",width:60,align:"center",renderer:d},{header:_T("dsmoption","login_logo_position"),dataIndex:"slot",width:60,align:"center",renderer:d},{id:"descr",header:_T("log","log_action"),dataIndex:"msg",css:"white-space:normal;",width:100,hideable:false,menuDisabled:true,renderer:d}],defaults:{sortable:false,menuDisabled:false}});return a}});Ext.define("SYNO.SDS.LogCenter.MultiSelectedDialog",{extend:"SYNO.SDS.ModalWindow",constructor:function(a){Ext.apply(this,a);this.orginalValue=this.combo.getMultiValue?this.combo.getMultiValue().toString():this.combo.getValue();this.orginalDisplayValue=this.combo.getRawValue();this.attriFormPanel=this.createAttriFormPanel();var b={width:335,height:380,resizable:false,title:a.title,comboName:a.combo.name,layout:"fit",closable:true,autoScroll:true,owner:a.owner,items:[this.attriFormPanel],buttons:[{text:_T("common","apply"),itemId:"apply",handler:this.onOk,scope:this},{text:_T("common","cancel"),itemId:"cancel",handler:this.onCancel,scope:this}]};SYNO.SDS.LogCenter.MultiSelectedDialog.superclass.constructor.call(this,b);this.initEvent()},initEvent:function(){this.mon(this,"close",this.onClose,this)},createAttriFormPanel:function(){var g=this.combo.getStore(),a=[],d=this.combo.displayField,c=this.combo.valueField,f,e;a.push({xtype:"syno_displayfield",indent:0,value:_T("log","title_select_desc")+_T("common","colon")});g.each(function(j){f=j.get(c);e=j.get(d);if(g.indexOf(j)===0||f==="more"){return true}var h={xtype:"syno_checkbox",indent:1,name:j.get(c),boxLabel:j.get(d)};a.push(h)},this);var b={labelWidth:190,labelAlign:"left",border:false,autoHeight:true,trackResetOnLoad:true,items:a};return new Ext.form.FormPanel(b)},setCheckBox:function(){var d=this.attriFormPanel.getForm(),b=this.combo,e=b.getStore(),c=b.getMultiValue()||[],a=b.valueField;c=c.length>0?c:[b.getValue()];e.each(function(g){var f=g.get(a);if(c.indexOf(f)!==-1&&d.findField(f)){d.findField(f).setValue(true)}},this)},showUp:function(){if(this.getFlagCustomOptionWindowShow(this.comboName)){return}this.setFlagCustomOptionWindowShow(this.comboName,true);this.setCheckBox();this.open()},onOk:function(){var f=this.attriFormPanel.getForm(),c=this.combo,g=c.getStore(),a=[],e=[],d=c.displayField,b=c.valueField;g.each(function(l){var h=l.get(b),k=l.get(d),j=f.findField(h);if(j&&j.getValue()){a.push(k);e.push(h)}},this);if(a.length===g.getCount()-2){c.setValue(this.emptyValue)}else{if(0<a.length){c.setRawValue(a.toString())}else{c.setValue(this.emptyValue)}}c.setMultiValue(e);this.isOK=true;Ext.Element.prototype.frame.apply(c.el,this.anim);this.close()},getFlagCustomOptionWindowShow:function(a){switch(a){case"host":return this.parentPanel.flagLogHostShow;case"prog":return this.parentPanel.flagLogProgramShow;case"prio":case"logLevel":return this.parentPanel.flagLogPrioShow;case"fac":return this.parentPanel.flagLogCategoryShow}},setFlagCustomOptionWindowShow:function(b,a){switch(b){case"host":this.parentPanel.flagLogHostShow=a;break;case"prog":this.parentPanel.flagLogProgramShow=a;break;case"prio":case"logLevel":this.parentPanel.flagLogPrioShow=a;break;case"fac":this.parentPanel.flagLogCategoryShow=a;break}},onCancel:function(){this.close()},onClose:function(){var a=this.combo;if(!this.isOK){a.setMultiValue(this.orginalValue);a.setRawValue(this.orginalDisplayValue)}this.setFlagCustomOptionWindowShow(this.comboName,false)}});Ext.define("SYNO.SDS.LogCenter.AdvancedSearchField",{extend:"SYNO.ux.SearchField",validator:SYNO.SDS.LogCenter.KeywordValidator,initEvents:function(){this.callParent(arguments);this.mon(Ext.getDoc(),"mousedown",this.onMouseDown,this);this.mon(this,"keypress",function(b,a){if(a.getKey()===Ext.EventObject.ENTER){if(!this.validate()){return}this.searchPanel.setKeyWord(this.getValue());this.searchPanel.onSearch()}},this)},isInnerComponent:function(c,b){var a=false;b.items.each(function(d){if(d instanceof Ext.form.ComboBox){if(d.view&&c.within(d.view.getEl())){a=true;return false}}else{if(d instanceof Ext.form.DateField){if(d.menu&&c.within(d.menu.getEl())){a=true;return false}}else{if(d instanceof Ext.form.CompositeField){if(this.isInnerComponent(c,d)){a=true;return false}}}}},this);return a},onMouseDown:function(b){var a=this.searchPanel;if(a&&a.isVisible()&&!a.isDestroyed&&!a.inEl&&!b.within(a.getEl())&&!b.within(this.searchtrigger)&&!this.isInnerComponent(b,this.searchPanel.getForm())){a.hide()}},onSearchTriggerClick:function(){if(this.searchPanel.isVisible()){this.searchPanel.hide();return}this.searchPanel.getEl().alignTo(this.wrap,"tr-br?",[6,0]);this.searchPanel.show();this.searchPanel.setKeyWord(this.getValue())},onTriggerClick:function(){this.callParent();this.searchPanel.onReset();this.searchPanel.onSearch()}});Ext.define("SYNO.SDS.LogCenter.SearchFormPanel",{extend:"SYNO.ux.FormPanel",constructor:function(a){this.dateType={custom:1,today:2,yesterday:4,lastweek:8,lastmonth:16};this.dataRange=[[this.dateType.custom,_T("log","date_custom")],[this.dateType.today,_T("log","date_today")],[this.dateType.yesterday,_T("log","date_yesterday")],[this.dateType.lastweek,_T("log","date_lastweek")],[this.dateType.lastmonth,_T("log","date_lastmonth")]];this.logLevelType={info:"info",warn:"warning",error:"err"};this.logLevel=[[this.logLevelType.info,_T("log","info_level")],[this.logLevelType.warn,_T("log","warn_level")],[this.logLevelType.error,_T("log","error_level")]];this.defaultAnimation=["#000",1,{duration:0.35}];this.dateFormat=SYNO.SDS.DateTimeUtils.GetDateFormat();Ext.apply(this,a||{});var b=this.fillConfig(a);this.callParent([b]);this.defineBehaviors();this.mon(this,"afterlayout",this.addToolTip,this,{single:true})},initComponent:function(){this.callParent([this]);this.addEvents("search")},getAllLogType:function(a){var b=[];a.each(function(c){b.push(c[0])});return b.join(",")},getAllLogDisplayText:function(a){var b=[];a.each(function(c){b.push(c[1])});return b.join(",")},fillConfig:function(k){var d,n,e,q,a,j,f,b,o;var g,m,r,h;var l=[];this.logType=k.logType;this.allLogType=this.getAllLogType(k.logType);this.allLogDisplayText=this.getAllLogDisplayText(k.logType);d=this.createKeyword();n=this.createFriendlyDate();e=this.createCustDate();q=this.createLevel();a=this.createType(k);j=this.createPrio();f=this.createHost();b=this.createProgram();o=this.createCategory();g=false;m=false;r=false;h=false;l.push(d);l.push(n);l.push(e);l.push(q);l.push(a);if(this.allLogType==="recvlog"){l.push(j);l.push(f);l.push(b);l.push(o)}l.push({xtype:"toolbar",border:false,itemId:"btns",toolbarCls:"search-panel-fbar-btnPanel",items:[{xtype:"lctbtext",itemId:"search-loading",text:""},{xtype:"lctbtext",itemId:"msg",height:26,style:"-webkit-text-size-adjust:none;font-size:11px;color:red;height:26px;overflow:hidden;",text:""},{xtype:"tbfill"},{xtype:"syno_button",btnStyle:"blue",style:"margin-right: 10px",text:_T("log","search"),itemId:"btn_search",handler:this.onSearch,scope:this},{xtype:"syno_button",btnStyle:"blue",style:"margin-right: 10px",text:"Stop",itemId:"btn_stop",hidden:true,handler:this.onStop,scope:this},{xtype:"syno_button",minWidth:80,text:_T("common","reset"),handler:this.onReset,scope:this}]});var c={width:368,heigh:480,floating:true,labelAlign:"left",trackResetOnLoad:true,waitMsgTarget:true,border:true,bodyStyle:"padding: 20px; padding-top: 0px; font-size: 24px;",autoFlexcroll:false,defaults:{hideLabel:true,anchor:"100%"},items:l,listeners:{actionfailed:{fn:function(){this.setMsg("");this.form.reset()},scope:this},beforeshow:{fn:function(){this.doLayout()},single:true},show:{fn:this.doLayout,single:true},beforehide:{fn:function(){if(this.flagLogHostShow||this.flagLogProgramShow||this.flagLogPrioShow||this.flagLogCategoryShow){return false}}}},keys:[{key:[10,13],fn:function(){if(!this.isVisible()){return}if(!this.btnSearch.hidden&&!this.btnSearch.disabled){this.onSearch()}else{if(!this.btnStop.hidden&&!this.btnStop.disabled){this.onStop()}}},scope:this}]};return c},setComboBoxValue:function(b,a){this.frameAnimation(b.el,this.defaultAnimation);if(b.setMultiValue){b.setMultiValue(a.split(","))}},getComboBoxValue:function(b){var a=this.getForm().findField(b);return a.getMultiValue?a.getMultiValue().toString():a.getValue()},multiSelect:function(c,e,a,d,b){Ext.applyIf(c,{setMultiValue:function(f){if(!Ext.isArray(f)){f=[f]}this.multiValue=f},getMultiValue:function(){return this.multiValue&&this.multiValue.length>0?this.multiValue:this.getValue().split(",")}});if("more"===e.get("value")){this.attriWin=new SYNO.SDS.LogCenter.MultiSelectedDialog({title:d,combo:c,emptyValue:b,anim:this.defaultAnimation,owner:this.owner.appInst,parentPanel:this});this.attriWin.showUp();c.collapse();return false}},createTpl:function(){return new Ext.XTemplate('<tpl for=".">','<div class="x-combo-list-item" ext:qtip="{displayText}">',"{displayText}","</div>","</tpl>")},logSelect:function(c,a,b){this.setComboBoxValue(c,c.getValue())},createKeyword:function(){return[{xtype:"syno_displayfield",value:_T("log","attr_keyword")+_T("common","colon"),flex:1},{xtype:"syno_textfield",msgTarget:"qtip",validateOnBlur:true,validationEvent:"blur",name:"keyword",flex:2,validator:SYNO.SDS.LogCenter.KeywordValidator,value:"",anchor:"92%"}]},setDate:function(c,b,a){if(a===true){this.frameAnimation(this.form.findField("searchdatefrom").el,this.defaultAnimation);this.frameAnimation(this.form.findField("searchdateto").el,this.defaultAnimation)}this.form.findField("searchdatefrom").setMaxValue(b);this.form.findField("searchdateto").setMinValue(c);this.form.findField("searchdatefrom").setValue(c);this.form.findField("searchdateto").setValue(b)},getFromToDate:function(c){var e,d,b=new Date();if(c===this.dateType.today){e=b;d=b}else{if(c===this.dateType.yesterday){e=b.add(Date.DAY,-1);d=e}else{if(c===this.dateType.lastweek){var a=b.getDay();e=b.add(Date.DAY,-7-a);d=e.add(Date.DAY,6)}else{if(c===this.dateType.lastmonth){b=b.add(Date.MONTH,-1);e=b.getFirstDateOfMonth();d=b.getLastDateOfMonth()}}}}return{from:e,to:d}},friendlyDateSelect:function(c,e,a){var b=e.get("id"),d=this.getFromToDate(b);this.setDate(d.from,d.to,true)},getFriendlyDateStore:function(){var a=this.dataRange;return new Ext.data.ArrayStore({autoDestroy:true,fields:["id","displayText"],data:a})},createFriendlyDate:function(){this.FriendlyDate=new SYNO.ux.ComboBox({mode:"local",editable:false,name:"dateRange",tpl:this.createTpl(),resizable:true,store:this.getFriendlyDateStore(),displayField:"displayText",valueField:"id",triggerAction:"all",lazyRender:true,flex:6,value:this.dateType.custom,listeners:{scope:this,beforequery:function(a){delete a.combo.lastQuery},beforeselect:this.friendlyDateSelect}});return[{xtype:"syno_displayfield",value:_T("log","date_range")+_T("common","colon"),flex:1},this.FriendlyDate]},createCustDate:function(){this.DateFrom=new SYNO.ux.DateField({name:"searchdatefrom",editable:false,format:this.dateFormat,emptyText:_T("log","date_from"),value:"",listeners:{scope:this,select:function(b,a){this.form.findField("searchdateto").setMinValue(a)}}});this.DateTo=new SYNO.ux.DateField({name:"searchdateto",editable:false,format:this.dateFormat,emptyText:_T("log","date_to"),value:"",listeners:{scope:this,select:function(b,a){this.form.findField("searchdatefrom").setMaxValue(a)}}});return[{xtype:"syno_displayfield",value:_T("time","time_date")+_T("common","colon")},{xtype:"syno_compositefield",hideLabel:true,defaults:{flex:1},defaultMargins:"0 8 0 0",items:[this.DateFrom,this.DateTo]}]},getLogLevelStore:function(){var a=this.logLevel.slice(0,this.logLevel.length);if(a.length>1){a.splice(0,0,["",_T("log","log_all")]);a.push(["more",_T("log","more_item")+"..."])}return new Ext.data.ArrayStore({autoDestroy:true,fields:["value","displayText"],data:a})},multiLogLevelSelect:function(b,c,a){this.multiSelect(b,c,a,_T("log","logattr"),"")},createLevel:function(){this.LogLevel=new SYNO.ux.ComboBox({xtype:"syno_combobox",mode:"local",editable:false,name:"logLevel",tpl:this.createTpl(),resizable:true,store:this.getLogLevelStore(),displayField:"displayText",valueField:"value",triggerAction:"all",lazyRender:true,flex:3,value:"",listeners:{scope:this,beforequery:function(a){delete a.combo.lastQuery},beforeselect:this.multiLogLevelSelect,select:this.logSelect}});return[{xtype:"syno_displayfield",name:"logLevelLabel",value:_T("log","logattr")+_T("common","colon"),flex:1},this.LogLevel]},getLogTypeStore:function(a){a=a.slice(0,a.length);if(a.length>1){a.splice(0,0,["",_T("log","log_all")]);a.push(["more",_T("log","more_item")+"..."])}return new Ext.data.ArrayStore({autoDestroy:true,fields:["value","displayText"],data:a})},multiLogSelect:function(b,c,a){this.multiSelect(b,c,a,_T("tree","leaf_log"),"")},getLogConfig:function(b,a){this.LogTypeCombobox=new SYNO.ux.ComboBox({name:"logType",hiddenName:"logType",editable:false,tpl:this.createTpl(),resizable:true,mode:"local",store:this.getLogTypeStore(b),displayField:"displayText",valueField:"value",triggerAction:"all",lazyRender:true,flex:a||3,value:"",listeners:{scope:this,beforequery:function(c){delete c.combo.lastQuery},beforeselect:this.multiLogSelect,select:this.logSelect}});this.LogTypeLabel=new SYNO.ux.DisplayField({name:"logType",flex:a||3,value:this.logType.length<2?"":this.allLogDisplayText});if(!Ext.isArray(b)){b=[b]}return b.length<2?this.LogTypeLabel:this.LogTypeCombobox},createType:function(a){return[{xtype:"syno_displayfield",name:"logTypeLabel",value:this.logType.length<2?"":_T("tree","leaf_log")+_T("common","colon"),flex:3},this.getLogConfig(a.logType,a.flex)]},priorStoreGet:function(){var a=[["",_T("log","log_all")],["emerg","Emergency"],["alert","Alert"],["crit","Critical"],["err","Error"],["warning","Warning"],["notice","Notice"],["info","Information"],["debug","Debug"],["more",_T("log","more_item")+"..."]];return new Ext.data.SimpleStore({autoDestroy:true,fields:["value","displayText"],data:a})},multiAttrPrioSelect:function(b,c,a){this.multiSelect(b,c,a,_TT("SYNO.SDS.LogCenter.Instance","logattr","attr_priority"),"")},createPrio:function(){this.LogPrio=new SYNO.ux.ComboBox({xtype:"syno_combobox",name:"prio",editable:false,store:this.priorStoreGet(),tpl:this.createTpl(),resizable:true,displayField:"displayText",valueField:"value",triggerAction:"all",lazyRender:true,value:"",listeners:{scope:this,beforeselect:this.multiAttrPrioSelect,select:this.logSelect}});return[{xtype:"syno_displayfield",name:"prioLabel",value:_TT("SYNO.SDS.LogCenter.Instance","logattr","attr_priority")+_T("common","colon")},this.LogPrio]},logAttriDbSet:function(a){this.LogHost.getStore().baseParams.db_path=a;this.LogProgram.getStore().baseParams.db_path=a;this.LogCategory.getStore().baseParams.db_path=a},logAttriStoreGet:function(a){return new SYNO.API.Store({proxy:new SYNO.API.Proxy({api:"SYNO.Core.SyslogClient.Status",method:"attr_enum",version:1}),reader:new Ext.data.JsonReader({root:"items",totalProperty:"total",id:"value"},[{name:"value",mapping:"value"},{name:"displayText",mapping:"displayText"}]),remoteSort:true,baseParams:{attr:a,db_path:"LOCALARCH"},pruneModifiedRecords:true,data:{total:1,items:[{value:"",displayText:_T("log","log_all")}]}})},hostNameStoreGet:function(){return this.logAttriStoreGet("host")},multiAttrHostSelect:function(b,c,a){this.multiSelect(b,c,a,_TT("SYNO.SDS.LogCenter.Instance","logattr","attr_host"),"")},createHost:function(){this.LogHost=new SYNO.ux.ComboBox({xtype:"syno_combobox",name:"host",editable:false,mode:"remote",store:this.hostNameStoreGet(),tpl:this.createTpl(),resizable:true,displayField:"displayText",valueField:"value",triggerAction:"all",lazyRender:true,value:"",listeners:{scope:this,beforequery:function(a){delete a.combo.lastQuery},beforeselect:this.multiAttrHostSelect,select:this.logSelect}});return[{xtype:"syno_displayfield",name:"hostLabel",value:_TT("SYNO.SDS.LogCenter.Instance","logattr","attr_host")+_T("common","colon")},this.LogHost]},progStoreGet:function(){return this.logAttriStoreGet("prog")},multiAttrProgSelect:function(b,c,a){this.multiSelect(b,c,a,_TT("SYNO.SDS.LogCenter.Instance","logattr","attr_program"),"")},createProgram:function(){this.LogProgram=new SYNO.ux.ComboBox({xtype:"syno_combobox",name:"prog",editable:false,mode:"remote",store:this.progStoreGet(),tpl:this.createTpl(),resizable:true,displayField:"displayText",valueField:"value",triggerAction:"all",lazyRender:true,value:"",listeners:{scope:this,beforequery:function(a){delete a.combo.lastQuery},beforeselect:this.multiAttrProgSelect,select:this.logSelect}});return[{xtype:"syno_displayfield",name:"progLabel",value:_TT("SYNO.SDS.LogCenter.Instance","logattr","attr_program")+_T("common","colon")},this.LogProgram]},facStoreGet:function(){return this.logAttriStoreGet("fac")},multiAttrFacSelect:function(b,c,a){this.multiSelect(b,c,a,_TT("SYNO.SDS.LogCenter.Instance","logattr","attr_facility"),"")},createCategory:function(){this.LogCategory=new SYNO.ux.ComboBox({xtype:"syno_combobox",name:"fac",mode:"remote",editable:false,store:this.facStoreGet(),tpl:this.createTpl(),resizable:true,displayField:"displayText",valueField:"value",triggerAction:"all",lazyRender:true,value:"",listeners:{scope:this,beforequery:function(a){delete a.combo.lastQuery},beforeselect:this.multiAttrFacSelect,select:this.logSelect}});return[{xtype:"syno_displayfield",name:"facLabel",value:_TT("SYNO.SDS.LogCenter.Instance","logattr","attr_facility")+_T("common","colon")},this.LogCategory]},hideItems:function(b){var c;if(!Ext.isArray(b)){b=[b]}for(var a=b.length-1;a>=0;a--){c=this.form.findField(b[a]);if(c){c.setVisible(false)}}},showSearchIcon:function(){var b=this.get("btns"),a=b.get("search-loading");a.getEl().addClass("search-loading")},hideSearchIcon:function(){var b=this.get("btns"),a=b.get("search-loading");a.getEl().removeClass("search-loading")},frameAnimation:function(a,b){if(a&&a.isVisible()){Ext.Element.prototype.frame.apply(a,b)}},defineBehaviors:function(){var a=this.get("btns");this.btnSearch=a.get("btn_search");this.btnStop=a.get("btn_stop")},setMsg:function(c){var a=this.get("btns");var b=a.get("msg");b.setText(c);if(c.trim()!==""){this.frameAnimation(b.el,this.defaultAnimation)}},setKeyWord:function(a){var b=this.form.findField("keyword");if(b&&Ext.isString(a)){b.setValue(a)}b.focus("",1)},onShowHideBtn:function(a){if(a){this.btnSearch.hide();this.btnStop.show()}else{this.btnSearch.show();this.btnStop.hide()}},onEnableDisableBtn:function(a){if(a){this.btnSearch.enable();this.btnStop.enable()}else{this.btnSearch.disable();this.btnStop.disable()}},isOwnerDestroyed:function(){return(this.owner&&this.owner.isDestroyed)},showMsg:function(b,a){if(!this.isOwnerDestroyed()){this.owner.getMsgBox().alert(b,a)}},hideMsg:function(){if(!this.isOwnerDestroyed()){this.owner.getMsgBox().hide()}},isFieldDirty:function(a){return this.form.findField(a).isDirty()},validateForm:function(){if(!this.form.isValid()){return false}return this.isFieldDirty("searchdatefrom")||this.isFieldDirty("searchdateto")||this.isFieldDirty("keyword")},getIp:function(b){var d=/^([1-9][0-9]{0,1}|1[013-9][0-9]|12[0-689]|2[01][0-9]|22[0-3])([.]([1-9]{0,1}[0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])){2}[.]([1-9][0-9]{0,1}|1[0-9]{2}|2[0-4][0-9]|25[0-4])$/,e=/^([1-9][0-9]{0,1}|1[013-9][0-9]|12[0-689]|2[01][0-9]|22[0-3])([.]([1-9]{0,1}[0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])){1}[.]([1-9][0-9]{0,1}|1[0-9]{2}|2[0-4][0-9]|25[0-4])$/,c=/^([1-9][0-9]{0,1}|1[013-9][0-9]|12[0-689]|2[01][0-9]|22[0-3])([.]([1-9]{0,1}[0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])){1}$/,a=/^([1-9][0-9]{0,1}|1[013-9][0-9]|12[0-689]|2[01][0-9]|22[0-3])$/;if(d.test(b)){return b}else{if(e.test(b)){return b+"/24"}else{if(c.test(b)){return b+"/16"}else{if(a.test(b)){return b+"/8"}else{return""}}}}},onSearch:function(b,g){var a,f,h,j,c,k;var d;a=this.getForm();f=a.findField("keyword").getValue();h=a.findField("searchdatefrom").getRawValue();j=a.findField("searchdateto").getRawValue();c=this.getComboBoxValue("logLevel");k=this.logType.length>1?this.getComboBoxValue("logType"):this.allLogType;if(this.allLogType==="recvlog"){d={keyword:"*"+f+"*",date_from:h?Date.parseDate(h+" 00:00:00",this.dateFormat+" H:i:s").getTime()/1000:0,date_to:j?Date.parseDate(j+" 23:59:59",this.dateFormat+" H:i:s").getTime()/1000:0,level:this.getComboBoxValue("prio"),hostname:this.getComboBoxValue("host"),program:this.getComboBoxValue("prog"),category:this.getComboBoxValue("fac")}}else{d={keyword:f,date_from:h?Date.parseDate(h+" 00:00:00",this.dateFormat+" H:i:s").getTime()/1000:0,date_to:j?Date.parseDate(j+" 23:59:59",this.dateFormat+" H:i:s").getTime()/1000:0,level:c,logtype:k||this.allLogType,ip:this.getIp(f)}}if(a.findField("keyword").isValid()){this.fireEvent("search",this,d);a.findField("keyword").clearInvalid()}},onReset:function(){this.form.items.each(function(a){if(a.isDirty()){this.frameAnimation(a.el,this.defaultAnimation)}},this);this.setMsg("");this.form.reset();this.form.findField("searchdatefrom").setMaxValue(null);this.form.findField("searchdateto").setMinValue(null);this.form.findField("logLevel").multiValue="";this.form.findField("logType").multiValue="";if(this.allLogType==="recvlog"){this.form.findField("prio").multiValue="";this.form.findField("host").multiValue="";this.form.findField("prog").multiValue="";this.form.findField("fac").multiValue=""}this.onSearch()},addToolTip:function(){SYNO.SDS.Utils.AddTip(this.getForm().findField("keyword").getEl(),SYNO.SDS.LogCenter.StringGet("common","opsearch_hint"))}});Ext.define("SYNO.SDS.LogCenter.Comp.TextItem",{extend:"Ext.Toolbar.TextItem",onRender:function(b,a){this.autoEl={cls:"xtb-text",html:this.text||"","ext:qtip":this.text||""};SYNO.SDS.LogCenter.Comp.TextItem.superclass.onRender.call(this,b,a)},setText:function(a){SYNO.SDS.LogCenter.Comp.TextItem.superclass.setText.call(this,a);if(this.rendered){this.el.set({"ext:qtip":a})}}});Ext.reg("lctbtext",SYNO.SDS.LogCenter.Comp.TextItem);Ext.define("SYNO.SDS.LogCenter.LocalLog",{extend:"SYNO.ux.Panel",constructor:function(a){this.setPluginLoaded();Ext.apply(this,a);var b=this.fillConfig(a);this.callParent([b])},setPluginLoaded:function(){this.PluginLoaded=false;if(SYNO.SDS.Config.FnMap.hasOwnProperty("SYNO.SDS.LogCenter.ExtReceiveLog")){this.PluginLoaded=true}},getPluginLoaded:function(){return this.PluginLoaded},storeLogSrcGet:function(){if(this.getPluginLoaded()){return new SYNO.API.Store({proxy:new SYNO.API.Proxy({appWindow:this.appWin,api:"SYNO.LogCenter.Log",method:"get_remotearch_subfolder",version:1}),reader:new Ext.data.JsonReader({root:"host_list"},["value","display"]),remoteSort:false,autoDestroy:true})}else{var a=[["local",_TT("SYNO.SDS.LogCenter.Instance","logsearch","local_logs")]];return new Ext.data.SimpleStore({autoDestroy:true,fields:["value","display"],data:a})}},storeLogTypeGet:function(){var a=[["general",_T("log","general")],["connection",_T("log","log_link_connection")],["fileTransfer",_T("log","file_transfer")],["disk",_T("log","disk_related")]];return new Ext.data.SimpleStore({autoDestroy:true,fields:["value","display"],data:a})},initToolbar:function(){var a=new Ext.Toolbar({style:{border:"0px",padding:"0px 0px 5px 0px"}});var b;this.ClearButton=new SYNO.ux.Button({text:_TT("SYNO.SDS.LogCenter.Instance","logview","btn_clear"),handler:this.onClearLog,scope:this});this.ExportButton=new SYNO.ux.SplitButton({text:_TT("SYNO.SDS.LogCenter.Instance","logview","btn_export"),handler:this.onExportHtml,scope:this,menu:{items:[{text:_T("log","html_type"),handler:this.onExportHtml,scope:this},{text:_T("log","csv_type"),handler:this.onExportCSV,scope:this}]}});b={name:"log_src",width:163,editable:false,store:this.storeLogSrcGet(),forceSelection:true,allowBlank:false,displayField:"display",valueField:"value",typeAhead:true,triggerAction:"all",lazyRender:true,value:"local",listeners:{scope:this,select:function(d,e,c){this.onClickLatest("LOCAL")}}};if(this.getPluginLoaded()){b.model="local";b.listeners.render=function(c){c.store.load({callback:function(e,d,f){this.ChangeSrcCombo.setRawValue(e[0].data.display)},scope:this})};b.listeners.select=function(d,e,c){if("local"===e.data.value){if("local"!=this.PreSrcComboOpt){this.ChangeTypeCombo.store.removeAt(0)}this.ChangeTypeCombo.setValue("general");this.onClickLatest("LOCAL")}else{if("local"==this.PreSrcComboOpt){this.ChangeTypeCombo.store.insert(0,new Ext.data.Record({value:"ExtReceiveLog",display:"All"}))}this.ChangeTypeCombo.setValue("ExtReceiveLog");if("receive"===e.data.value){this.onClickLatest("REMOTEARCH")}else{this.onClickLatest(e.data.value)}}this.PreSrcComboOpt=e.data.value};b.listeners.beforeselect=this.onBeforeSrcSelect}this.ChangeSrcCombo=new SYNO.ux.ComboBox(b);if(this.getPluginLoaded()){this.ChangeSrcCombo.show()}else{this.ChangeSrcCombo.hide()}this.ChangeTypeCombo=new SYNO.ux.ComboBox({name:"log_type",width:190,editable:false,store:this.storeLogTypeGet(),forceSelection:true,allowBlank:false,displayField:"display",valueField:"value",typeAhead:true,triggerAction:"all",lazyRender:true,value:"general",listeners:{scope:this,select:this.onChangeLogType,beforeselect:this.onBeforeTypeSelect}});this.SearchField=new SYNO.SDS.LogCenter.AdvancedSearchField({iconStyle:"filter",owner:this});this.SearchField.searchPanel=this.generalLog.searchPanel;a.add(this.ClearButton);a.add(this.ExportButton);a.add("->");a.add(this.ChangeSrcCombo);a.add("  ");a.add(this.ChangeTypeCombo);a.add("  ");a.add(this.SearchField);return a},createPanelComponent:function(c){var d,b;var a={jsConfig:this.jsConfig,baseURL:this.jsConfig.jsBaseURL,topwin:this,appInst:this.appWin};switch(c){case"general":d=new SYNO.SDS.LogCenter.GeneralLogBuilder(Ext.apply({},a));break;case"connection":d=new SYNO.SDS.LogCenter.ConnectionLogBuilder(Ext.apply({},a));break;case"fileTransfer":d=new SYNO.SDS.LogCenter.FileTransferLogBuilder(Ext.apply({},a));break;case"disk":d=new SYNO.SDS.LogCenter.DiskLogBuilder(Ext.apply({},a));break;case"ExtGeneral":d=new SYNO.SDS.LogCenter.ExtGeneralLogBuilder(Ext.apply({},a));break;case"ExtConnection":d=new SYNO.SDS.LogCenter.ExtConnectionLogBuilder(Ext.apply({},a));break;case"ExtFileTransfer":d=new SYNO.SDS.LogCenter.ExtFileTransferLogBuilder(Ext.apply({},a));break;case"ExtReceiveLog":d=new SYNO.SDS.LogCenter.ExtReceiveLogBuilder(Ext.apply({},a));break;default:break}b=d.create(Ext.apply({},a));return b},fillConfig:function(a){var c=[];this.generalLog=this.createPanelComponent("general");this.PreSrcComboOpt="local";c.push(this.generalLog);var b={title:_TT("SYNO.SDS.LogCenter.Instance","logsearch","cur_db"),border:false,trackResetOnLoad:true,tbar:this.initToolbar(),layout:"card",activeItem:0,items:c};Ext.apply(b,a);return b},showChangeSrcCombo:function(a){if(a){this.ChangeSrcCombo.show()}else{this.ChangeSrcCombo.hide()}},showChangeTypeCombo:function(a){if(a){this.ChangeTypeCombo.show()}else{this.ChangeTypeCombo.hide()}},enableExportButton:function(a){this.ExportButton.setDisabled(!a)},enableClearButton:function(a){this.ClearButton.setDisabled(!a)},enableChangeTypeCombo:function(a){this.ChangeTypeCombo.setDisabled(!a)},doSwitchPage:function(){var c=this.ChangeSrcCombo.getValue();var b=this.ChangeTypeCombo.getValue();var d,a;if("local"===c){d="LOCAL"}else{if("receive"===c){d="REMOTEARCH"}else{d=this.dbpath}}if("local"===c){switch(b){case"general":a=this.generalLog;break;case"connection":a=this.connectionLog;break;case"fileTransfer":a=this.fileTransferLog;break;case"disk":a=this.diskLog;break;default:a=this.generalLog;break}}else{switch(b){case"general":b="ExtGeneral";a=this.ExtGeneralLog;break;case"connection":b="ExtConnection";a=this.ExtConnectionLog;break;case"fileTransfer":b="ExtFileTransfer";a=this.ExtFileTransferLog;break;case"ExtReceiveLog":b="ExtReceiveLog";a=this.ExtReceiveLog;break;default:b="ExtReceiveLog";a=this.ExtReceiveLog;break}a.searchPanel.logAttriDbSet(d);a.dbpath=d}Ext.apply(a.grid.getStore().baseParams,{target:d});this.SearchField.searchPanel=a.searchPanel;this.getLayout().setActiveItem(b);a.onActive()},getLogType:function(b){var a;switch(b){case"ftpxfer":a="ftp";break;case"dsmfmxfer":a="filestation";break;case"webdavxfer":a="webdav";break;case"smbxfer":a="cifs";break;case"afpxfer":a="afp";break;case"tftpxfer":a="tftp";break;default:break}return a},forceSwitchPage:function(a,b){if("fileTransfer"===a){a="fileTransfer"}if(undefined===this.fileTransferLog){this.fileTransferLog=this.createPanelComponent("fileTransfer");this.add(this.fileTransferLog)}this.ChangeSrcCombo.setValue("local");this.ChangeTypeCombo.setValue(a);if("fileTransfer"===a){this.fileTransferLog.grid.getStore().baseParams.logtype=this.getLogType(b)}this.doSwitchPage()},onClickLatest:function(a){this.dbpath=a;this.doSwitchPage()},onChangeLogType:function(){this.doSwitchPage()},doExport:function(b){var a;var d=this.ChangeSrcCombo.getValue();var c=this.ChangeTypeCombo.getValue();if("local"===d){switch(c){case"general":a=this.generalLog;break;case"connection":a=this.connectionLog;break;case"fileTransfer":a=this.fileTransferLog;break;case"disk":a=this.diskLog;break;default:a=this.generalLog;break}}else{switch(c){case"general":a=this.ExtGeneralLog;break;case"connection":a=this.ExtConnectionLog;break;case"fileTransfer":a=this.ExtFileTransferLog;break;default:a=this.ExtReceiveLog;break}}a.onLogSave(b)},onExportHtml:function(){this.doExport("html")},onExportCSV:function(){this.doExport("csv")},onClearLogDone:function(d,b,c,a){if(d){this.getActivePage().loadData()}else{this.appWin.getMsgBox().alert(_TT("SYNO.SDS.LogCenter.Instance","app","app_name"),_T("common","error_system"))}this.appWin.clearStatusBusy()},onClearLog:function(){var e=this.ChangeSrcCombo.getValue();var c,b,d,a;if("local"==e){c="native";b=this.getActivePage().grid.getStore().baseParams.logtype;a="SYNO.Core.SyslogClient.Log"}else{c="archive";b=this.ChangeTypeCombo.getValue();d=this.dbpath;a="SYNO.LogCenter.Log"}this.appWin.getMsgBox().confirmDelete(_TT("SYNO.SDS.LogCenter.Instance","app","app_name"),_T("log","log_cfrm_clear"),function(f){if("yes"===f){this.appWin.setStatusBusy();this.appWin.sendWebAPI({api:a,version:1,method:"clear",params:{category:c,logtype:b,path:d},callback:this.onClearLogDone,scope:this})}},this)},onActivate:function(){this.getActivePage().grid.getStore().load()},getActivePage:function(){return this.getLayout().activeItem},onBeforeTypeSelect:function(d,a,b,c){if("connection"===a.data.value&&undefined===this.connectionLog){this.connectionLog=this.createPanelComponent("connection");this.add(this.connectionLog)}else{if("fileTransfer"===a.data.value&&undefined===this.fileTransferLog){this.fileTransferLog=this.createPanelComponent("fileTransfer");this.add(this.fileTransferLog)}else{if("disk"===a.data.value&&undefined===this.diskLog){this.diskLog=this.createPanelComponent("disk");this.add(this.diskLog)}}}},onBeforeSrcSelect:function(c,a,b){if(undefined===this.ExtReceiveLog){this.ExtReceiveLog=this.createPanelComponent("ExtReceiveLog");this.add(this.ExtReceiveLog);this.ExtGeneralLog=this.createPanelComponent("ExtGeneral");this.add(this.ExtGeneralLog);this.ExtConnectionLog=this.createPanelComponent("ExtConnection");this.add(this.ExtConnectionLog);this.ExtFileTransferLog=this.createPanelComponent("ExtFileTransfer");this.add(this.ExtFileTransferLog)}}});Ext.define("SYNO.SDS.LogCenter.LogSearch",{extend:"SYNO.ux.TabPanel",uiconfig:{},constructor:function(a){var b;Ext.apply(this,a);b=this.fillConfig(a);this.callParent([b]);this.mon(this.pluginLoader,"load",function(c,d,e){Ext.each(this.LogCenterPluginMap,function(h,f,g){if(h.fn===d){h.isLoaded=true;return false}},this)},this);this.mon(SYNO.SDS.StatusNotifier,"servicechanged",this.getPlugins,this);this.mon(SYNO.SDS.StatusNotifier,"appprivilegechanged",this.getPlugins,this);this.mon(SYNO.SDS.StatusNotifier,"jsconfigLoaded",this.getPlugins,this)},initEvents:function(){this.callParent();this.addListener("beforetabchange",this.onBeforeTabChange,this)},fillConfig:function(a){var b;this.LogPanelLocal=new SYNO.SDS.LogCenter.LocalLog({itemId:"local",appWin:a.appWin,jsConfig:a.jsConfig,owner:this});b={labelAlign:"left",border:false,trackResetOnLoad:true,items:[this.LogPanelLocal]};this.pluginLoader=SYNO.SDS.LogCenter.PluginLoader;this.getPlugins();Ext.iterate(this.LogCenterPluginMap,function(d,c){b.items.push({title:_TT("SYNO.SDS.LogCenter.Application","logsearch",c.title),itemId:c.itemId})});Ext.apply(b,a);return b},getPlugins:function(){var e=this,g,b,d,f={},c,a;for(b in SYNO.SDS.Config.FnMap){if(SYNO.SDS.Config.FnMap.hasOwnProperty(b)){g=SYNO.SDS.Config.FnMap[b];d=g.config;c=null;if(!Ext.isObject(d)||!Ext.isObject(d.logcenter_logbrowse_extern)){continue}c=d.logcenter_logbrowse_extern;a={itemId:c.itemId,title:c.title,fn:c.fn,isCreated:false,isLoaded:false};e.pluginLoader.loadModule(c.fn);f[c.itemId]=a}}e.LogCenterPluginMap=f},onGetUIConfigDone:function(d,b,c,a){this.LogPanelLocal.onActivate()},getUIConfig:function(){this.appWin.setStatusBusy();this.appWin.clearStatusBusy()},onPageActivate:function(){this.getUIConfig()},onBeforeTabChange:function(d,b,e){if(Ext.isObject(this.LogCenterPluginMap[b.itemId])){var a=this.LogCenterPluginMap[b.itemId];var c=Ext.namespace(a.fn);if(false===a.isCreated){d.remove(a.itemId);d.add(new c({itemId:a.itemId,appWin:d.appWin,jsConfig:d.jsConfig,owner:d}));a.isCreated=true}}return true}});Ext.define("SYNO.SDS.LogCenter.NotifySetting",{extend:"SYNO.SDS.Utils.FormPanel",constructor:function(a){var b;Ext.apply(this,a);b=this.fillConfig(a);this.callParent([b])},initEvents:function(){this.callParent(arguments);this.mon(this,"afterlayout",function(a,c){var b=this.getForm();b.findField("cf_eps").mon(this,"afterlayout",function(e,f){var d;d=new SYNO.SDS.Utils.EnableCheckGroup(b,"eps_enable",["eps_number"])},this,{single:true});b.findField("cf_sev").mon(this,"afterlayout",function(d,e){var f;f=new SYNO.SDS.Utils.EnableCheckGroup(b,"severity_enable",["severity_threshold"])},this,{single:true});b.findField("cf_pat").mon(this,"afterlayout",function(d,e){var f;f=new SYNO.SDS.Utils.EnableCheckGroup(b,"keyword_enable",["keyword_1","keyword_2","keyword_3"])},this,{single:true})},this,{single:true})},storeLogLevelGet:function(){var a=[[0,"Emergency"],[1,"Alert,Emergency"],[2,"Critical,Alert,Emergency"],[3,"Error,Critical,Alert,Emergency"]];return new Ext.data.SimpleStore({autoDestroy:true,fields:["value","display"],data:a})},fillConfig:function(a){var c=300;var b={labelAlign:"left",border:false,trackResetOnLoad:true,useDefaultBtn:true,items:[{xtype:"syno_fieldset",title:_TT("SYNO.SDS.LogCenter.Instance","ntfsetting","fs_notify_rule"),width:"570",height:"400",items:[{xtype:"syno_displayfield",value:_TT("SYNO.SDS.LogCenter.Instance","ntfsetting","desc_edit_rule")},{name:"cf_eps",xtype:"syno_compositefield",hideLabel:true,items:[{name:"eps_enable",xtype:"syno_checkbox",boxLabel:_TT("SYNO.SDS.LogCenter.Instance","ntfsetting","eps_rule"),width:c},{name:"eps_number",xtype:"syno_numberfield",width:SYNO.SDS.LogCenter.WidthEditField,emptyText:_TT("SYNO.SDS.LogCenter.Instance","ntfsetting","desc_eps_empty"),allowBlank:false,vtype:"number",value:10,validator:function(e){var d=/^\d+$/;if(!d.test(e)){return false}if(10>e){return false}return true}}]},{name:"cf_sev",xtype:"syno_compositefield",hideLabel:true,items:[{name:"severity_enable",xtype:"syno_checkbox",boxLabel:_TT("SYNO.SDS.LogCenter.Instance","ntfsetting","sev_rule"),width:c},{name:"severity_threshold",xtype:"syno_combobox",width:SYNO.SDS.LogCenter.WidthEditField,mode:"local",emptyText:_TT("SYNO.SDS.LogCenter.Instance","ntfsetting","desc_sev_empty"),editable:false,store:this.storeLogLevelGet(),forceSelection:true,allowBlank:false,displayField:"display",valueField:"value",typeAhead:true,triggerAction:"all",lazyRender:true}]},{name:"cf_pat",xtype:"syno_compositefield",hideLabel:true,items:[{name:"keyword_enable",xtype:"syno_checkbox",boxLabel:_TT("SYNO.SDS.LogCenter.Instance","ntfsetting","keyword_rule"),width:c},{name:"keyword_1",xtype:"syno_textfield",width:SYNO.SDS.LogCenter.WidthEditField,allowBlank:true,maxlength:256,emptyText:_TT("SYNO.SDS.LogCenter.Instance","ntfsetting","desc_keyword_empty"),maskRe:/[^"\\]/,regex:/^[^"\\]*$/}]},{name:"keyword_2",xtype:"syno_textfield",style:"margin-left:120px",width:SYNO.SDS.LogCenter.WidthEditField,allowBlank:true,maxlength:256,emptyText:_TT("SYNO.SDS.LogCenter.Instance","ntfsetting","desc_keyword_empty"),maskRe:/[^"\\]/,regex:/^[^"\\]*$/},{name:"keyword_3",xtype:"syno_textfield",style:"margin-left:120px",width:SYNO.SDS.LogCenter.WidthEditField,allowBlank:true,maxlength:256,emptyText:_TT("SYNO.SDS.LogCenter.Instance","ntfsetting","desc_keyword_empty"),maskRe:/[^"\\]/,regex:/^[^"\\]*$/}]}],webapi:{api:"SYNO.Core.SyslogClient.Setting.Notify",methods:{get:"get",set:"set"},version:1}};Ext.apply(b,a);return b},checkEPS:function(){var f=true;var a=this.getForm().findField("eps_enable").getValue();var b=this.getForm().findField("eps_number");var e=b.getValue();var c=/^\d+$/;var d=_T("common","forminvalid");if(true===a){if(!c.test(e)){d=_TT("SYNO.SDS.LogCenter.Instance","ntfsetting","err_invalid_eps");f=false}if(f&&10>e){d=String.format(_TT("SYNO.SDS.LogCenter.Instance","ntfsetting","err_invalid_value_desc"),"10");f=false}}if(!f){b.markInvalid();this.setStatusError({text:d,clear:true})}return f},checkKeyWords:function(){var b;var e=true;var d=true;var a=[this.getForm().findField("keyword_1"),this.getForm().findField("keyword_2"),this.getForm().findField("keyword_3")];for(b=0;b<a.length;b++){d=d&(a[b].getValue()==="");if(!a[b].validate()){e=false}try{new RegExp(a[b].getValue())}catch(c){a[b].markInvalid();e=false}}if(d){for(b=0;b<a.length;b++){a[b].markInvalid()}e=false}if(!e){this.setStatusError({text:_T("common","forminvalid"),clear:true})}return e},onBeforeAction:function(a,d){var c=true;if("get"===d){return true}if(this.checkFormDirty&&!this.isFormDirty()){var b=_T("error","nochange_subject");this.setStatusError({text:b,clear:true});return false}if(!this.checkEPS()){c=false}if(this.getForm().findField("keyword_enable").getValue()&&!this.checkKeyWords()){c=false}return c},onPageActivate:function(){this.loadForm();this.getForm().findField("cf_eps").doLayout();this.doLayout()},processReturnData:function(d,c,b){this.callParent(arguments);if(0===c.notify_setting){this.appWin.getMsgBox().confirm(_TT("SYNO.SDS.LogCenter.Instance","listpanel","notify_setting"),_TT("SYNO.SDS.LogCenter.Instance","ntfsetting","confirm_notify_setting"),function(e){if("yes"===e){SYNO.SDS.AppLaunch("SYNO.SDS.AdminCenter.Application",{fn:"SYNO.SDS.AdminCenter.Notification.Main"})}},this)}for(var a=0;a<c.result.length;a++){if(c.result[a].api=="SYNO.Core.SyslogClient.Setting.Notify"&&c.result[a].method=="set"&&c.result[a].error){switch(c.result[a].error.code){default:this.setStatusError({text:_T("common","forminvalid"),clear:true});break}}}}});var LogCenterFlotr={version:"%version%",author:"Bas Wenneker",website:"http://www.solutoire.com",isIphone:/iphone/i.test(navigator.userAgent),graphTypes:{},plugins:{},addType:function(a,b){LogCenterFlotr.graphTypes[a]=b;LogCenterFlotr.defaultOptions[a]=b.options||{};LogCenterFlotr.defaultOptions.defaultType=LogCenterFlotr.defaultOptions.defaultType||a},addPlugin:function(a,b){LogCenterFlotr.plugins[a]=b;LogCenterFlotr.defaultOptions[a]=b.options||{}},draw:function(b,c,a,d){d=d||LogCenterFlotr.Graph;return new d(b,c,a)},getSeries:function(a){return a.collect(function(c){c=(c.data)?Object.clone(c):{data:c};for(var b=c.data.length-1;b>-1;--b){c.data[b][1]=(c.data[b][1]===null?null:parseFloat(c.data[b][1]))}return c})},merge:function(e,c){var d,b,a=c||{};for(d in e){b=e[d];a[d]=(b&&typeof(b)==="object"&&!(b.constructor===Array||b.constructor===RegExp)&&!Object.isElement(b))?LogCenterFlotr.merge(b,c[d]):a[d]=b}return a},clone:function(b){var c,a,d={};for(c in b){a=b[c];d[c]=(a&&typeof(a)==="object"&&!(a.constructor===Array||a.constructor===RegExp)&&!Object.isElement(a))?LogCenterFlotr.clone(a):a}return d},getTickSize:function(e,d,a,b){var h=(a-d)/e,g=LogCenterFlotr.getMagnitude(h),f=10,c=h/g;if(c<1.5){f=1}else{if(c<2.25){f=2}else{if(c<3){f=((b==0)?2:2.5)}else{if(c<7.5){f=5}}}}return f*g},defaultTickFormatter:function(a){return a+""},defaultTrackFormatter:function(a){return"("+a.x+", "+a.y+")"},engineeringNotation:function(e,a,d){var c=["Y","Z","E","P","T","G","M","k",""],f=["y","z","a","f","p","n","?","m",""],b=c.length;d=d||1000;a=Math.pow(10,a||2);if(e==0){return 0}if(e>1){while(b--&&(e>=d)){e/=d}}else{c=f;b=c.length;while(b--&&(e<1)){e*=d}}return(Math.round(e*a)/a)+c[b]},getMagnitude:function(a){return Math.pow(10,Math.floor(Math.log(a)/Math.LN10))},toPixel:function(a){return Math.floor(a)+0.5},toRad:function(a){return -a*(Math.PI/180)},floorInBase:function(b,a){return a*Math.floor(b/a)},drawText:function(b,d,a,e,c){if(!b.fillText||LogCenterFlotr.isIphone){b.drawText(d,a,e,c);return}c=Object.extend({size:"10px",color:"#000000",textAlign:"left",textBaseline:"bottom",weight:1,angle:0},c);b.save();b.translate(a,e);b.rotate(c.angle);b.fillStyle=c.color;b.font=(c.weight>1?"bold ":"")+(c.size*1.3)+"px sans-serif";b.textAlign=c.textAlign;b.textBaseline=c.textBaseline;b.fillText(d,0,0);b.restore()},measureText:function(a,d,c){if(!a.fillText||LogCenterFlotr.isIphone){return{width:a.measure(d,c)}}c=Object.extend({size:"10px",weight:1,angle:0},c);a.save();a.rotate(c.angle);a.font=(c.weight>1?"bold ":"")+(c.size*1.3)+"px sans-serif";var b=a.measureText(d);a.restore();return b},getBestTextAlign:function(b,a){a=a||{textAlign:"center",textBaseline:"middle"};b+=LogCenterFlotr.getTextAngleFromAlign(a);if(Math.abs(Math.cos(b))>0.01){a.textAlign=(Math.cos(b)>0?"right":"left")}if(Math.abs(Math.sin(b))>0.01){a.textBaseline=(Math.sin(b)>0?"top":"bottom")}return a},alignTable:{"right middle":0,"right top":Math.PI/4,"center top":Math.PI/2,"left top":3*(Math.PI/4),"left middle":Math.PI,"left bottom":-3*(Math.PI/4),"center bottom":-Math.PI/2,"right bottom":-Math.PI/4,"center middle":0},getTextAngleFromAlign:function(a){return LogCenterFlotr.alignTable[a.textAlign+" "+a.textBaseline]||0}};LogCenterFlotr.defaultOptions={colors:["#00A8F0","#C0D800","#CB4B4B","#4DA74D","#9440ED"],title:null,subtitle:null,shadowSize:4,defaultType:null,HtmlText:true,fontSize:7.5,resolution:1,legend:{show:true,noColumns:1,labelFormatter:function(a){return a},labelBoxBorderColor:"#CCCCCC",labelBoxWidth:14,labelBoxHeight:10,labelBoxMargin:5,container:null,position:"nw",margin:5,backgroundColor:null,backgroundOpacity:0.85},xaxis:{ticks:null,showLabels:true,labelsAngle:0,title:null,titleAngle:0,noTicks:5,tickFormatter:LogCenterFlotr.defaultTickFormatter,tickDecimals:null,min:null,max:null,autoscaleMargin:0,color:null,mode:"normal",timeFormat:null,scaling:"linear",base:Math.E,minLabelWidth:null,minLabelHeight:null,height:null},x2axis:{},yaxis:{ticks:null,showLabels:true,labelsAngle:0,title:null,titleAngle:90,noTicks:5,tickFormatter:LogCenterFlotr.defaultTickFormatter,tickDecimals:null,min:null,max:null,autoscaleMargin:0,color:null,scaling:"linear",base:Math.E,minLabelWidth:null,minLabelHeight:null,fontSize:null},y2axis:{titleAngle:270},grid:{color:"#545454",backgroundColor:null,tickColor:"#DDDDDD",labelMargin:3,verticalLines:true,horizontalLines:true,outlineWidth:2,circular:false},selection:{mode:null,color:"#B6D9FF",fps:20},crosshair:{mode:null,color:"#FF0000",hideCursor:true,lineWidth:1},mouse:{track:false,trackAll:false,position:"se",relative:false,trackFormatter:LogCenterFlotr.defaultTrackFormatter,margin:5,lineColor:"#FF3F19",trackDecimals:1,sensibility:2,radius:3,fillColor:null,fillOpacity:0.4,trackStyle:null},guides:[{mode:null,color:"#FA4444",lineWidth:2,sensibility:2,value:0,trackFormatter:LogCenterFlotr.defaultTrackFormatter}]};LogCenterFlotr.Graph=Class.create({initialize:function(c,d,a){try{this.el=$(c);if(!this.el){throw"The target container doesn't exist"}if(!this.el.clientWidth){throw"The target container must be visible"}this.registerPlugins();this.el.fire("flotr:beforeinit",[this]);this.el.graph=this;this.data=d;this.lastMousePos={pageX:null,pageY:null};this.selection={first:{x:-1,y:-1},second:{x:-1,y:-1}};this.plotOffset={left:0,right:0,top:0,bottom:0};this.prevSelection=null;this.selectionInterval=null;this.ignoreClick=false;this.prevHit=null;this.series=LogCenterFlotr.getSeries(d);this.setOptions(a);var b,g;for(b in LogCenterFlotr.graphTypes){this[b]=Object.clone(LogCenterFlotr.graphTypes[b]);for(g in this[b]){if(Object.isFunction(this[b][g])){this[b][g]=this[b][g].bind(this)}}}this.constructCanvas();this.el.fire("flotr:afterconstruct",[this]);this.initEvents();this.findDataRanges();this.calculateTicks(this.axes.x);this.calculateTicks(this.axes.x2);this.calculateTicks(this.axes.y);this.calculateTicks(this.axes.y2);this.calculateSpacing();this.setupAxes();this.draw();this.insertLegend();this.el.fire("flotr:afterinit",[this])}catch(f){try{console.error(f)}catch(f){}}},setOptions:function(b){var v=LogCenterFlotr.clone(LogCenterFlotr.defaultOptions);v.x2axis=Object.extend(Object.clone(v.xaxis),v.x2axis);v.y2axis=Object.extend(Object.clone(v.yaxis),v.y2axis);this.options=LogCenterFlotr.merge(b||{},v);this.axes={x:{options:this.options.xaxis,n:1},x2:{options:this.options.x2axis,n:2},y:{options:this.options.yaxis,n:1},y2:{options:this.options.y2axis,n:2}};var h=[],d=[],m=this.series.length,q=this.series.length,e=this.options.colors,a=[],g=0,o,l,k,u;for(l=q-1;l>-1;--l){o=this.series[l].color;if(o){--q;if(Object.isNumber(o)){h.push(o)}else{a.push(LogCenterFlotr.Color.parse(o))}}}for(l=h.length-1;l>-1;--l){q=Math.max(q,h[l]+1)}for(l=0;d.length<q;){o=(e.length==l)?new LogCenterFlotr.Color(100,100,100):LogCenterFlotr.Color.parse(e[l]);var f=g%2==1?-1:1,n=1+f*Math.ceil(g/2)*0.2;o.scale(n,n,n);d.push(o);if(++l>=e.length){l=0;++g}}for(l=0,k=0;l<m;++l){u=this.series[l];if(u.color==null){u.color=d[k++].toString()}else{if(Object.isNumber(u.color)){u.color=d[u.color].toString()}}if(!u.xaxis){u.xaxis=this.axes.x}if(u.xaxis==1){u.xaxis=this.axes.x}else{if(u.xaxis==2){u.xaxis=this.axes.x2}}if(!u.yaxis){u.yaxis=this.axes.y}if(u.yaxis==1){u.yaxis=this.axes.y}else{if(u.yaxis==2){u.yaxis=this.axes.y2}}for(var r in LogCenterFlotr.graphTypes){u[r]=Object.extend(Object.clone(this.options[r]),u[r])}u.mouse=Object.extend(Object.clone(this.options.mouse),u.mouse);if(u.shadowSize==null){u.shadowSize=this.options.shadowSize}}},setupAxes:function(){function b(d,e){if(e.scaling==="logarithmic"){d=Math.log(Math.max(d,Number.MIN_VALUE));if(e.base!==Math.E){d/=Math.log(e.base)}}return d}function a(d,e){if(e.scaling==="logarithmic"){d=(e.base===Math.E)?Math.exp(d):Math.pow(e.base,d)}return d}this.axes.x.d2p=this.axes.x2.d2p=function(d){return(b(d,this.options)-this.min)*this.scale};this.axes.x.p2d=this.axes.x2.p2d=function(d){return(a(d,this.options)/this.scale+this.min)};var c=this.plotHeight;this.axes.y.d2p=this.axes.y2.d2p=function(d){return c-(b(d,this.options)-this.min)*this.scale};this.axes.y.p2d=this.axes.y2.p2d=function(d){return a(this.max-d/this.scale,this.options)}},constructCanvas:function(){var e=this.el,b,h,a,f;this.canvas=e.select(".flotr-canvas")[0];this.overlay=e.select(".flotr-overlay")[0];this.mouseoverlay=e.select(".flotr-mouseoverlay")[0];e.descendants().invoke("remove");e.style.position="relative";e.style.cursor=e.style.cursor||"default";b=e.getDimensions();this.canvasWidth=b.width;this.canvasHeight=b.height;var d={width:b.width+"px",height:b.height+"px"};var g=this.options;b.width*=g.resolution;b.height*=g.resolution;if(this.canvasWidth<=0||this.canvasHeight<=0){throw"Invalid dimensions for plot, width = "+this.canvasWidth+", height = "+this.canvasHeight}if(!this.mouseoverlay){f=this.mouseoverlay=$(document.createElement("div"));f.className="flotr-mouseoverlay";f.style.cssText="position:absolute;left:0px;top:0px;"}f=this.mouseoverlay.writeAttribute(b).show().setStyle(d);e.insert(f);if(!this.canvas){h=this.canvas=$(document.createElement("canvas"));h.className="flotr-canvas";h.style.cssText="position:absolute;left:0px;top:0px;"}h=this.canvas.writeAttribute(b).show().setStyle(d);h.context_=null;f.insert(h);if(!this.overlay){a=this.overlay=$(document.createElement("canvas"));a.className="flotr-overlay";a.style.cssText="position:absolute;left:0px;top:0px;"}a=this.overlay.writeAttribute(b).show().setStyle(d);a.context_=null;f.insert(a);if(Prototype.Browser.IE&&window.G_vmlCanvasManager){window.G_vmlCanvasManager.initElement(h);window.G_vmlCanvasManager.initElement(a)}this.ctx=h.getContext("2d");this.octx=a.getContext("2d");if(!Prototype.Browser.IE){this.ctx.scale(g.resolution,g.resolution);this.octx.scale(g.resolution,g.resolution)}this.textEnabled=!!this.ctx.drawText},processColor:function(a,b){if(!a){return"rgba(0, 0, 0, 0)"}b=Object.extend({x1:0,y1:0,x2:this.plotWidth,y2:this.plotHeight,opacity:1,ctx:this.ctx},b);if(a instanceof LogCenterFlotr.Color){return a.adjust(null,null,null,b.opacity).toString()}if(Object.isString(a)){return LogCenterFlotr.Color.parse(a).scale(null,null,null,b.opacity).toString()}var h=a.colors?a:{colors:a};if(!b.ctx){if(!Object.isArray(h.colors)){return"rgba(0, 0, 0, 0)"}return LogCenterFlotr.Color.parse(Object.isArray(h.colors[0])?h.colors[0][1]:h.colors[0]).scale(null,null,null,b.opacity).toString()}h=Object.extend({start:"top",end:"bottom"},h);if(/top/i.test(h.start)){b.x1=0}if(/left/i.test(h.start)){b.y1=0}if(/bottom/i.test(h.end)){b.x2=0}if(/right/i.test(h.end)){b.y2=0}var e,g,d,f=b.ctx.createLinearGradient(b.x1,b.y1,b.x2,b.y2);for(e=0;e<h.colors.length;e++){g=h.colors[e];if(Object.isArray(g)){d=g[0];g=g[1]}else{d=e/(h.colors.length-1)}f.addColorStop(d,LogCenterFlotr.Color.parse(g).scale(null,null,null,b.opacity))}return f},registerPlugins:function(){var a,b,d;for(a in LogCenterFlotr.plugins){b=LogCenterFlotr.plugins[a];for(d in b.callbacks){this.el.stopObserving(d).observe(d,b.callbacks[d].bindAsEventListener(this))}this[a]=Object.clone(b);for(p in this[a]){if(Object.isFunction(this[a][p])){this[a][p]=this[a][p].bind(this)}}}},getTextDimensions:function(g,c,b,d){if(!g){return{width:0,height:0}}if(!this.options.HtmlText&&this.textEnabled){var e=this.ctx.getTextBounds(g,c);return{width:e.width+2,height:e.height+6}}else{var a=this.el.insert('<div style="position:absolute;top:-10000px;'+b+'" class="'+d+' flotr-dummy-div">'+g+"</div>").select(".flotr-dummy-div")[0],f=a.getDimensions();a.remove();return f}},loadDataGrid:function(){if(this.seriesData){return this.seriesData}var a=this.series,b=[];for(i=0;i<a.length;++i){a[i].data.each(function(d){var c=d[0],g=d[1],f=b.find(function(h){return h[0]==c});if(f){f[i+1]=g}else{var e=[];e[0]=c;e[i+1]=g;b.push(e)}})}return this.seriesData=b.sortBy(function(c){return c[0]})},initEvents:function(){this.mouseoverlay.stopObserving().observe("mousedown",this.mouseDownHandler.bindAsEventListener(this)).observe("mousemove",this.mouseMoveHandler.bindAsEventListener(this)).observe("mouseout",this.mouseOutHandler.bindAsEventListener(this)).observe("click",this.clickHandler.bindAsEventListener(this))},findDataRanges:function(){var n=this.series,k=this.axes;k.x.datamin=k.x2.datamin=k.y.datamin=k.y2.datamin=Number.MAX_VALUE;k.x.datamax=k.x2.datamax=k.y.datamax=k.y2.datamax=-Number.MAX_VALUE;if(n.length>0){var d,b,e,l,g,c,m,f;for(d=0;d<n.length;++d){c=n[d].data,m=n[d].xaxis,f=n[d].yaxis;if(c.length>0&&!n[d].hide){if(!m.used){m.datamin=m.datamax=c[0][0]}if(!f.used){f.datamin=f.datamax=c[0][1]}m.used=true;f.used=true;for(e=c.length-1;e>-1;--e){l=c[e][0];if(l<m.datamin){m.datamin=l}else{if(l>m.datamax){m.datamax=l}}for(b=1;b<c[e].length;b++){g=c[e][b];if(g<f.datamin){f.datamin=g}else{if(g>f.datamax){f.datamax=g}}}}}}}this.findXAxesValues();this.calculateRange(k.x,"x");if(k.x2.used){this.calculateRange(k.x2,"x")}this.calculateRange(k.y,"y");if(k.y2.used){this.calculateRange(k.y2,"y")}},extendRange:function(c,b){var d=(b==="y")?"extendYRange":"extendXRange";for(var a in LogCenterFlotr.graphTypes){if(this[a][d]){this[a][d](c)}}},calculateRange:function(e,d){var g=e.options,c=g.min!=null?g.min:e.datamin,a=g.max!=null?g.max:e.datamax,f=g.autoscaleMargin;if(a-c==0){var b=(a==0)?1:0.01;c-=b;a+=b}e.tickSize=LogCenterFlotr.getTickSize(g.noTicks,c,a,g.tickDecimals);if(g.min==null&&f!=0){c-=e.tickSize*f;if(c<0&&e.datamin>=0){c=0}c=e.tickSize*Math.floor(c/e.tickSize)}if(g.max==null&&f!=0){a+=e.tickSize*f;if(a>0&&e.datamax<=0&&e.datamax!=e.datamin){a=0}a=e.tickSize*Math.ceil(a/e.tickSize)}if(c==a){a=c+1}e.min=c;e.max=a;this.extendRange(e,d)},findXAxesValues:function(){var b,a,c;for(b=this.series.length-1;b>-1;--b){c=this.series[b];c.xaxis.values=c.xaxis.values||{};for(a=c.data.length-1;a>-1;--a){c.xaxis.values[c.data[a][0]+""]={}}}},calculateTicks:function(b){var m=b.options,n,h;b.ticks=[];if(m.ticks){var w=m.ticks,j,g;if(Object.isFunction(w)){w=w({min:b.min,max:b.max})}for(n=0;n<w.length;++n){j=w[n];if(typeof(j)=="object"){h=j[0];g=(j.length>1)?j[1]:m.tickFormatter(h)}else{h=j;g=m.tickFormatter(h)}b.ticks[n]={v:h,label:g}}}else{if(m.mode=="time"){var x=LogCenterFlotr.Date.timeUnits,f=LogCenterFlotr.Date.spec,u=(b.max-b.min)/b.options.noTicks,l,k;for(n=0;n<f.length-1;++n){var r=f[n][0]*x[f[n][1]];if(u<=(r+f[n+1][0]*x[f[n+1][1]])/2){break}}l=f[n][0];k=f[n][1];if(k=="year"){l=LogCenterFlotr.getTickSize(b.options.noTicks*x.year,b.min,b.max,0)}b.tickSize=l;b.tickUnit=k;b.ticks=LogCenterFlotr.Date.generator(b)}else{if(m.mode=="bytes"||m.mode=="byte"){var c=0,z,e=1024,a="KB",g;if(b.max>=10*1024*1024){e=1024*1024;a="MB"}else{if(b.max<100*1024){b.max=100*1024}}if(b.min<0){b.min=0}b.tickSize=LogCenterFlotr.getTickSize(m.noTicks,b.min/e,b.max/e,m.tickDecimals);b.tickSize=b.tickSize*e;c=b.tickSize*Math.ceil(b.min/b.tickSize);for(n=0;c+n*b.tickSize<=b.max;++n){h=(c+n*b.tickSize);g=(h/e).toFixed();h=g*e;b.ticks.push({v:h,label:m.tickFormatter(g)})}if(this.options.title){if(m.mode=="byte"){this.options.title+=" ("+a+")"}else{this.options.title+=" ("+a+"/s)"}}else{if(m.mode=="byte"){this.options.title=" ("+a+")"}else{this.options.title=" ("+a+"/s)"}}}else{if(m.mode=="timeus"){var c=0,z,q=1000,e=1,a="us",g;if(b.max>=10*q*q){e=q*q;a="s"}else{if(b.max>=10*q){e=q;a="ms"}else{if(b.max<100){b.max=100}}}if(b.min<0){b.min=0}b.tickSize=LogCenterFlotr.getTickSize(m.noTicks,b.min/e,b.max/e,m.tickDecimals);b.tickSize=b.tickSize*e;c=b.tickSize*Math.ceil(b.min/b.tickSize);for(n=0;c+n*b.tickSize<=b.max;++n){h=(c+n*b.tickSize);g=(h/e).toFixed();h=g*e;b.ticks.push({v:h,label:m.tickFormatter(g)})}if(this.options.title){this.options.title+=" ("+a+")"}else{this.options.title=" ("+a+")"}}else{if(m.mode=="lagtime"){var c=0,z,e=1,a=_T("common","time_seconds"),g;if(b.max>=24*60*60){e=60*60*24;a=_T("common","time_days")}else{if(b.max>=10*60*60){e=60*60;a=_T("common","time_hours")}else{if(b.max>=10*60){e=60;a=_T("common","time_minutes")}else{if(b.max<10){b.max=10}}}}if(b.min<0){b.min=0}b.tickSize=LogCenterFlotr.getTickSize(m.noTicks,b.min/e,b.max/e,m.tickDecimals);b.tickSize=b.tickSize*e;c=b.tickSize*Math.ceil(b.min/b.tickSize);for(n=0;c+n*b.tickSize<=b.max;++n){h=(c+n*b.tickSize);g=(h/e).toFixed();h=g*e;b.ticks.push({v:h,label:m.tickFormatter(g)})}if(this.options.title){this.options.title+=" ("+a+")"}else{this.options.title=" ("+a+")"}}else{if(m.mode=="datasize"){var c=0,z,e=1024,a=_T("common","size_kb"),g;if(b.max>=10*1024*1024*1024*1024){e=1024*1024*1024*1024;a=_T("common","size_tb")}else{if(b.max>=10*1024*1024*1024){e=1024*1024*1024;a=_T("common","size_gb")}else{if(b.max>=10*1024*1024){e=1024*1024;a=_T("common","size_mb")}else{if(b.max<10*1024){b.max=10*1024}}}}if(b.min<0){b.min=0}b.tickSize=LogCenterFlotr.getTickSize(m.noTicks,b.min/e,b.max/e,m.tickDecimals);b.tickSize=b.tickSize*e;c=b.tickSize*Math.ceil(b.min/b.tickSize);for(n=0;c+n*b.tickSize<=b.max;++n){h=(c+n*b.tickSize);g=(h/e).toFixed();h=g*e;b.ticks.push({v:h,label:m.tickFormatter(g)})}if(this.options.title){this.options.title+=" ("+a+")"}else{this.options.title=" ("+a+")"}}else{var c=b.tickSize*Math.ceil(b.min/b.tickSize),z;for(n=0;c+n*b.tickSize<=b.max;++n){h=c+n*b.tickSize;z=m.tickDecimals;if(z==null){z=1-Math.floor(Math.log(b.tickSize)/Math.LN10)}if(z<0){z=0}h=h.toFixed(z);b.ticks.push({v:h,label:m.tickFormatter(h)})}}}}}}}},calculateSpacing:function(){var q=this.axes,t=this.options,k=this.series,e=t.grid.labelMargin,r=q.x,b=q.x2,n=q.y,o=q.y2,g=2,h,f,d,m;if(t.maxOutset){g=t.maxOutset}[r,b,n,o].each(function(j){var a="";if(j.options.showLabels){for(h=0;h<j.ticks.length;++h){d=j.ticks[h].label.length;if(d>a.length){a=j.ticks[h].label}}}j.maxLabel=this.getTextDimensions(a,{size:t.fontSize,angle:LogCenterFlotr.toRad(j.options.labelsAngle)},"font-size:smaller;","flotr-grid-label");if(j.options.minLabelWidth&&j.options.minLabelWidth>j.maxLabel.width){j.maxLabel.width=j.options.minLabelWidth}if(j.options.minLabelHeight&&j.options.minLabelHeight>j.maxLabel.height){j.maxLabel.height=j.options.minLabelHeight}if(j.options.height){j.height=j.options.height}j.titleSize=this.getTextDimensions(j.options.title,{size:t.fontSize*1.2,angle:LogCenterFlotr.toRad(j.options.titleAngle)},"font-weight:bold;","flotr-axis-title")},this);m=this.getTextDimensions(t.title,{size:t.fontSize*1.5},"font-size:1em;font-weight:bold;","flotr-title");this.titleHeight=m.height;m=this.getTextDimensions(t.subtitle,{size:t.fontSize},"font-size:smaller;","flotr-subtitle");this.subtitleHeight=m.height;if(t.show){g=Math.max(g,t.points.radius+t.points.lineWidth/2)}for(f=0;f<t.length;++f){if(k[f].points.show){g=Math.max(g,k[f].points.radius+k[f].points.lineWidth/2)}}var c=this.plotOffset;c.bottom+=(t.grid.circular?0:(r.options.showLabels?(r.maxLabel.height+e):(r.height?r.height:0)))+(r.options.title?(r.titleSize.height+e):0)+g;c.top+=(t.grid.circular?0:(b.options.showLabels?(b.maxLabel.height+e):(b.height?b.height:0)))+(b.options.title?(b.titleSize.height+e):0)+this.subtitleHeight+this.titleHeight+g;c.left+=(t.grid.circular?0:(n.options.showLabels?(n.maxLabel.width+e):0))+(n.options.title?(n.titleSize.width+e):0)+g;c.right+=(t.grid.circular?0:(o.options.showLabels?(o.maxLabel.width+e):0))+(o.options.title?(o.titleSize.width+e):0)+g;c.top=Math.floor(c.top);this.plotWidth=this.canvasWidth-c.left-c.right;this.plotHeight=this.canvasHeight-c.bottom-c.top;r.scale=this.plotWidth/(r.max-r.min);b.scale=this.plotWidth/(b.max-b.min);n.scale=this.plotHeight/(n.max-n.min);o.scale=this.plotHeight/(o.max-o.min)},draw:function(){this.drawGrid();this.drawLabels();this.drawTitles();this.drawGuides();if(this.series.length){this.el.fire("flotr:beforedraw",[this.series,this]);for(var a=0;a<this.series.length;a++){if(!this.series[a].hide){this.drawSeries(this.series[a])}}}this.drawOutline();this.el.fire("flotr:afterdraw",[this.series,this])},drawGrid:function(){var m,b=this.options,n=this.ctx,l;if(b.grid.verticalLines||b.grid.horizontalLines){this.el.fire("flotr:beforegrid",[this.axes.x,this.axes.y,b,this])}n.save();n.lineWidth=1;n.strokeStyle=b.grid.tickColor;if(b.grid.circular){n.translate(this.plotOffset.left+this.plotWidth/2,this.plotOffset.top+this.plotHeight/2);var h=Math.min(this.plotHeight,this.plotWidth)*b.radar.radiusRatio/2,c=this.axes.x.ticks.length,g=2*(Math.PI/c),d=-Math.PI/2;n.beginPath();if(b.grid.horizontalLines){l=this.axes.y;for(var f=0;f<l.ticks.length;++f){m=l.ticks[f].v;var k=m/l.max;for(var e=0;e<=c;++e){n[e==0?"moveTo":"lineTo"](Math.cos(e*g+d)*h*k,Math.sin(e*g+d)*h*k)}}}if(b.grid.verticalLines){for(var f=0;f<c;++f){n.moveTo(0,0);n.lineTo(Math.cos(f*g+d)*h,Math.sin(f*g+d)*h)}}n.stroke()}else{n.translate(this.plotOffset.left,this.plotOffset.top);if(b.grid.backgroundColor!=null){n.fillStyle=this.processColor(b.grid.backgroundColor,{x1:0,y1:0,x2:this.plotWidth,y2:this.plotHeight});n.fillRect(0,0,this.plotWidth,this.plotHeight)}n.beginPath();if(b.grid.verticalLines){l=this.axes.x;for(var f=0;f<l.ticks.length;++f){m=l.ticks[f].v;if((m<=l.min||m>=l.max)||(m==l.min||m==l.max)&&b.grid.outlineWidth!=0){continue}n.moveTo(Math.floor(l.d2p(m))+n.lineWidth/2,0);n.lineTo(Math.floor(l.d2p(m))+n.lineWidth/2,this.plotHeight)}}if(b.grid.horizontalLines){l=this.axes.y;for(var e=0;e<l.ticks.length;++e){m=l.ticks[e].v;if((m<=l.min||m>=l.max)||(m==l.min||m==l.max)&&b.grid.outlineWidth!=0){continue}n.moveTo(0,Math.floor(l.d2p(m))+n.lineWidth/2);n.lineTo(this.plotWidth,Math.floor(l.d2p(m))+n.lineWidth/2)}}n.stroke()}n.restore();if(b.grid.verticalLines||b.grid.horizontalLines){this.el.fire("flotr:aftergrid",[this.axes.x,this.axes.y,b,this])}},drawOutline:function(){var j,a=this.options,k=this.ctx;if(a.grid.outlineWidth==0){return}k.save();if(a.grid.circular){k.translate(this.plotOffset.left+this.plotWidth/2,this.plotOffset.top+this.plotHeight/2);var g=Math.min(this.plotHeight,this.plotWidth)*a.radar.radiusRatio/2,b=this.axes.x.ticks.length,f=2*(Math.PI/b),d=-Math.PI/2;k.beginPath();k.lineWidth=a.grid.outlineWidth;k.strokeStyle=a.grid.color;k.lineJoin="round";for(var e=0;e<=b;++e){k[e==0?"moveTo":"lineTo"](Math.cos(e*f+d)*g,Math.sin(e*f+d)*g)}k.stroke()}else{k.translate(this.plotOffset.left,this.plotOffset.top);var c=a.grid.outlineWidth,h=0.5-c+((c+1)%2/2);k.lineWidth=c;k.strokeStyle=a.grid.color;k.lineJoin="miter";k.strokeRect(h,h,this.plotWidth+(-2*h),this.plotHeight+(-2*h))}k.restore()},drawGuides:function(){var b=this.options,a=this.ctx;if(!b.guides){return}a.save();b.guides.each(function(c){if(!c.mode){return}if(-1!==c.mode.indexOf("line")){if(-1!==c.mode.indexOf("y")){if(0===c.value){return}var d=this.axes.y;a.beginPath();a.lineWidth=c.lineWidth;a.strokeStyle=c.color;a.moveTo(this.plotOffset.left,this.plotOffset.top+d.d2p(c.value));a.lineTo(this.plotOffset.left+this.plotWidth,this.plotOffset.top+d.d2p(c.value));a.stroke();a.closePath()}}},this);a.restore()},drawLabels:function(){var c=0,d,m,o,k,q,g,l,e=this.options,n=this.ctx,v=this.axes;for(o=0;o<v.x.ticks.length;++o){if(v.x.ticks[o].label){++c}}m=this.plotWidth/c;if(e.grid.circular){n.save();n.translate(this.plotOffset.left+this.plotWidth/2,this.plotOffset.top+this.plotHeight/2);var f=this.plotHeight*e.radar.radiusRatio/2+e.fontSize,u=this.axes.x.ticks.length,b=2*(Math.PI/u),t=-Math.PI/2;var r={size:e.fontSize};d=v.x;r.color=d.options.color||e.grid.color;for(o=0;o<d.ticks.length&&d.options.showLabels;++o){q=d.ticks[o];q.label+="";if(!q.label||q.label.length==0){continue}var j=Math.cos(o*b+t)*f,h=Math.sin(o*b+t)*f;r.angle=LogCenterFlotr.toRad(d.options.labelsAngle);r.textBaseline="middle";r.textAlign=(Math.abs(j)<0.1?"center":(j<0?"right":"left"));LogCenterFlotr.drawText(n,q.label,j,h,r)}d=v.y;r.color=d.options.color||e.grid.color;for(o=0;o<d.ticks.length&&d.options.showLabels;++o){q=d.ticks[o];q.label+="";if(!q.label||q.label.length==0){continue}r.angle=LogCenterFlotr.toRad(d.options.labelsAngle);r.textBaseline="middle";r.textAlign="left";LogCenterFlotr.drawText(n,q.label,3,-(d.ticks[o].v/d.max)*(f-e.fontSize),r)}n.restore();return}if(!e.HtmlText&&this.textEnabled){var r={size:e.fontSize};d=v.x;r.color=d.options.color||e.grid.color;for(o=0;o<d.ticks.length&&d.options.showLabels&&d.used;++o){q=d.ticks[o];if(!q.label||q.label.length==0){continue}g=d.d2p(q.v);if(g<0||g>this.plotWidth){continue}r.angle=LogCenterFlotr.toRad(d.options.labelsAngle);r.textAlign="center";r.textBaseline="top";r=LogCenterFlotr.getBestTextAlign(r.angle,r);LogCenterFlotr.drawText(n,q.label,this.plotOffset.left+g,this.plotOffset.top+this.plotHeight+e.grid.labelMargin,r)}d=v.x2;r.color=d.options.color||e.grid.color;for(o=0;o<d.ticks.length&&d.options.showLabels&&d.used;++o){q=d.ticks[o];if(!q.label||q.label.length==0){continue}g=d.d2p(q.v);if(g<0||g>this.plotWidth){continue}r.angle=LogCenterFlotr.toRad(d.options.labelsAngle);r.textAlign="center";r.textBaseline="bottom";r=LogCenterFlotr.getBestTextAlign(r.angle,r);LogCenterFlotr.drawText(n,q.label,this.plotOffset.left+g,this.plotOffset.top+e.grid.labelMargin,r)}d=v.y;r.color=d.options.color||e.grid.color;for(o=0;o<d.ticks.length&&d.options.showLabels&&d.used;++o){q=d.ticks[o];if(!q.label||q.label.length==0){continue}l=d.d2p(q.v);if(l<0||l>this.plotHeight){continue}r.angle=LogCenterFlotr.toRad(d.options.labelsAngle);r.textAlign="right";r.textBaseline="middle";r=LogCenterFlotr.getBestTextAlign(r.angle,r);LogCenterFlotr.drawText(n,q.label,this.plotOffset.left-e.grid.labelMargin,this.plotOffset.top+l,r)}d=v.y2;r.color=d.options.color||e.grid.color;for(o=0;o<d.ticks.length&&d.options.showLabels&&d.used;++o){q=d.ticks[o];if(!q.label||q.label.length==0){continue}l=d.d2p(q.v);if(l<0||l>this.plotHeight){continue}r.angle=LogCenterFlotr.toRad(d.options.labelsAngle);r.textAlign="left";r.textBaseline="middle";r=LogCenterFlotr.getBestTextAlign(r.angle,r);LogCenterFlotr.drawText(n,q.label,this.plotOffset.left+this.plotWidth+e.grid.labelMargin,this.plotOffset.top+l,r);n.save();n.strokeStyle=r.color;n.beginPath();n.moveTo(this.plotOffset.left+this.plotWidth-8,this.plotOffset.top+d.d2p(q.v));n.lineTo(this.plotOffset.left+this.plotWidth,this.plotOffset.top+d.d2p(q.v));n.stroke();n.restore()}}else{if(v.x.options.showLabels||v.x2.options.showLabels||v.y.options.showLabels||v.y2.options.showLabels){k=['<div style="font-size:smaller;color:'+e.grid.color+';" class="flotr-labels">'];d=v.x;if(d.options.showLabels){for(o=0;o<d.ticks.length;++o){q=d.ticks[o];if(!q.label||q.label.length==0||(this.plotOffset.left+d.d2p(q.v)<0)||(this.plotOffset.left+d.d2p(q.v)>this.canvasWidth)){continue}k.push('<div style="position:absolute;top:',(this.plotOffset.top+this.plotHeight+e.grid.labelMargin),"px;left:",(this.plotOffset.left+d.d2p(q.v)-m/2),"px;width:",m,"px;text-align:center;",(d.options.color?("color:"+d.options.color+";"):""),'" class="flotr-grid-label">',q.label,"</div>")}}d=v.x2;if(d.options.showLabels&&d.used){for(o=0;o<d.ticks.length;++o){q=d.ticks[o];if(!q.label||q.label.length==0||(this.plotOffset.left+d.d2p(q.v)<0)||(this.plotOffset.left+d.d2p(q.v)>this.canvasWidth)){continue}k.push('<div style="position:absolute;top:',(this.plotOffset.top-e.grid.labelMargin-d.maxLabel.height),"px;left:",(this.plotOffset.left+d.d2p(q.v)-m/2),"px;width:",m,"px;text-align:center;",(d.options.color?("color:"+d.options.color+";"):""),'" class="flotr-grid-label">',q.label,"</div>")}}d=v.y;if(d.options.showLabels){for(o=0;o<d.ticks.length;++o){q=d.ticks[o];if(!q.label||q.label.length==0||(this.plotOffset.top+d.d2p(q.v)<0)||(this.plotOffset.top+d.d2p(q.v)>this.canvasHeight)){continue}k.push('<div style="position:absolute;top:',(this.plotOffset.top+d.d2p(q.v)-d.maxLabel.height/2),"px;left:0;width:",(this.plotOffset.left-e.grid.labelMargin),"px;text-align:right;",(d.options.color?("color:"+d.options.color+";"):""),(d.options.fontSize?("font-size:"+d.options.fontSize+";"):""),'" class="flotr-grid-label flotr-grid-label-y">',q.label,"</div>")}}d=v.y2;if(d.options.showLabels&&d.used){n.save();n.strokeStyle=d.options.color||e.grid.color;n.beginPath();for(o=0;o<d.ticks.length;++o){q=d.ticks[o];if(!q.label||q.label.length==0||(this.plotOffset.top+d.d2p(q.v)<0)||(this.plotOffset.top+d.d2p(q.v)>this.canvasHeight)){continue}k.push('<div style="position:absolute;top:',(this.plotOffset.top+d.d2p(q.v)-d.maxLabel.height/2),"px;right:0;width:",(this.plotOffset.right-e.grid.labelMargin),"px;text-align:left;",(d.options.color?("color:"+d.options.color+";"):""),'" class="flotr-grid-label flotr-grid-label-y">',q.label,"</div>");n.moveTo(this.plotOffset.left+this.plotWidth-8,this.plotOffset.top+d.d2p(q.v));n.lineTo(this.plotOffset.left+this.plotWidth,this.plotOffset.top+d.d2p(q.v))}n.stroke();n.restore()}k.push("</div>");this.el.insert(k.join(""))}}},drawTitles:function(){var e,d=this.options,g=d.grid.labelMargin,c=this.ctx,b=this.axes;if(!d.HtmlText&&this.textEnabled){var f={size:d.fontSize,color:d.grid.color,textAlign:"center"};if(d.subtitle){LogCenterFlotr.drawText(c,d.subtitle,this.plotOffset.left+this.plotWidth/2,this.titleHeight+this.subtitleHeight-2,f)}f.weight=1.5;f.size*=1.5;if(d.title){LogCenterFlotr.drawText(c,d.title,this.plotOffset.left+this.plotWidth/2,this.titleHeight-2,f)}f.weight=1.8;f.size*=0.8;if(b.x.options.title&&b.x.used){f.textAlign="center";f.textBaseline="top";f.angle=LogCenterFlotr.toRad(b.x.options.titleAngle);f=LogCenterFlotr.getBestTextAlign(f.angle,f);LogCenterFlotr.drawText(c,b.x.options.title,this.plotOffset.left+this.plotWidth/2,this.plotOffset.top+b.x.maxLabel.height+this.plotHeight+2*g,f)}if(b.x2.options.title&&b.x2.used){f.textAlign="center";f.textBaseline="bottom";f.angle=LogCenterFlotr.toRad(b.x2.options.titleAngle);f=LogCenterFlotr.getBestTextAlign(f.angle,f);LogCenterFlotr.drawText(c,b.x2.options.title,this.plotOffset.left+this.plotWidth/2,this.plotOffset.top-b.x2.maxLabel.height-2*g,f)}if(b.y.options.title&&b.y.used){f.textAlign="right";f.textBaseline="middle";f.angle=LogCenterFlotr.toRad(b.y.options.titleAngle);f=LogCenterFlotr.getBestTextAlign(f.angle,f);LogCenterFlotr.drawText(c,b.y.options.title,this.plotOffset.left-b.y.maxLabel.width-2*g,this.plotOffset.top+this.plotHeight/2,f)}if(b.y2.options.title&&b.y2.used){f.textAlign="left";f.textBaseline="middle";f.angle=LogCenterFlotr.toRad(b.y2.options.titleAngle);f=LogCenterFlotr.getBestTextAlign(f.angle,f);LogCenterFlotr.drawText(c,b.y2.options.title,this.plotOffset.left+this.plotWidth+b.y2.maxLabel.width+2*g,this.plotOffset.top+this.plotHeight/2,f)}}else{e=['<div style="color:'+d.grid.color+';" class="flotr-titles">'];if(d.title){e.push('<div style="position:absolute;top:0;left:',this.plotOffset.left,"px;width:",this.plotWidth,"px;");if(!d.titleCls){e.push("font-size:1em;font-weight:bold;text-align:center;")}e.push('" class="flotr-title ');if(d.titleCls){e.push(d.titleCls)}e.push('">',d.title,"</div>")}if(d.subtitle){e.push('<div style="position:absolute;top:',this.titleHeight,"px;left:",this.plotOffset.left,"px;font-size:smaller;text-align:center;width:",this.plotWidth,'px;" class="flotr-subtitle">',d.subtitle,"</div>")}e.push("</div>");e.push('<div class="flotr-axis-title" style="font-weight:bold;">');if(b.x.options.title&&b.x.used){e.push('<div style="position:absolute;top:',(this.plotOffset.top+this.plotHeight+d.grid.labelMargin+b.x.titleSize.height),"px;left:",this.plotOffset.left,"px;width:",this.plotWidth,'px;text-align:center;" class="flotr-axis-title">',b.x.options.title,"</div>")}if(b.x2.options.title&&b.x2.used){e.push('<div style="position:absolute;top:0;left:',this.plotOffset.left,"px;width:",this.plotWidth,'px;text-align:center;" class="flotr-axis-title">',b.x2.options.title,"</div>")}if(b.y.options.title&&b.y.used){e.push('<div style="position:absolute;top:',(this.plotOffset.top+this.plotHeight/2-b.y.titleSize.height/2),'px;left:0;text-align:right;" class="flotr-axis-title">',b.y.options.title,"</div>")}if(b.y2.options.title&&b.y2.used){e.push('<div style="position:absolute;top:',(this.plotOffset.top+this.plotHeight/2-b.y.titleSize.height/2),'px;right:0;text-align:right;" class="flotr-axis-title">',b.y2.options.title,"</div>")}e.push("</div>");this.el.insert(e.join(""))}},drawSeries:function(a){a=a||this.series;var b=false;for(type in LogCenterFlotr.graphTypes){if(a[type]&&a[type].show){b=true;this[type].draw(a)}}if(!b){this[this.options.defaultType].draw(a)}},insertLegend:function(){if(!this.options.legend.show){return}var o=this.series,q=this.plotOffset,e=this.options,a=e.legend,N=[],b=false,A=this.ctx,D;var C=o.findAll(function(c){return(c.label&&!c.hide)}).length;if(C){if(!e.HtmlText&&this.textEnabled&&!$(a.container)){var F={size:e.fontSize*1.1,color:e.grid.color};var w=a.position,z=a.margin,v=a.labelBoxWidth,M=a.labelBoxHeight,E=a.labelBoxMargin,I=q.left+z,G=q.top+z;var L=0;for(D=o.length-1;D>-1;--D){if(!o[D].label||o[D].hide){continue}var j=a.labelFormatter(o[D].label);L=Math.max(L,LogCenterFlotr.measureText(A,j,F).width)}var u=Math.round(v+E*3+L),f=Math.round(C*(E+M)+E);if(w.charAt(0)=="s"){G=q.top+this.plotHeight-(z+f)}if(w.charAt(1)=="e"){I=q.left+this.plotWidth-(z+u)}var B=this.processColor(e.legend.backgroundColor||"rgb(240,240,240)",{opacity:e.legend.backgroundOpacity||0.1});A.fillStyle=B;A.fillRect(I,G,u,f);A.strokeStyle=e.legend.labelBoxBorderColor;A.strokeRect(LogCenterFlotr.toPixel(I),LogCenterFlotr.toPixel(G),u,f);var n=I+E;var l=G+E;for(D=0;D<o.length;D++){if(!o[D].label||o[D].hide){continue}var j=a.labelFormatter(o[D].label);A.fillStyle=o[D].color;A.fillRect(n,l,v-1,M-1);A.strokeStyle=a.labelBoxBorderColor;A.lineWidth=1;A.strokeRect(Math.ceil(n)-1.5,Math.ceil(l)-1.5,v+2,M+2);LogCenterFlotr.drawText(A,j,n+v+E,l+(M+F.size-A.fontDescent(F))/2,F);l+=M+E}}else{for(D=0;D<o.length;++D){if(!o[D].label||o[D].hide){continue}if(D%e.legend.noColumns==0){N.push(b?"</tr><tr>":"<tr>");b=true}var t=o[D],j=a.labelFormatter(t.label),k=a.labelBoxWidth,h=a.labelBoxHeight,d="opacity:"+t.bars.fillOpacity+";filter:alpha(opacity="+t.bars.fillOpacity*100+");",B="background-color:"+((t.bars.show&&t.bars.fillColor&&t.bars.fill)?t.bars.fillColor:t.color)+";";N.push('<td class="flotr-legend-color-box">','<div style="border:1px solid ',a.labelBoxBorderColor,';padding:1px">','<div style="width:',(k-1),"px;height:",(h-1),"px;border:1px solid ",o[D].color,'">','<div style="width:',k,"px;height:",h,"px;",d,B,'"></div>',"</div>","</div>","</td>",'<td class="flotr-legend-label">',j,"</td>")}if(b){N.push("</tr>")}if(N.length>0){var H='<table style="font-size:smaller;color:'+e.grid.color+'">'+N.join("")+"</table>";if(e.legend.container!=null){$(e.legend.container).innerHTML=H}else{var g="",w=e.legend.position,z=e.legend.margin;if(w.charAt(0)=="n"){g+="top:"+(z+q.top)+"px;bottom:auto;"}else{if(w.charAt(0)=="s"){g+="bottom:"+(z+q.bottom)+"px;top:auto;"}}if(w.charAt(1)=="e"){g+="right:"+(z+q.right)+"px;left:auto;"}else{if(w.charAt(1)=="w"){g+="left:"+(z+q.left)+"px;right:auto;"}}var r=this.el.insert('<div class="flotr-legend" style="position:absolute;z-index:2;'+g+'">'+H+"</div>").select("div.flotr-legend")[0];if(e.legend.backgroundOpacity!=0){var K=e.legend.backgroundColor;if(K==null){var J=(e.grid.backgroundColor!=null)?e.grid.backgroundColor:LogCenterFlotr.Color.extract(r);K=this.processColor(J,null,{opacity:1})}this.el.insert('<div class="flotr-legend-bg" style="position:absolute;width:'+r.getWidth()+"px;height:"+r.getHeight()+"px;"+g+"background-color:"+K+';"> </div>').select("div.flotr-legend-bg")[0].setOpacity(e.legend.backgroundOpacity)}}}}}},getEventPosition:function(b){var f=this.overlay.cumulativeOffset(),e=Event.pointer(b),a=this.overlay.cumulativeScrollOffset(),d=(e.x+a.left-f.left-this.plotOffset.left),c=(e.y+a.top-f.top-this.plotOffset.top);return{x:this.axes.x.p2d(d),x2:this.axes.x2.p2d(d),y:this.axes.y.p2d(c),y2:this.axes.y2.p2d(c),relX:d,relY:c,absX:e.x,absY:e.y}},clickHandler:function(a){if(this.ignoreClick){return this.ignoreClick=false}this.el.fire("flotr:click",[this.getEventPosition(a),this])},mouseMoveHandler:function(a){var b=this.getEventPosition(a);this.lastMousePos.pageX=b.absX;this.lastMousePos.pageY=b.absY;if(this.options.crosshair.mode){this.clearCrosshair()}if(this.selectionInterval==null&&(this.options.mouse.track||this.series.any(function(c){return c.mouse&&c.mouse.track}))){this.hit(b)}if(this.options.crosshair.mode){this.drawCrosshair(b)}this.el.fire("flotr:mousemove",[a,b,this])},mouseOutHandler:function(b){var a=this.mouseTrack;if(a){a.hide()}this.clearHit();this.clearCrosshair()},mouseDownHandler:function(c){if(c.isRightClick()){c.stop();var b=this.overlay;b.hide();function a(){b.show();document.stopObserving("mousemove",a)}document.observe("mousemove",a);return}if(!this.options.selection.mode||!c.isLeftClick()){return}this.setSelectionPos(this.selection.first,c);if(this.selectionInterval!=null){clearInterval(this.selectionInterval)}this.lastMousePos.pageX=null;this.selectionInterval=setInterval(this.updateSelection.bindAsEventListener(this),1000/this.options.selection.fps);this.mouseUpHandler=this.mouseUpHandler.bindAsEventListener(this);document.observe("mouseup",this.mouseUpHandler)},fireSelectEvent:function(){var b=this.axes,g=this.selection,d,c,f,e;d=b.x.p2d(g.first.x);c=b.x.p2d(g.second.x);f=b.y.p2d(g.first.y);e=b.y.p2d(g.second.y);this.el.fire("flotr:select",[{x1:Math.min(d,c),y1:Math.min(f,e),x2:Math.max(d,c),y2:Math.max(f,e),xfirst:d,xsecond:c,yfirst:f,ysecond:e},this])},mouseUpHandler:function(a){document.stopObserving("mouseup",this.mouseUpHandler);a.stop();if(this.selectionInterval!=null){clearInterval(this.selectionInterval);this.selectionInterval=null}this.setSelectionPos(this.selection.second,a);this.clearSelection();if(this.selectionIsSane()){this.drawSelection();this.fireSelectEvent();this.ignoreClick=true}},setSelectionPos:function(d,b){var a=this.options,c=this.overlay.cumulativeOffset();if(a.selection.mode.indexOf("x")==-1){d.x=(d==this.selection.first)?0:this.plotWidth}else{d.x=b.pageX-c.left-this.plotOffset.left;d.x=Math.min(Math.max(0,d.x),this.plotWidth)}if(a.selection.mode.indexOf("y")==-1){d.y=(d==this.selection.first)?0:this.plotHeight}else{d.y=b.pageY-c.top-this.plotOffset.top;d.y=Math.min(Math.max(0,d.y),this.plotHeight)}},updateSelection:function(){if(this.lastMousePos.pageX==null){return}this.setSelectionPos(this.selection.second,this.lastMousePos);this.clearSelection();if(this.selectionIsSane()){this.drawSelection()}},clearSelection:function(){if(this.prevSelection==null){return}var g=this.prevSelection,e=this.octx.lineWidth,c=this.plotOffset,a=Math.min(g.first.x,g.second.x),f=Math.min(g.first.y,g.second.y),b=Math.abs(g.second.x-g.first.x),d=Math.abs(g.second.y-g.first.y);this.octx.clearRect(a+c.left-e/2+0.5,f+c.top-e/2+0.5,b+e,d+e);this.prevSelection=null},setSelection:function(b,g){var j=this.options,a=this.axes.x,f=this.axes.y,c=f.scale,h=a.scale,e=j.selection.mode.indexOf("x")!=-1,d=j.selection.mode.indexOf("y")!=-1;this.clearSelection();this.selection.first.y=(e&&!d)?0:(f.max-b.y1)*c;this.selection.second.y=(e&&!d)?this.plotHeight:(f.max-b.y2)*c;this.selection.first.x=(d&&!e)?0:(b.x1-a.min)*h;this.selection.second.x=(d&&!e)?this.plotWidth:(b.x2-a.min)*h;this.drawSelection();if(!g){this.fireSelectEvent()}},drawSelection:function(){var c=this.prevSelection,j=this.selection,g=this.octx,k=this.options,a=this.plotOffset;if(c!=null&&j.first.x==c.first.x&&j.first.y==c.first.y&&j.second.x==c.second.x&&j.second.y==c.second.y){return}g.save();g.strokeStyle=this.processColor(k.selection.color,{opacity:0.8});g.lineWidth=1;g.lineJoin="miter";g.fillStyle=this.processColor(k.selection.color,{opacity:0.4});this.prevSelection={first:{x:j.first.x,y:j.first.y},second:{x:j.second.x,y:j.second.y}};var e=Math.min(j.first.x,j.second.x),d=Math.min(j.first.y,j.second.y),f=Math.abs(j.second.x-j.first.x),b=Math.abs(j.second.y-j.first.y);g.fillRect(e+a.left+0.5,d+a.top+0.5,f,b);g.strokeRect(e+a.left+0.5,d+a.top+0.5,f,b);g.restore()},drawCrosshair:function(f){var d=this.octx,c=this.options,b=this.plotOffset,a=b.left+f.relX+(this.options.crosshair.lineWidth/2),e=b.top+f.relY+0.5;if(f.relX<0||f.relY<0||f.relX>this.plotWidth||f.relY>this.plotHeight){this.el.style.cursor=null;this.el.removeClassName("flotr-crosshair");return}this.lastMousePos.relX=null;this.lastMousePos.relY=null;if(c.crosshair.hideCursor){this.el.style.cursor=Prototype.Browser.Gecko?"none":"url(blank.cur),crosshair";this.el.addClassName("flotr-crosshair")}d.save();d.strokeStyle=c.crosshair.color;d.lineWidth=c.crosshair.lineWidth;d.beginPath();if(c.crosshair.mode.indexOf("x")!=-1){d.moveTo(a,b.top);d.lineTo(a,b.top+this.plotHeight);this.lastMousePos.relX=a}if(c.crosshair.mode.indexOf("y")!=-1){d.moveTo(b.left,e);d.lineTo(b.left+this.plotWidth,e);this.lastMousePos.relY=e}d.stroke();d.restore()},clearCrosshair:function(){var a=this.options;if(this.lastMousePos.relX!=null){this.octx.clearRect(this.lastMousePos.relX-(a.crosshair.lineWidth/2),this.plotOffset.top,a.crosshair.lineWidth,this.plotHeight+1)}if(this.lastMousePos.relY!=null){this.octx.clearRect(this.plotOffset.left,this.lastMousePos.relY-0.5,this.plotWidth+1,1)}},selectionIsSane:function(){return Math.abs(this.selection.second.x-this.selection.first.x)>=5&&Math.abs(this.selection.second.y-this.selection.first.y)>=5},clearHit:function(){if(!this.prevHit){return}var f=this.prevHit,b=this.plotOffset,c=f.series,e=c.bars.lineWidth,h=f.xaxis,a=f.yaxis;if(null===c.mouse.lineColor){return}if(!c.bars.show){var d=c.points.radius;this.octx.clearRect(h.d2p(f.x)+b.left-d*2,a.d2p(f.y)+b.top-d*2,d*3+c.points.lineWidth*3,d*3+c.points.lineWidth*3)}else{var g=c.bars.barWidth;this.octx.clearRect(h.d2p(f.x-g/2)+b.left-e,a.d2p(f.y>=0?f.y:0)+b.top-e,h.d2p(g)+e*2,a.d2p(f.y<0?f.y:0)+e*2)}},drawHit:function(f){var c=this.octx,b=f.series,e=f.xaxis,a=f.yaxis;if(b.mouse.lineColor!=null){c.save();c.lineWidth=b.points.lineWidth;c.strokeStyle=b.mouse.lineColor;c.fillStyle=this.processColor(b.mouse.fillColor||"#ffffff",{opacity:b.mouse.fillOpacity});if(!b.bars.show){c.translate(this.plotOffset.left,this.plotOffset.top);c.beginPath();c.arc(e.d2p(f.x),a.d2p(f.y),b.mouse.radius,0,2*Math.PI,true);c.fill();c.stroke();c.closePath()}else{c.save();c.translate(this.plotOffset.left,this.plotOffset.top);c.beginPath();if(b.mouse.trackAll){c.moveTo(e.d2p(f.x),a.d2p(0));c.lineTo(e.d2p(f.x),a.d2p(f.yaxis.max))}else{var d=b.bars.barWidth;c.moveTo(e.d2p(f.x-(d/2)),a.d2p(0));c.lineTo(e.d2p(f.x-(d/2)),a.d2p(f.y));c.lineTo(e.d2p(f.x+(d/2)),a.d2p(f.y));c.lineTo(e.d2p(f.x+(d/2)),a.d2p(0));if(b.mouse.fillColor){c.fill()}}c.stroke();c.closePath();c.restore()}c.restore()}this.prevHit=f},newHit:function(d){var f=this.series,c=this.options,a,b;for(var e=f.length-1;e>-1;--e){s=f[e];if(!s.mouse.track){continue}for(var j in LogCenterFlotr.graphTypes){if(!this[j].getHit){continue}var g=this[j].getHit(s,d);if(g.index!==undefined){a=s.mouse.trackDecimals;if(a==null||a<0){a=0}b=s.mouse.trackFormatter(g);this.drawTooltip(b,g.x,g.y,s.mouse);this.mouseTrack.fire("flotr:hit",[g,this])}}}},hit:function(u){var r=this.series,f=this.options,J=this.prevHit,t=this.plotOffset,k=this.octx,M,O,a,E,q,o,K,c,z,v,I,D={dist:Number.MAX_VALUE,x:null,y:null,relX:u.relX,relY:u.relY,absX:u.absX,absY:u.absY,mouse:null,xaxis:null,yaxis:null,series:null,index:null,seriesIndex:null},L={x:null,y:null,mouse:null,xaxis:null,yaxis:null,trackFormatter:null};if(f.mouse.trackAll){for(I=0;I<r.length;I++){w=r[0];M=w.data;K=w.xaxis;c=w.yaxis;a=(2*f.points.lineWidth)/K.scale*w.mouse.sensibility;z=K.p2d(u.relX);v=c.p2d(u.relY);for(var H=0;H<M.length;H++){q=M[H][0];o=M[H][1];if(o===null||K.min>q||K.max<q||c.min>o||c.max<o||z<K.min||z>K.max||v<c.min||v>c.max){continue}var A=Math.abs(q-z);if((!w.bars.show&&A<a)||(w.bars.show&&A<w.bars.barWidth/2)||(o<0&&v<0&&v>o)){var e=A;if(e<D.dist){D.dist=e;D.x=q;D.y=o;D.xaxis=K;D.yaxis=c;D.mouse=w.mouse;D.series=w;D.allSeries=r;D.index=H}}}}}else{for(I=0;I<r.length;I++){w=r[I];if(!w.mouse.track){continue}M=w.data;K=w.xaxis;c=w.yaxis;O=2*f.points.lineWidth*w.mouse.sensibility;a=O/K.scale;E=O/c.scale;z=K.p2d(u.relX);v=c.p2d(u.relY);for(var H=0,b,h;H<M.length;H++){q=M[H][0];o=M[H][1];if(o===null||K.min>q||K.max<q||c.min>o||c.max<o){continue}var A=Math.abs(q-z),d=Math.abs(o-v);if(((!w.bars.show)&&A<a&&d<E)||(w.bars.show&&A<w.bars.barWidth/2&&((o>0&&v>0&&v<o)||(o<0&&v<0&&v>o)))){var e=Math.sqrt(A*A+d*d);if(e<D.dist){D.dist=e;D.x=q;D.y=o;D.xaxis=K;D.yaxis=c;D.mouse=w.mouse;D.series=w;D.allSeries=r;D.index=H;D.seriesIndex=I}}}if(f.guides){f.guides.each(function(g){if(!g.mode){return}if(-1!==g.mode.indexOf("y")){if(0===g.value){return}if(Math.abs(c.d2p(g.value)-u.relY)<g.sensibility){L.x=z;L.y=g.value;L.xaxis=K;L.yaxis=c;L.mouse=w.mouse;L.trackFormatter=g.trackFormatter}}},this)}}}if(D.series&&(D.mouse&&D.mouse.track&&!J||(J))){var C=this.mouseTrack,l="",w=D.series,B=D.mouse.position,F=D.mouse.margin,G;if(null!==f.mouse.trackStyle){G="display:none;position:absolute;white-space:nowrap;"+f.mouse.trackStyle}else{G="opacity:0.7;background-color:#000;color:#fff;display:none;position:absolute;padding:2px 8px;-moz-border-radius:4px;border-radius:4px;white-space:nowrap;"}if(!D.mouse.relative){if(B.charAt(0)=="n"){l+="top:"+(F+t.top)+"px;bottom:auto;"}else{if(B.charAt(0)=="s"){l+="bottom:"+(F+t.bottom)+"px;top:auto;"}}if(B.charAt(1)=="e"){l+="right:"+(F+t.right)+"px;left:auto;"}else{if(B.charAt(1)=="w"){l+="left:"+(F+t.left)+"px;right:auto;"}}}else{if(!w.bars.show){if(B.charAt(0)=="n"){l+="bottom:"+(F-t.top-D.yaxis.d2p(D.y)+this.canvasHeight)+"px;top:auto;"}else{if(B.charAt(0)=="s"){l+="top:"+(F+t.top+D.yaxis.d2p(D.y))+"px;bottom:auto;"}}if(B.charAt(1)=="e"){l+="left:"+(F+t.left+D.xaxis.d2p(D.x))+"px;right:auto;"}else{if(B.charAt(1)=="w"){l+="right:"+(F-t.left-D.xaxis.d2p(D.x)+this.canvasWidth)+"px;left:auto;"}}}else{l+="bottom:"+(F-t.top-D.yaxis.d2p(D.y/2)+this.canvasHeight)+"px;top:auto;";l+="left:"+(F+t.left+D.xaxis.d2p(D.x-f.bars.barWidth/2))+"px;right:auto;"}}G+=l;if(!C){this.mouseoverlay.insert('<div class="flotr-mouse-value" style="'+G+'"></div>');C=this.mouseTrack=this.el.select(".flotr-mouse-value")[0]}else{C.style.cssText=G;this.mouseTrack=C}if(D.x!==null&&D.y!==null){C.show();this.clearHit();this.drawHit(D);var N=D.mouse.trackDecimals;if(N==null||N<0){N=0}C.innerHTML=D.mouse.trackFormatter({x:D.x.toFixed(N),y:D.y.toFixed(N),series:D.series,index:D.index,nearest:D,mx:z,my:v});if(D.mouse.relative){this.checkLabelPos(C,B,t,F,D)}C.fire("flotr:hit",[D,this])}else{if(J){C.hide();this.clearHit()}}}else{if(f.guides&&L.mouse){var C=this.mouseTrack,l="",B=L.mouse.position,F=L.mouse.margin,G;if(null!==f.mouse.trackStyle){G="display:none;position:absolute;white-space:nowrap;"+f.mouse.trackStyle}else{G="opacity:0.7;background-color:#000;color:#fff;display:none;position:absolute;padding:2px 8px;-moz-border-radius:4px;border-radius:4px;white-space:nowrap;"}if(!L.mouse.relative){if(B.charAt(0)=="n"){l+="top:"+(F+t.top)+"px;bottom:auto;"}else{if(B.charAt(0)=="s"){l+="bottom:"+(F+t.bottom)+"px;top:auto;"}}if(B.charAt(1)=="e"){l+="right:"+(F+t.right)+"px;left:auto;"}else{if(B.charAt(1)=="w"){l+="left:"+(F+t.left)+"px;right:auto;"}}}else{l+="bottom:"+(F-t.top-L.yaxis.d2p(L.y)+this.canvasHeight)+"px;top:auto;";l+="left:"+(F+t.left+L.xaxis.d2p(L.x))+"px;right:auto;"}G+=l;if(!C){this.mouseoverlay.insert('<div class="flotr-mouse-value" style="'+G+'"></div>');C=this.mouseTrack=this.el.select(".flotr-mouse-value")[0]}else{C.style.cssText=G;this.mouseTrack=C}if(L.x!==null&&L.y!==null){C.show();this.clearHit();C.innerHTML=L.trackFormatter({x:L.x,y:L.y,mx:z,my:v});if(L.mouse.relative){this.checkLabelPos(C,B,t,F,L)}C.fire("flotr:hit",[L,this])}}else{if(this.prevHit){this.mouseTrack.hide();this.clearHit()}}}},checkLabelPos:function(a,d,e,h,f){var j=h+e.top+f.yaxis.d2p(f.y),b=h-e.top-f.yaxis.d2p(f.y)+this.canvasHeight,g=h+e.left+f.xaxis.d2p(f.x),k=h-e.left-f.xaxis.d2p(f.x)+this.canvasWidth,c=$(a).getWidth(),l=$(a).getHeight();if("n"===d.charAt(0)){if(b+l>this.canvasHeight){a.style.top=j+"px";a.style.bottom="auto"}}else{if("s"===d.charAt(0)){if(j+l>this.canvasHeight){a.style.bottom=b+"px";a.style.top="auto"}}}if("e"===d.charAt(1)){if(g+c>this.canvasWidth){a.style.right=k+"px";a.style.left="auto"}}else{if("w"===d.charAt(1)){if(k+c>this.canvasWidth){a.style.left=g+"px";a.style.right="auto"}}}},drawTooltip:function(f,h,g,j){var a=this.mouseTrack,b="opacity:0.7;background-color:#000;color:#fff;display:none;position:absolute;padding:2px 8px;-moz-border-radius:4px;border-radius:4px;white-space:nowrap;",c=j.position,e=j.margin,d=this.plotOffset;if(!a){this.el.insert('<div class="flotr-mouse-value"></div>');a=this.mouseTrack=this.el.select(".flotr-mouse-value")[0]}if(h!==null&&g!==null){if(!j.relative){if(c.charAt(0)=="n"){b+="top:"+(e+d.top)+"px;bottom:auto;"}else{if(c.charAt(0)=="s"){b+="bottom:"+(e+d.bottom)+"px;top:auto;"}}if(c.charAt(1)=="e"){b+="right:"+(e+d.right)+"px;left:auto;"}else{if(c.charAt(1)=="w"){b+="left:"+(e+d.left)+"px;right:auto;"}}}else{if(c.charAt(0)=="n"){b+="bottom:"+(e-d.top-g+this.canvasHeight)+"px;top:auto;"}else{if(c.charAt(0)=="s"){b+="top:"+(e+d.top+g)+"px;bottom:auto;"}}if(c.charAt(1)=="e"){b+="left:"+(e+d.left+h)+"px;right:auto;"}else{if(c.charAt(1)=="w"){b+="right:"+(e-d.left-h+this.canvasWidth)+"px;left:auto;"}}}a.style.cssText=b;a.update(f).show()}else{a.hide()}},saveImage:function(d,c,a,b){var e=null;if(Prototype.Browser.IE){e="<html><body>"+this.canvas.firstChild.innerHTML+"</body></html>";return window.open().document.write(e)}switch(d){case"jpeg":case"jpg":e=Canvas2Image.saveAsJPEG(this.canvas,b,c,a);break;default:case"png":e=Canvas2Image.saveAsPNG(this.canvas,b,c,a);break;case"bmp":e=Canvas2Image.saveAsBMP(this.canvas,b,c,a);break}if(Object.isElement(e)&&b){this.restoreCanvas();this.canvas.hide();this.overlay.hide();this.el.insert(e.setStyle({position:"absolute"}))}},restoreCanvas:function(){this.canvas.show();this.overlay.show();this.el.select("img").invoke("remove")}});LogCenterFlotr.Color=Class.create({initialize:function(h,f,d,e){this.rgba=["r","g","b","a"];var c=4;while(-1<--c){this[this.rgba[c]]=arguments[c]||((c==3)?1:0)}this.normalize()},adjust:function(d,c,e,b){var a=4;while(-1<--a){if(arguments[a]!=null){this[this.rgba[a]]+=arguments[a]}}return this.normalize()},scale:function(d,c,e,b){var a=4;while(-1<--a){if(arguments[a]!=null){this[this.rgba[a]]*=arguments[a]}}return this.normalize()},clone:function(){return new LogCenterFlotr.Color(this.r,this.b,this.g,this.a)},limit:function(b,a,c){return Math.max(Math.min(b,c),a)},normalize:function(){var a=this.limit;this.r=a(parseInt(this.r),0,255);this.g=a(parseInt(this.g),0,255);this.b=a(parseInt(this.b),0,255);this.a=a(this.a,0,1);return this},distance:function(b){if(!b){return}b=new LogCenterFlotr.Color.parse(b);var c=0,a=3;while(-1<--a){c+=Math.abs(this[this.rgba[a]]-b[this.rgba[a]])}return c},toString:function(){return(this.a>=1)?"rgb("+[this.r,this.g,this.b].join(",")+")":"rgba("+[this.r,this.g,this.b,this.a].join(",")+")"}});Object.extend(LogCenterFlotr.Color,{parse:function(b){if(b instanceof LogCenterFlotr.Color){return b}var a,d=LogCenterFlotr.Color;if((a=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(b))){return new d(parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16))}if((a=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(b))){return new d(parseInt(a[1]),parseInt(a[2]),parseInt(a[3]))}if((a=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(b))){return new d(parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16))}if((a=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(b))){return new d(parseInt(a[1]),parseInt(a[2]),parseInt(a[3]),parseFloat(a[4]))}if((a=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(b))){return new d(parseFloat(a[1])*2.55,parseFloat(a[2])*2.55,parseFloat(a[3])*2.55)}if((a=/rgba\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(b))){return new d(parseFloat(a[1])*2.55,parseFloat(a[2])*2.55,parseFloat(a[3])*2.55,parseFloat(a[4]))}var c=(b+"").strip().toLowerCase();if(c=="transparent"){return new d(255,255,255,0)}return(a=d.names[c])?new d(a[0],a[1],a[2]):new d(0,0,0,0)},extract:function(b){var a;do{a=b.getStyle("background-color").toLowerCase();if(!(a==""||a=="transparent")){break}b=b.up()}while(!b.nodeName.match(/^body$/i));return new LogCenterFlotr.Color(a=="rgba(0, 0, 0, 0)"?"transparent":a)},names:{aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0]}});LogCenterFlotr.Date={format:function(j,h){if(!j){return}var g={h:j.getUTCHours().toString(),H:a(j.getUTCHours()),M:a(j.getUTCMinutes()),S:a(j.getUTCSeconds()),s:j.getUTCMilliseconds(),d:j.getUTCDate().toString(),m:(j.getUTCMonth()+1).toString(),y:j.getUTCFullYear().toString(),b:LogCenterFlotr.Date.monthNames[j.getUTCMonth()]};function a(c){c+="";return c.length==1?"0"+c:c}var f=[],k,e=false;for(var b=0;b<h.length;++b){k=h.charAt(b);if(e){f.push(g[k]||k);e=false}else{if(k=="%"){e=true}else{f.push(k)}}}return f.join("")},getFormat:function(c,b){var a=LogCenterFlotr.Date.timeUnits;if(c<a.second){return"%h:%M:%S.%s"}else{if(c<a.minute){return"%h:%M:%S"}else{if(c<a.day){return(b<2*a.day)?"%h:%M":"%b %d %h:%M"}else{if(c<a.month){return"%b %d"}else{if(c<a.year){return(b<a.year)?"%b":"%b %y"}else{return"%y"}}}}}},formatter:function(a,e){var f=new Date(a);if(e.options.timeFormat!=null){return LogCenterFlotr.Date.format(f,e.options.timeFormat)}var c=e.max-e.min,b=e.tickSize*LogCenterFlotr.Date.timeUnits[e.tickUnit];return LogCenterFlotr.Date.format(f,LogCenterFlotr.Date.getFormat(b,c))},generator:function(c){var j=[],h=new Date(c.min),g=LogCenterFlotr.Date.timeUnits;var b=c.tickSize*g[c.tickUnit];switch(c.tickUnit){case"millisecond":h.setUTCMilliseconds(LogCenterFlotr.floorInBase(h.getUTCMilliseconds(),c.tickSize));break;case"second":h.setUTCSeconds(LogCenterFlotr.floorInBase(h.getUTCSeconds(),c.tickSize));break;case"minute":h.setUTCMinutes(LogCenterFlotr.floorInBase(h.getUTCMinutes(),c.tickSize));break;case"hour":h.setUTCHours(LogCenterFlotr.floorInBase(h.getUTCHours(),c.tickSize));break;case"month":h.setUTCMonth(LogCenterFlotr.floorInBase(h.getUTCMonth(),c.tickSize));break;case"year":h.setUTCFullYear(LogCenterFlotr.floorInBase(h.getUTCFullYear(),c.tickSize));break}if(b>=g.second){h.setUTCMilliseconds(0)}if(b>=g.minute){h.setUTCSeconds(0)}if(b>=g.hour){h.setUTCMinutes(0)}if(b>=g.day){h.setUTCHours(0)}if(b>=g.day*4){h.setUTCDate(1)}if(b>=g.year){h.setUTCMonth(0)}var l=0,k=Number.NaN,e;do{e=k;k=h.getTime();if(k>=c.min&&k<=c.max){j.push({v:k,label:LogCenterFlotr.Date.formatter(k,c)})}if(c.tickUnit=="month"){if(c.tickSize<1){h.setUTCDate(1);var a=h.getTime();h.setUTCMonth(h.getUTCMonth()+1);var f=h.getTime();h.setTime(k+l*g.hour+(f-a)*c.tickSize);l=h.getUTCHours();h.setUTCHours(0)}else{h.setUTCMonth(h.getUTCMonth()+c.tickSize)}}else{if(c.tickUnit=="year"){h.setUTCFullYear(h.getUTCFullYear()+c.tickSize)}else{h.setTime(k+b)}}}while(k<c.max&&k!=e);return j},timeUnits:{millisecond:1,second:1000,minute:1000*60,hour:1000*60*60,day:1000*60*60*24,month:1000*60*60*24*30,year:1000*60*60*24*365.2425},spec:[[1,"millisecond"],[20,"millisecond"],[50,"millisecond"],[100,"millisecond"],[200,"millisecond"],[500,"millisecond"],[1,"second"],[2,"second"],[5,"second"],[10,"second"],[30,"second"],[1,"minute"],[2,"minute"],[5,"minute"],[10,"minute"],[30,"minute"],[1,"hour"],[2,"hour"],[4,"hour"],[8,"hour"],[12,"hour"],[1,"day"],[2,"day"],[3,"day"],[0.25,"month"],[0.5,"month"],[1,"month"],[2,"month"],[3,"month"],[6,"month"],[1,"year"]],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]};LogCenterFlotr.addType("lines",{options:{show:false,lineWidth:2,fill:false,fillColor:null,fillOpacity:0.4},draw:function(c){c=c||this.series;var b=this.ctx;b.save();b.translate(this.plotOffset.left,this.plotOffset.top);b.lineJoin="round";var d=c.lines.lineWidth;var a=c.shadowSize;if(a>0){b.lineWidth=a/2;var e=d/2+b.lineWidth/2;b.strokeStyle="rgba(0,0,0,0.1)";this.lines.plot(c,e+a/2);b.strokeStyle="rgba(0,0,0,0.2)";this.lines.plot(c,e);if(c.lines.fill){b.fillStyle="rgba(0,0,0,0.05)";this.lines.plotArea(c,e+a/2)}}b.lineWidth=d;b.strokeStyle=c.color;if(c.lines.fill){b.fillStyle=this.processColor(c.lines.fillColor||c.color,{opacity:c.lines.fillOpacity});this.lines.plotArea(c,0)}if(0<d){this.lines.plot(c,0)}b.restore()},plot:function(j,g){var o=this.ctx,a=j.xaxis,l=j.yaxis,h=j.data,e=h.length-1,k;if(h.length<2){return}var f=a.d2p(h[0][0]),d=l.d2p(h[0][1])+g;o.beginPath();o.moveTo(f,d);for(k=0;k<e;++k){var c=h[k][0],n=h[k][1],b=h[k+1][0],m=h[k+1][1];if(n===null||m===null){continue}if(n<=m&&n<l.min){if(m<l.min){continue}c=(l.min-n)/(m-n)*(b-c)+c;n=l.min}else{if(m<=n&&m<l.min){if(n<l.min){continue}b=(l.min-n)/(m-n)*(b-c)+c;m=l.min}}if(n>=m&&n>l.max){if(m>l.max){continue}c=(l.max-n)/(m-n)*(b-c)+c;n=l.max}else{if(m>=n&&m>l.max){if(n>l.max){continue}b=(l.max-n)/(m-n)*(b-c)+c;m=l.max}}if(c<=b&&c<a.min){if(b<a.min){continue}n=(a.min-c)/(b-c)*(m-n)+n;c=a.min}else{if(b<=c&&b<a.min){if(c<a.min){continue}m=(a.min-c)/(b-c)*(m-n)+n;b=a.min}}if(c>=b&&c>a.max){if(b>a.max){continue}n=(a.max-c)/(b-c)*(m-n)+n;c=a.max}else{if(b>=c&&b>a.max){if(c>a.max){continue}m=(a.max-c)/(b-c)*(m-n)+n;b=a.max}}if(f!=a.d2p(c)||d!=l.d2p(n)+g){o.moveTo(a.d2p(c),l.d2p(n)+g)}f=a.d2p(b);d=l.d2p(m)+g;o.lineTo(f,d)}o.stroke();o.closePath()},plotArea:function(k,e){var n=this.ctx,r=k.xaxis,b=k.yaxis,u=k.data,d=u.length-1,m,h=Math.min(Math.max(0,b.min),b.max),g=0,f=true;if(u.length<2){return}n.beginPath();for(var o=0;o<d;++o){var t=u[o][0],c=u[o][1],q=u[o+1][0],a=u[o+1][1];if(t<=q&&t<r.min){if(q<r.min){continue}c=(r.min-t)/(q-t)*(a-c)+c;t=r.min}else{if(q<=t&&q<r.min){if(t<r.min){continue}a=(r.min-t)/(q-t)*(a-c)+c;q=r.min}}if(t>=q&&t>r.max){if(q>r.max){continue}c=(r.max-t)/(q-t)*(a-c)+c;t=r.max}else{if(q>=t&&q>r.max){if(t>r.max){continue}a=(r.max-t)/(q-t)*(a-c)+c;q=r.max}}if(f){n.moveTo(r.d2p(t),b.d2p(h)+e);f=false}if(c>=b.max&&a>=b.max){n.lineTo(r.d2p(t),b.d2p(b.max)+e);n.lineTo(r.d2p(q),b.d2p(b.max)+e);continue}else{if(c<=b.min&&a<=b.min){n.lineTo(r.d2p(t),b.d2p(b.min)+e);n.lineTo(r.d2p(q),b.d2p(b.min)+e);continue}}var j=t,l=q;if(c<=a&&c<b.min&&a>=b.min){t=(b.min-c)/(a-c)*(q-t)+t;c=b.min}else{if(a<=c&&a<b.min&&c>=b.min){q=(b.min-c)/(a-c)*(q-t)+t;a=b.min}}if(c>=a&&c>b.max&&a<=b.max){t=(b.max-c)/(a-c)*(q-t)+t;c=b.max}else{if(a>=c&&a>b.max&&c<=b.max){q=(b.max-c)/(a-c)*(q-t)+t;a=b.max}}if(t!=j){m=(c<=b.min)?m=b.min:b.max;n.lineTo(r.d2p(j),b.d2p(m)+e);n.lineTo(r.d2p(t),b.d2p(m)+e)}n.lineTo(r.d2p(t),b.d2p(c)+e);n.lineTo(r.d2p(q),b.d2p(a)+e);if(q!=l){m=(a<=b.min)?b.min:b.max;n.lineTo(r.d2p(l),b.d2p(m)+e);n.lineTo(r.d2p(q),b.d2p(m)+e)}g=Math.max(q,l)}n.lineTo(r.d2p(r.max),b.d2p(h)+e);n.closePath();n.fill()}});LogCenterFlotr.addType("bars",{options:{show:false,lineWidth:2,barWidth:1,fill:true,fillColor:null,fillOpacity:0.4,horizontal:false,stacked:false,centered:true},draw:function(c){var a=this.ctx,e=c.bars.barWidth,d=Math.min(c.bars.lineWidth,e);a.save();a.translate(this.plotOffset.left,this.plotOffset.top);a.lineJoin="miter";a.lineWidth=d;a.strokeStyle=c.color;a.save();this.bars.plotShadows(c,e,0,c.bars.fill);a.restore();if(c.bars.fill){var b=c.bars.fillColor||c.color;a.fillStyle=this.processColor(b,{opacity:c.bars.fillOpacity})}this.bars.plot(c,e,0,c.bars.fill);a.restore()},plot:function(k,n,d,q){var v=k.data;if(v.length<1){return}var t=k.xaxis,b=k.yaxis,o=this.ctx,r;for(r=0;r<v.length;r++){var j=v[r][0],h=v[r][1],e=true,l=true,a=true;if(h===null){continue}var g=0;if(k.bars.stacked){$H(t.values).each(function(w){if(w.key==j){g=w.value.stack||0;w.value.stack=g+h}})}if(k.bars.horizontal){var c=g,u=j+g,f=h,m=h+n}else{var c=j-(k.bars.centered?n/2:0),u=j+n-(k.bars.centered?n/2:0),f=g,m=h+g}if(u<t.min||c>t.max||m<b.min||f>b.max){continue}if(c<t.min){c=t.min;e=false}if(u>t.max){u=t.max;if(t.lastSerie!=k&&k.bars.horizontal){l=false}}if(f<b.min){f=b.min}if(m>b.max){m=b.max;if(b.lastSerie!=k&&!k.bars.horizontal){l=false}}if(q){o.beginPath();o.moveTo(t.d2p(c),b.d2p(f)+d);o.lineTo(t.d2p(c),b.d2p(m)+d);o.lineTo(t.d2p(u),b.d2p(m)+d);o.lineTo(t.d2p(u),b.d2p(f)+d);o.fill();o.closePath()}if(k.bars.lineWidth!=0&&(e||a||l)){o.beginPath();o.moveTo(t.d2p(c),b.d2p(f)+d);o[e?"lineTo":"moveTo"](t.d2p(c),b.d2p(m)+d);o[l?"lineTo":"moveTo"](t.d2p(u),b.d2p(m)+d);o[a?"lineTo":"moveTo"](t.d2p(u),b.d2p(f)+d);o.stroke();o.closePath()}}},plotShadows:function(h,j,c){var u=h.data;if(u.length<1){return}var q,g,f,r=h.xaxis,a=h.yaxis,o=this.ctx,m=this.options.shadowSize;for(q=0;q<u.length;q++){g=u[q][0];f=u[q][1];if(f===null){continue}var d=0;if(h.bars.stacked){$H(r.values).each(function(v){if(v.key==g){d=v.value.stackShadow||0;v.value.stackShadow=d+f}})}if(h.bars.horizontal){var b=d,t=g+d,e=f,k=f+j}else{var b=g-(h.bars.centered?j/2:0),t=g+j-(h.bars.centered?j/2:0),e=d,k=f+d}if(t<r.min||b>r.max||k<a.min||e>a.max){continue}if(b<r.min){b=r.min}if(t>r.max){t=r.max}if(e<a.min){e=a.min}if(k>a.max){k=a.max}var n=r.d2p(t)-r.d2p(b)-((r.d2p(t)+m<=this.plotWidth)?0:m);var l=Math.max(0,a.d2p(e)-a.d2p(k)-((a.d2p(e)+m<=this.plotHeight)?0:m));o.fillStyle="rgba(0,0,0,0.05)";o.fillRect(Math.min(r.d2p(b)+m,this.plotWidth),Math.min(a.d2p(k)+m,this.plotWidth),n,l)}},extendXRange:function(a){if(a.options.max==null){var c=a.min,g=a.max,e,d,k,m,h,l=[],f=null;for(e=0;e<this.series.length;++e){m=this.series[e];h=m.bars;if(h.show&&m.xaxis==a){if(h.centered){g=Math.max(a.datamax+0.5,g);c=Math.min(a.datamin-0.5,c)}if(!h.horizontal&&(h.barWidth+a.datamax>g)){g=a.max+(h.centered?h.barWidth/2:h.barWidth)}if(h.stacked&&h.horizontal){for(d=0;d<m.data.length;d++){if(h.show&&h.stacked){k=m.data[d][0]+"";l[k]=(l[k]||0)+m.data[d][1];f=m}}for(d in l){g=Math.max(l[d],g)}}}}a.lastSerie=f;a.max=g;a.min=c}},extendYRange:function(a){if(a.options.max==null){var f=a.max,h,d,c,l,g,k={},e=null;for(d=0;d<this.series.length;++d){l=this.series[d];g=l.bars;if(g.show&&!l.hide&&l.yaxis==a){if(g.horizontal&&(g.barWidth+a.datamax>f)){f=a.max+g.barWidth}if(g.stacked&&!g.horizontal){for(c=0;c<l.data.length;c++){if(l.bars.show&&l.bars.stacked){h=l.data[c][0]+"";k[h]=(k[h]||0)+l.data[c][1];e=l}}for(c in k){f=Math.max(k[c],f)}}}}a.lastSerie=e;a.max=f}}});LogCenterFlotr.addType("points",{options:{show:false,radius:3,lineWidth:2,fill:true,fillColor:"#FFFFFF",fillOpacity:0.4},draw:function(c){var b=this.ctx,d=c.lines.lineWidth,a=c.shadowSize;b.save();b.translate(this.plotOffset.left,this.plotOffset.top);if(a>0){b.lineWidth=a/2;b.strokeStyle="rgba(0,0,0,0.1)";this.points.plotShadows(c,a/2+b.lineWidth/2,c.points.radius);b.strokeStyle="rgba(0,0,0,0.2)";this.points.plotShadows(c,b.lineWidth/2,c.points.radius)}b.lineWidth=c.points.lineWidth;b.strokeStyle=c.color;b.fillStyle=c.points.fillColor!=null?c.points.fillColor:c.color;this.points.plot(c,c.points.radius,c.points.fill);b.restore()},plot:function(c,e,h){var a=c.xaxis,f=c.yaxis,j=this.ctx,d,g,b=c.data;for(d=b.length-1;d>-1;--d){g=b[d][0],y=b[d][1];if(y===null||g<a.min||g>a.max||y<f.min||y>f.max){continue}j.beginPath();j.arc(a.d2p(g),f.d2p(y),e,0,2*Math.PI,true);if(h){j.fill()}j.stroke();j.closePath()}},plotShadows:function(d,b,f){var a=d.xaxis,g=d.yaxis,j=this.ctx,e,h,c=d.data;for(e=c.length-1;e>-1;--e){h=c[e][0],y=c[e][1];if(y===null||h<a.min||h>a.max||y<g.min||y>g.max){continue}j.beginPath();j.arc(a.d2p(h),g.d2p(y)+b,f,0,Math.PI,false);j.stroke();j.closePath()}},getHit:function(g,n){var e,c,h,j,l,q,m,b=g.points,f=g.data,k=g.mouse.sensibility*(b.lineWidth+b.radius),a={index:null,series:g,distance:Number.MAX_VALUE,x:null,y:null,precision:1};for(h=f.length-1;h>-1;--h){j=f[h];q=g.xaxis.d2p(j[0]);m=g.yaxis.d2p(j[1]);e=q-n.relX;c=m-n.relY;l=Math.sqrt(e*e+c*c);if(l<k&&l<a.distance){a={index:h,series:g,distance:l,data:j,x:q,y:m,precision:1}}}return a},drawHit:function(b,a){},clearHit:function(b,a){}});LogCenterFlotr.defaultPieLabelFormatter=function(a){return(a.fraction*100).toFixed(2)+"%"};LogCenterFlotr.addType("pie",{options:{show:false,lineWidth:1,fill:true,fillColor:null,fillOpacity:0.6,explode:6,sizeRatio:0.6,startAngle:Math.PI/4,labelFormatter:LogCenterFlotr.defaultPieLabelFormatter,pie3D:false,pie3DviewAngle:(Math.PI/2*0.8),pie3DspliceThickness:20},draw:function(g){if(this.options.pie.drawn){return}var m=this.ctx,c=this.options,e=g.pie.lineWidth,k=g.shadowSize,v=g.data,h=this.plotOffset,d=(Math.min(this.canvasWidth,this.canvasHeight)*g.pie.sizeRatio)/2,j=[],n=1,t=Math.sin(g.pie.viewAngle)*g.pie.spliceThickness/n,o={size:c.fontSize*1.2,color:c.grid.color,weight:1.5},u={x:h.left+(this.plotWidth)/2,y:h.top+(this.plotHeight)/2},r=this.series.collect(function(x,w){if(x.pie.show&&x.data[0][1]!==null){return{name:(x.label||x.data[0][1]),value:[w,x.data[0][1]],options:x.pie,series:x}}}),b=r.pluck("value").pluck(1).inject(0,function(w,x){return w+x}),f=0,q=g.pie.startAngle,l=0;var a=r.collect(function(w){q+=f;l=parseFloat(w.value[1]);f=l/b;return{name:w.name,fraction:f,x:w.value[0],y:l,value:l,options:w.options,series:w.series,startAngle:2*q*Math.PI,endAngle:2*(q+f)*Math.PI}});m.save();if(k>0){a.each(function(A){if(A.startAngle==A.endAngle){return}var w=(A.startAngle+A.endAngle)/2,x=u.x+Math.cos(w)*A.options.explode+k,z=u.y+Math.sin(w)*A.options.explode+k;this.pie.plotSlice(x,z,d,A.startAngle,A.endAngle,false,n);if(g.pie.fill){m.fillStyle="rgba(0,0,0,0.1)";m.fill()}},this)}if(c.HtmlText||!this.textEnabled){j=['<div style="color:'+this.options.grid.color+'" class="flotr-labels">']}a.each(function(J,E){if(J.startAngle==J.endAngle){return}var D=(J.startAngle+J.endAngle)/2,C=J.series.color,x=J.options.fillColor||C,F=u.x+Math.cos(D)*J.options.explode,A=u.y+Math.sin(D)*J.options.explode;this.pie.plotSlice(F,A,d,J.startAngle,J.endAngle,false,n);if(g.pie.fill){m.fillStyle=this.processColor(x,{opacity:g.pie.fillOpacity});m.fill()}m.lineWidth=e;m.strokeStyle=C;m.stroke();var I=c.pie.labelFormatter(J),w=(Math.cos(D)<0),K=(Math.sin(D)>0),B=(J.options.explode||g.pie.explode)+d+4,H=u.x+Math.cos(D)*B,G=u.y+Math.sin(D)*B;if(J.fraction&&I){if(c.HtmlText||!this.textEnabled){var z="position:absolute;top:"+(G-5)+"px;";if(w){z+="right:"+(this.canvasWidth-H)+"px;text-align:right;"}else{z+="left:"+H+"px;text-align:left;"}j.push('<div style="',z,'" class="flotr-grid-label">',I,"</div>")}else{o.textAlign=w?"right":"left";o.textBaseline=K?"top":"bottom";LogCenterFlotr.drawText(m,I,H,G,o)}}},this);if(c.HtmlText||!this.textEnabled){j.push("</div>");this.el.insert(j.join(""))}m.restore();c.pie.drawn=true},plotSlice:function(b,h,a,e,d,f,g){var c=this.ctx;g=g||1;c.scale(1,g);c.beginPath();c.moveTo(b,h);c.arc(b,h,a,e,d,f);c.lineTo(b,h);c.closePath()}});LogCenterFlotr.addType("candles",{options:{show:false,lineWidth:1,wickLineWidth:1,candleWidth:0.6,fill:true,upFillColor:"#00A8F0",downFillColor:"#CB4B4B",fillOpacity:0.5,barcharts:false},draw:function(b){var a=this.ctx,c=b.candles.candleWidth;a.save();a.translate(this.plotOffset.left,this.plotOffset.top);a.lineJoin="miter";a.lineWidth=b.candles.lineWidth;this.candles.plotShadows(b,c/2);this.candles.plot(b,c/2);a.restore()},plot:function(l,e){var A=l.data;if(A.length<1){return}var v=l.xaxis,b=l.yaxis,q=this.ctx;for(var u=0;u<A.length;u++){var w=A[u],k=w[0],m=w[1],j=w[2],B=w[3],n=w[4];var c=k-l.candles.candleWidth/2,z=k+l.candles.candleWidth/2,g=Math.max(b.min,B),o=Math.min(b.max,j),a=Math.max(b.min,Math.min(m,n)),t=Math.min(b.max,Math.max(m,n));if(z<v.min||c>v.max||o<b.min||g>b.max){continue}var r=l.candles[m>n?"downFillColor":"upFillColor"];if(l.candles.fill&&!l.candles.barcharts){q.fillStyle=this.processColor(r,{opacity:l.candles.fillOpacity});q.fillRect(v.d2p(c),b.d2p(t)+e,v.d2p(z)-v.d2p(c),b.d2p(a)-b.d2p(t))}if(l.candles.lineWidth||l.candles.wickLineWidth){var k,h,f=(l.candles.wickLineWidth%2)/2;k=Math.floor(v.d2p((c+z)/2))+f;q.save();q.strokeStyle=r;q.lineWidth=l.candles.wickLineWidth;q.lineCap="butt";if(l.candles.barcharts){q.beginPath();q.moveTo(k,Math.floor(b.d2p(o)+e));q.lineTo(k,Math.floor(b.d2p(g)+e));h=Math.floor(b.d2p(m)+e)+0.5;q.moveTo(Math.floor(v.d2p(c))+f,h);q.lineTo(k,h);h=Math.floor(b.d2p(n)+e)+0.5;q.moveTo(Math.floor(v.d2p(z))+f,h);q.lineTo(k,h)}else{q.strokeRect(v.d2p(c),b.d2p(t)+e,v.d2p(z)-v.d2p(c),b.d2p(a)-b.d2p(t));q.beginPath();q.moveTo(k,Math.floor(b.d2p(t)+e));q.lineTo(k,Math.floor(b.d2p(o)+e));q.moveTo(k,Math.floor(b.d2p(a)+e));q.lineTo(k,Math.floor(b.d2p(g)+e))}q.stroke();q.closePath();q.restore()}}},plotShadows:function(h,c){var v=h.data;if(v.length<1||h.candles.barcharts){return}var r=h.xaxis,a=h.yaxis,n=this.options.shadowSize;for(var q=0;q<v.length;q++){var t=v[q],g=t[0],j=t[1],f=t[2],w=t[3],k=t[4];var b=g-h.candles.candleWidth/2,u=g+h.candles.candleWidth/2,e=Math.max(a.min,Math.min(j,k)),l=Math.min(a.max,Math.max(j,k));if(u<r.min||b>r.max||l<a.min||e>a.max){continue}var o=r.d2p(u)-r.d2p(b)-((r.d2p(u)+n<=this.plotWidth)?0:n);var m=Math.max(0,a.d2p(e)-a.d2p(l)-((a.d2p(e)+n<=this.plotHeight)?0:n));this.ctx.fillStyle="rgba(0,0,0,0.05)";this.ctx.fillRect(Math.min(r.d2p(b)+n,this.plotWidth),Math.min(a.d2p(l)+n,this.plotWidth),o,m)}},extendXRange:function(d){if(d.options.max==null){var a=d.min,e=d.max,b,f;for(b=0;b<this.series.length;++b){f=this.series[b].candles;if(f.show&&this.series[b].xaxis==d){e=Math.max(d.datamax+0.5,e);a=Math.min(d.datamin-0.5,a)}}d.max=e;d.min=a}}});LogCenterFlotr.defaultMarkerFormatter=function(a){return(Math.round(a.y*100)/100)+""};LogCenterFlotr.addType("markers",{options:{show:false,lineWidth:1,fill:false,fillColor:"#FFFFFF",fillOpacity:0.4,stroke:false,position:"ct",labelFormatter:LogCenterFlotr.defaultMarkerFormatter},draw:function(d){d=d||this.series;var l=this.ctx,a=d.xaxis,g=d.yaxis,m=d.markers,c=d.data;l.save();l.translate(this.plotOffset.left,this.plotOffset.top);l.lineJoin="round";l.lineWidth=m.lineWidth;l.strokeStyle="rgba(0,0,0,0.5)";l.fillStyle=this.processColor(m.fillColor,{opacity:m.fillOpacity});for(var e=0;e<c.length;++e){var k=c[e][0],f=a.d2p(k),h=c[e][1],b=g.d2p(h),j=m.labelFormatter({x:k,y:h,index:e,data:c});this.markers.plot(f,b,j,m)}l.restore()},plot:function(g,e,f,j){var h=this.ctx,c=this.getTextDimensions(f,null,null),b=2,a=g,d=e;c.width=Math.floor(c.width+b*2);c.height=Math.floor(c.height+b*2);if(j.position.indexOf("c")!=-1){a-=c.width/2+b}else{if(j.position.indexOf("l")!=-1){a-=c.width}}if(j.position.indexOf("m")!=-1){d-=c.height/2+b}else{if(j.position.indexOf("t")!=-1){d-=c.height}}a=Math.floor(a)+0.5;d=Math.floor(d)+0.5;if(j.fill){h.fillRect(a,d,c.width,c.height)}if(j.stroke){h.strokeRect(a,d,c.width,c.height)}LogCenterFlotr.drawText(h,f,a+b,d+b,{textBaseline:"top",textAlign:"left"})}});LogCenterFlotr.addType("radar",{options:{show:false,lineWidth:2,fill:true,fillOpacity:0.4,radiusRatio:0.9},draw:function(c){var a=this.ctx,b=this.options;a.save();a.translate(this.plotOffset.left+this.plotWidth/2,this.plotOffset.top+this.plotHeight/2);a.lineWidth=c.radar.lineWidth;a.fillStyle="rgba(0,0,0,0.05)";a.strokeStyle="rgba(0,0,0,0.05)";this.radar.plot(c,c.shadowSize/2);a.strokeStyle="rgba(0,0,0,0.1)";this.radar.plot(c,c.shadowSize/4);a.strokeStyle=c.color;a.fillStyle=this.processColor(c.color,{opacity:c.radar.fillOpacity});this.radar.plot(c);a.restore()},plot:function(e,b){var l=this.ctx,m=this.options,d=e.data,g=Math.min(this.plotHeight,this.plotWidth)*m.radar.radiusRatio/2,f=2*(Math.PI/d.length),a=-Math.PI/2;b=b||0;l.beginPath();for(var c=0;c<d.length;++c){var k=d[c][0],j=d[c][1],h=j/this.axes.y.max;l[c==0?"moveTo":"lineTo"](Math.cos(c*f+a)*g*h+b,Math.sin(c*f+a)*g*h+b)}l.closePath();if(e.radar.fill){l.fill()}l.stroke()}});LogCenterFlotr.addType("bubbles",{options:{show:false,lineWidth:2,fill:true,fillOpacity:0.4,baseRadius:2},draw:function(c){var a=this.ctx,b=this.options;a.save();a.translate(this.plotOffset.left,this.plotOffset.top);a.lineWidth=c.bubbles.lineWidth;a.fillStyle="rgba(0,0,0,0.05)";a.strokeStyle="rgba(0,0,0,0.05)";this.bubbles.plot(c,c.shadowSize/2);a.strokeStyle="rgba(0,0,0,0.1)";this.bubbles.plot(c,c.shadowSize/4);a.strokeStyle=c.color;a.fillStyle=this.processColor(c.color,{opacity:c.radar.fillOpacity});this.bubbles.plot(c);a.restore()},plot:function(c,a){var j=this.ctx,k=this.options,b=c.data,e=k.bubbles.baseRadius;a=a||0;for(var d=0;d<b.length;++d){var h=b[d][0],g=b[d][1],f=b[d][2];j.beginPath();j.arc(c.xaxis.d2p(h)+a,c.yaxis.d2p(g)+a,e*f,0,Math.PI*2,true);j.stroke();if(c.bubbles.fill){j.fill()}j.closePath()}}});Ext.ns("SYNO.SDS.LogCenter.Util");SYNO.SDS.LogCenter.DEV_MAX=3;SYNO.SDS.LogCenter.LIST_LOGSTATUS=0;SYNO.SDS.LogCenter.LIST_LOGSEARCH=1;SYNO.SDS.LogCenter.LIST_SVR=2;SYNO.SDS.LogCenter.LIST_ARCH=3;SYNO.SDS.LogCenter.LIST_NOTIFY=4;SYNO.SDS.LogCenter.LIST_LOG=5;SYNO.SDS.LogCenter.SCALE_6MIN=0;SYNO.SDS.LogCenter.SCALE_1HR=1;SYNO.SDS.LogCenter.SCALE_6HR=2;SYNO.SDS.LogCenter.SCALE_1DAY=3;SYNO.SDS.LogCenter.ScaleMapping=[_TT("SYNO.SDS.LogCenter.Instance","logstatus","interval_6_mins"),_TT("SYNO.SDS.LogCenter.Instance","logstatus","interval_1_hour"),_TT("SYNO.SDS.LogCenter.Instance","logstatus","interval_6_hours"),_TT("SYNO.SDS.LogCenter.Instance","logstatus","interval_1_day")];SYNO.SDS.LogCenter.WidthEditField=200;SYNO.SDS.LogCenter.LevelMapping={emerg:"Emergency",alert:"Alert",crit:_T("log","crit_level"),err:_T("log","error_level"),warn:_T("log","warn_level"),warning:_T("log","warn_level"),notice:"Notice",info:_T("log","info_level"),debug:"Debug",any:"Any"};SYNO.SDS.LogCenter.multiAttriWinTitle=function(b){var a={prio:SYNO.SDS.LogCenter.StringGet("logattr","title_select_prio"),prog:SYNO.SDS.LogCenter.StringGet("logattr","title_select_prog"),host:SYNO.SDS.LogCenter.StringGet("logattr","title_select_host"),fac:SYNO.SDS.LogCenter.StringGet("logattr","title_select_fac")};return a[b]};SYNO.SDS.LogCenter.logAttriStringGet=function(a){if("Any"===a){return"any"}return a};SYNO.SDS.LogCenter.StringGet=function(c,a){var b=_TT("SYNO.SDS.LogCenter.Instance",c,a);if(undefined===b||null===b||""===b){return _T(c,a)}return b};SYNO.SDS.LogCenter.RenderLevelIcon=function(d,a){var b=0;var c=1;if(b===parseInt(d,10)){return SYNO.SDS.LogCenter.LevelRenderer("info",a)}else{if(c===parseInt(d,10)){return SYNO.SDS.LogCenter.LevelRenderer("warning",a)}else{return SYNO.SDS.LogCenter.LevelRenderer("alert",a)}}};SYNO.SDS.LogCenter.LevelRenderer=function(b,a){switch(b){case"emerg":case"alert":case"crit":case"err":return"<span style='color:red;'>"+SYNO.SDS.LogCenter.LevelMapping[b]+"</span>";case"warn":case"warning":case"notice":return"<span style='color:#FFA500;'>"+SYNO.SDS.LogCenter.LevelMapping[b]+"</span>";case"info":case"debug":return"<span style='color:green;'>"+SYNO.SDS.LogCenter.LevelMapping[b]+"</span>";default:return"Undefined"}};SYNO.SDS.LogCenter.RenderLogContent=function(b,a){if(null!==a){a.attr='ext:qtip="'+b+'"'}return b};SYNO.SDS.LogCenter.TransModeRenderer=function(a){if("udp"===a){return"UDP"}else{return"TCP"}};SYNO.SDS.LogCenter.LogRenderer=function(c,b){var a=Ext.util.Format.htmlEncode(c);b.attr='ext:qtip="'+Ext.util.Format.htmlEncode(a)+'"';return a};SYNO.SDS.LogCenter.logRotateDayToStr=function(a){var b={"0":_TT("SYNO.SDS.LogCenter.Instance","svrinfo","rotate_never"),"182":_TT("SYNO.SDS.LogCenter.Instance","svrinfo","rotate_sixmonth"),"365":_TT("SYNO.SDS.LogCenter.Instance","svrinfo","rotate_oneyear"),"730":_TT("SYNO.SDS.LogCenter.Instance","svrinfo","rotate_twoyear"),"1095":_TT("SYNO.SDS.LogCenter.Instance","svrinfo","rotate_threeyear")};return b[a]};SYNO.SDS.LogCenter.pageRecordStoreGet=function(){var a=new Ext.data.SimpleStore({fields:["value","display"],data:[[25,25],[50,50],[75,75],[100,100],[150,150],[200,200],[300,300]]});return a};SYNO.SDS.LogCenter.runTimeFormat=function(d){if(0>=d){return"0 hour(s) 0 min(s) 0 sec(s)"}var e=d,a=0,b=0,c=0;a=Math.floor(d/3600);e-=(a*3600);b=Math.floor(e/60);e-=(b*60);c=e;return(a+" hour(s) "+b+" min(s) "+c+" sec(s)")};SYNO.SDS.LogCenter.TimeGet=function(e){var c=new Date(e);var a=c.getHours().toString();var b=c.getMinutes().toString();if(1===a.length){a="0"+a}if(1===b.length){b="0"+b}return a+":"+b};SYNO.SDS.LogCenter.FlotrTimeGet=function(g){function a(d){return(1===d.length)?"0"+d:d}var f=new Date(g);var h=a((f.getMonth()+1).toString());var c=a(f.getDate().toString());var b=a(f.getHours().toString());var e=a(f.getMinutes().toString());return h+"/"+c+" "+b+":"+e};SYNO.SDS.LogCenter.clone=function(b){if(null===b||"object"!==typeof b){return b}var c=b.constructor();for(var a in b){if(b.hasOwnProperty(a)){c[a]=b[a]}}return c};Ext.apply(LogCenterFlotr.Date,{format:function(j,h){if(!j){return}function a(c){c+="";return c.length===1?"0"+c:c}var g={h:j.getHours().toString(),H:a(j.getHours()),M:a(j.getMinutes()),S:a(j.getSeconds()),s:j.getMilliseconds(),d:j.getDate().toString(),m:(j.getMonth()+1).toString(),y:j.getFullYear().toString(),b:Flotr.Date.monthNames[j.getMonth()],p:j.getHours()>=12?"pm":"am"};var f=[],k,e=false;for(var b=0;b<h.length;++b){k=h.charAt(b);if(e){f.push(g[k]||k);e=false}else{if(k==="%"){e=true}else{f.push(k)}}}return f.join("")}});SYNO.SDS.LogCenter.Utils={logTypeRenderer:function(b){var a="";switch(b){case"syslog":a=_T("log","log_link_system");break;case"connlog":a=_T("log","log_link_connection");break;case"ftpxfer":a=_T("log","log_ftp_xfer");break;case"dsmfmxfer":a=_T("log","log_webdav_xfer");break;case"webdavxfer":a=_T("log","log_link_connection");break;case"smbxfer":a=_T("log","log_smb_xfer");break;case"afpxfer":a=_T("log","log_afp_xfer");break;case"tftpxfer":a=_T("log","log_tftp_xfer");break;case"bkplog":a=_T("log","log_link_backup");break;case"copylog":a=_T("log","log_link_copy");break;case"netbkplog":a=_T("log","log_link_netbkp");break;case"bkpserverlog":a=_T("log","log_link_backup_server");break;case"cmslog":a="CMS";break;case"disklog":a=_T("log","disk_related");break;default:a=_T("log","log_link_system")}return a},datetimeRenderer:function(b,a){var c=SYNO.SDS.DateTimeFormatter(new Date(b),{type:"datetimesec"});a.attr='ext:qtip="'+Ext.util.Format.htmlEncode(c)+'"';return c},htmlEncodeRender:function(c,b){var a=Ext.util.Format.htmlEncode(c);b.attr='ext:qtip="'+Ext.util.Format.htmlEncode(a)+'"';return a},isPackageInstall:function(b){var a=false;Ext.ComponentMgr.all.each(function(d){if(d.externalDeviceJson&&d.externalDeviceJson.data&&d.externalDeviceJson.data.packages){a=(b in d.externalDeviceJson.data.packages);return false}});return a}};Ext.define("SYNO.SDS.LogCenter.TodayTipDateFieldPlugin",{extend:"Ext.Component",todayTip:"{0}",init:function(a){if(a.menu===null){a.menu=new Ext.menu.DateMenu({hideOnClick:false,focusOnSelect:false});a.menu.picker.todayTip=this.todayTip}}});Ext.preg("todaytipdatefieldplugin",SYNO.SDS.LogCenter.TodayTipDateFieldPlugin);Ext.define("SYNO.SDS.LogCenter.MenuTextColumnModelPlugin",{extend:"Ext.Component",init:function(a){var c=a.getView(),b=a.getColumnModel();b.getColumnMenuText=this.getColumnMenuText;c.beforeColMenuShow=this.beforeColMenuShow},getColumnMenuText:function(a){return this.config[a].menuText||this.config[a].header},beforeColMenuShow:function(){var e=this,b=e.cm,d=b.getColumnCount(),a=e.colMenu,c;a.removeAll();for(c=0;c<d;c++){if(b.config[c].hideable!==false){a.add(new Ext.menu.CheckItem({text:b.getColumnMenuText?b.getColumnMenuText(c):b.getColumnHeader(c),itemId:"col-"+b.getColumnId(c),checked:!b.isHidden(c),disabled:b.config[c].hideable===false,hideOnClick:false}))}}}});Ext.preg("menutextcolumnmodelplugin",SYNO.SDS.LogCenter.MenuTextColumnModelPlugin);SYNO.SDS.LogCenter.KeywordValidator=function(a){var b=true;if(a.match(/^ *(AND|OR|NOT|\( *\)) *$/)!==null||a.match(/(AND|OR|NOT) *$|^ *(AND|OR)/)!==null||a.match(/(AND|OR|NOT) *(AND|OR)/)!==null||a.match(/\([^)]*\(|\)[^(]*\)/)!==null||a.match(/\([^)]*$|^[^(]*\)/)!==null||a.match(/\( *(AND|OR|NOT) *\)/)!==null||a.match(/\(.*(AND|OR|NOT) *\)|\( *(AND|OR).*\)/)!==null||a.match(/\(.*(AND|OR|NOT) *(AND|OR).*\)/)!==null){b=SYNO.SDS.LogCenter.StringGet("common","error_opsearch")}return b};Ext.define("SYNO.SDS.LogCenter.Instance",{extend:"SYNO.SDS.AppInstance",appWindowName:"SYNO.SDS.LogCenter.MainWindow",constructor:function(){this.callParent(arguments)}});Ext.define("SYNO.SDS.LogCenter.PluginTipDlg",{extend:"SYNO.SDS.ModalWindow",constructor:function(a){this.callParent([this.fillConfig(a)])},fillConfig:function(a){var b={width:450,height:205,title:_TT("SYNO.SDS.LogCenter.Instance","app","advanced_tip_title"),closable:true,items:[{xtype:"syno_formpanel",itemId:"LogCenterPluginTip",items:[{xtype:"syno_displayfield",hideLabel:true,value:_TT("SYNO.SDS.LogCenter.Instance","app","plugin_desc")},{name:"noAutoLaunch",xtype:"syno_checkbox",checked:SYNO.SDS.UserSettings.getProperty("SYNO.SDS.LogCenter.Instance","nolaunch")||false,boxLabel:_TT("SYNO.SDS.LogCenter.Instance","app","no_tip_again")}]}],fbar:{toolbarCls:"x-panel-fbar x-statusbar",items:[{xtype:"syno_button",text:_T("common","ok"),btnStyle:"blue",handler:this.saveSettings,scope:this}]}};Ext.apply(b,a);return b},getSettingForm:function(){return this.getComponent("LogCenterPluginTip")},getNoLaunchField:function(){return this.getSettingForm().getForm().findField("noAutoLaunch")},saveSettings:function(){var a=this.getNoLaunchField().getValue();SYNO.SDS.UserSettings.setProperty("SYNO.SDS.LogCenter.Instance","nolaunch",a);this.close()}});Ext.define("SYNO.SDS.LogCenter.PluginLoader",{extend:"Ext.util.Observable",singleton:true,constructor:function(){var a=this;a.callParent(arguments);a.addEvents("load")},loadModule:function(a){try{var c=SYNO.SDS.Config.FnMap[a];if(!c){return false}SYNO.SDS.JSLoad(a,function(){this.fireEvent("load",this,a,c)},this)}catch(b){SYNO.Debug("Fail to add module"+b);return false}return true}});Ext.define("SYNO.SDS.LogCenter.MainWindow",{extend:"SYNO.SDS.PageListAppWindow",activePage:"SYNO.SDS.LogCenter.LogView",constructor:function(a){var b=Ext.apply({autoScroll:true,resizable:true,width:1005,height:580,minWidth:480,minHeight:360,cls:"syno-syslog",dsmStyle:"v5",listItems:[{text:_T("helptoc","logcenter_overview"),fn:"SYNO.SDS.LogCenter.LogView",iconCls:"icon-overview",help:"LogCenter/logcenter_overview.html"},{text:_T("helptoc","logcenter_browse"),fn:"SYNO.SDS.LogCenter.LogSearch",iconCls:"icon-search",help:"LogCenter/logcenter_search.html"},{text:_T("helptoc","logcenter_notification"),fn:"SYNO.SDS.LogCenter.NotifySetting",iconCls:"icon-log-notifications",disabled:"recovery_site"===_S("systemdr_role"),help:"LogCenter/logcenter_notification.html"}]},a);Ext.override(Ext.grid.GridView,{handleHdDown:function(j,g){if(Ext.fly(g).hasClass("x-grid3-hd-btn")){j.stopEvent();var h=this.findHeaderCell(g);Ext.fly(h).addClass("x-grid3-hd-menu-open");var f=this.getCellIndex(h);this.hdCtxIndex=f;var d=this.hmenu.items,c=this.cm;var k=c.isSortable(f);d.get("asc").setVisible(k);d.get("desc").setVisible(k);d.get("columns").previousSibling().setVisible(k);this.hmenu.on("hide",function(){Ext.fly(h).removeClass("x-grid3-hd-menu-open")},this,{single:true});this.hmenu.show(g,"tl-bl?")}}});this.pluginLoader=SYNO.SDS.LogCenter.PluginLoader;this.getPlugins();Ext.iterate(this.LogCenterPluginMap,function(d,c){b.listItems.push({text:c.text,fn:c.fn,iconCls:c.iconCls,help:c.help})});this.callParent([b]);this.mon(this.pluginLoader,"load",function(c,d,e){Ext.each(this.LogCenterPluginMap,function(h,f,g){if(h.fn===d){h.isLoaded=true;return false}},this)},this);this.mon(this,"show",this.triggerTipDlg,this,{single:true});this.mon(SYNO.SDS.StatusNotifier,"thirdpartychanged",this.onPkgChanged,this);this.mon(SYNO.SDS.StatusNotifier,"servicechanged",this.getPlugins,this);this.mon(SYNO.SDS.StatusNotifier,"appprivilegechanged",this.getPlugins,this);this.mon(SYNO.SDS.StatusNotifier,"jsconfigLoaded",this.getPlugins,this)},onPkgChanged:function(b,a){if('"LogCenter"'!=b){return}this.close()},getPlugins:function(){var d=this,g,b,c,e={},f,a;for(b in SYNO.SDS.Config.FnMap){if(SYNO.SDS.Config.FnMap.hasOwnProperty(b)){g=SYNO.SDS.Config.FnMap[b];c=g.config;f=null;if(!Ext.isObject(c)||!Ext.isObject(c.logcenter_mainwindow_extern)){continue}f=c.logcenter_mainwindow_extern;a={name:f.name,text:f.text,fn:f.fn,iconCls:f.iconCls,help:f.help,isLoaded:false,data:f};d.pluginLoader.loadModule(f.fn);e[f.name]=a}}d.LogCenterPluginMap=e},errMsgShow:function(a){var b="";if(a){b=_TT("SYNO.SDS.LogCenter.Instance",a.sec,a.key);if(undefined===b||""===b){b=_T(a.sec,a.key)}if(Ext.isNumber(a.line)){b=String.format("{0} ({1})",b,a.line)}}else{b=SYNO.SDS.LogCenter.StringGet("common","error_system")}this.getMsgBox().alert(_TT("SYNO.SDS.LogCenter.Instance","app","app_name"),b)},triggerTipDlg:function(){this.selectPage(this.getOpenConfig("fn"));if(!SYNO.SDS.LogCenter.Application&&true!==SYNO.SDS.UserSettings.getProperty("SYNO.SDS.LogCenter.Instance","nolaunch")){new SYNO.SDS.LogCenter.PluginTipDlg({owner:this}).show()}},onOpen:function(a){a.fn=(a.logType)?"SYNO.SDS.LogCenter.LogSearch":"SYNO.SDS.LogCenter.LogView";this.callParent([a]);if(a.logType){this.getActivePage().LogPanelLocal.forceSwitchPage(a.logType,a.protocol)}},onRequest:function(a){a.fn=(a.logType)?"SYNO.SDS.LogCenter.LogSearch":"SYNO.SDS.LogCenter.LogSearch";this.callParent([a]);if(a.logType){this.getActivePage().LogPanelLocal.forceSwitchPage(a.logType,a.protocol)}}});
/* Copyright (c) 2020 Synology Inc. All rights reserved. */

Ext.namespace("SYNO.SDS.StorageUtils");Ext.namespace("SYNO.SDS.StorageManager.StoragePool");SYNO.SDS.StorageManager.StoragePool.RaidLevelDesc={shr:{min:1,max:65536,raidGroup:false},shr_2:{min:4,max:65536,raidGroup:false},raid_1:{min:2,max:4,raidGroup:false},raid_5:{min:3,max:65536,raidGroup:true},"raid_5+spare":{min:4,max:65536,raidGroup:false},raid_6:{min:4,max:65536,raidGroup:true},raid_f1:{min:3,max:65536,raidGroup:true},raid_10:{min:4,max:65536,raidGroup:false},raid_0:{min:2,max:65536,raidGroup:false},basic:{min:1,max:1,raidGroup:false},raid_linear:{min:1,max:65536,raidGroup:false}};SYNO.SDS.StorageUtils=function(){var a=SYNO.SDS.Utils.StorageUtils.UiRenderHelper;return{ISCSITRG_UNIT_GB:SYNO.SDS.Utils.StorageUtils.ISCSITRG_UNIT_GB,SpaceIDParser:SYNO.SDS.Utils.StorageUtils.SpaceIDParser,GetSizeGB:SYNO.SDS.Utils.StorageUtils.GetSizeGB,SizeRenderWithFloor:a.SizeRenderWithFloor,GetSizeUnitWithFloor:a.GetSizeUnitWithFloor,SizeRender:a.SizeRender,GetSizeUnit:a.GetSizeUnit,StatusRender:a.StatusRender,LunStatusRender:a.LunStatusRender,StatusNameRender:a.StatusNameRender,ProgressRender:a.ProgressRender,WarningTextRender:a.WarningTextRender,StepNameRender:a.StepNameRender,PercentRender:a.PercentRender,RaidLevelRender:a.RaidLevelRender,SpaceTypeRender:a.SpaceTypeRender,DeviceTypeRender:a.DeviceTypeRender,ParseID:a.ParseID,DiskIDRender:a.DiskIDRender,DiskStatusRender:a.DiskStatusRender,DiskStatusTooltipRender:a.DiskStatusTooltipRender,DiskSwapStatusRender:a.DiskSwapStatusRender,smartStatusRender:a.smartStatusRender,DiskTypeRender:a.DiskTypeRender,AddDiskTypeRender:a.AddDiskTypeRender,MigrateTypeRender:a.MigrateTypeRender,TargetStatusRender:a.TargetStatusRender,SpareStatusRender:a.SpareStatusRender,SnapShotStatusRender:a.SnapShotStatusRender,getErrorMsg:a.getErrorMsg,decodeResponse:a.decodeResponse,htmlEncoder:a.htmlEncoder,htmlDecoder:a.htmlDecoder,getServiceNames:a.getServiceNames,getVolumeNames:a.getVolumeNames,getNamesString:a.getNamesString,disableServices:a.disableServices,DiskTemperatureRender:a.DiskTemperatureRender,DiskSummaryStatusRender:a.DiskSummaryStatusRender,SBTimeStringFormatRender:a.SBTimeStringFormatRender,SBTimeStringRender:a.SBTimeStringRender,RemainLifeRender:a.RemainLifeRender,BadSecCtRender:a.BadSecCtRender,advStatusRender:a.advStatusRender,smartTestStatusRender:a.smartTestStatusRender,textAnimate:a.textAnimate,setUpdateTimeAnimate:a.setUpdateTimeAnimate,WarningTitleStringGet:a.WarningTitleStringGet,DiskOverviewStatusRender:a.DiskOverviewStatusRender,DiskTestLogRender:a.DiskTestLogRender,DiskCompatibilityGet:a.DiskCompatibilityGet,DiskDisconnectStatusRender:a.DiskDisconnectStatusRender}}();SYNO.SDS.StorageUtils.TipTemplate=Ext.extend(Ext.XTemplate,{constructor:function(a){SYNO.SDS.StorageUtils.TipTemplate.superclass.constructor.call(this,"{[this.getText(values."+a+")]}")},getText:function(c){var a="";var b="";if(Ext.isObject(c)){if(Ext.isString(c.tip)){a=Ext.util.Format.htmlEncode(c.tip)}else{a=Ext.util.Format.htmlEncode(c.text)}if(Ext.isDefined(SYNO.SDS.StorageUtils.TipTemplate.TEXT_LENGTH)){b=Ext.util.Format.ellipsis(c.text,SYNO.SDS.StorageUtils.TipTemplate.TEXT_LENGTH)}else{b=c.text}return String.format('<span ext:qtip="{0}">{1}</span>',a,b)}else{return c}}});SYNO.SDS.StorageUtils.TipTemplate.TEXT_LENGTH=undefined;SYNO.SDS.StorageUtils.TipRenderer=function(b,a){a.attr='ext:qtip="'+Ext.util.Format.htmlEncode(Ext.util.Format.htmlEncode(b))+'"';return Ext.util.Format.htmlEncode(b)};SYNO.SDS.StorageUtils.check=function(){var a,b;for(a=0;a<arguments.length;a++){b=arguments[a];if(Ext.isFunction(b)&&!b.call(this)){return false}else{if(Ext.isString(b)&&!this[b]()){return false}}}return true};SYNO.SDS.StorageUtils.isAnyMatched=function(){var a=arguments;return -1!==this.findBy(function(b){return b.check.apply(b,a)})};SYNO.SDS.StorageUtils.getMatched=function(){var b=arguments;var a,d,c=[];for(a=0;a<this.getCount();a++){d=this.getAt(a);if(d.check.apply(d,b)){c.push(d)}}return c};SYNO.SDS.StorageUtils.FormatSuggestion=function(a){var c=_T("volume",a.str);var b=a.arg;if(typeof b=="undefined"||b===null){return c}else{return c.replace(/\{(\d+)\}/g,function(d,e){return b[e]})}};SYNO.SDS.StorageUtils.IsAnyMappedTargetConnected=function(d,a){var c=false;var b;Ext.each(a,function(e){if("connected"!==e.get("status")){return true}for(b=0;b<e.get("mapped_luns").length;b++){if(d.lid===e.get("mapped_luns")[b]){c=true;return false}}});return c};SYNO.SDS.StorageUtils.HARemoteCheckErrParsing=function(b){var a=[];var c=b.errors;if(!_S("ha_running")){return}if(undefined!==c.ha_remote_empty_err_disks&&0<c.ha_remote_empty_err_disks.size()){a.push(String.format(_TT("SYNO.SDS.HA.Instance","wizard","error_disk_empty"),c.ha_remote_empty_err_disks.map(SYNO.SDS.HA.HADiskIndexRenderer).join(", ")))}if(undefined!==c.ha_remote_smart_err_disks&&0<c.ha_remote_smart_err_disks.size()){a.push(String.format(_TT("SYNO.SDS.HA.Instance","wizard","error_disk_smart"),c.ha_remote_smart_err_disks.map(SYNO.SDS.HA.HADiskIndexRenderer).join(", "),c.ha_remote_hostname))}if(undefined!==c.ha_remote_size_err_disks&&0<c.ha_remote_size_err_disks.size()){a.push(String.format(_TT("SYNO.SDS.HA.Instance","wizard","error_disk_size"),c.ha_remote_size_err_disks.map(SYNO.SDS.HA.HADiskIndexRenderer).join(", ")))}if(undefined!==c.ha_remote_type_err_disks&&0<c.ha_remote_type_err_disks.size()){a.push(String.format(_TT("SYNO.SDS.HA.Instance","wizard","error_disk_type"),c.ha_remote_type_err_disks.map(SYNO.SDS.HA.HADiskIndexRenderer).join(", ")))}if(undefined!==c.ha_remote_log_sect_size_err_disks&&0<c.ha_remote_log_sect_size_err_disks.size()){a.push(String.format(_TT("SYNO.SDS.HA.Instance","wizard","error_disk_log_sect_size"),c.ha_remote_log_sect_size_err_disks.map(SYNO.SDS.HA.HADiskIndexRenderer).join(", ")))}if(true===c.ha_remote_offline){a.push(_TT("SYNO.SDS.HA.Instance","ui","error_passive_not_online"))}if(true===c.ha_remote_space_failed){a.push(_TT("SYNO.SDS.HA.Instance","wizard","error_passive_space_unmatched"))}if(true===c.ha_remote_memory_size_mismatch){a.push(_TT("SYNO.SDS.HA.Instance","ui","error_fcache_memsize"))}b.text=a.join("<br><br>");if(""===b.text){b.text=_T("error","error_error_system")}};SYNO.SDS.StorageUtils.isExistRunningvDSM=function(d,a){var c=false;var b;Ext.each(d,function(e){for(b=0;b<a.length;b++){if(e.get("id")===a[b]&&e.get("exist_alive_vdsm")){c=true;return false}}});return c};Ext.namespace("SYNO.SDS.StorageManager.ISCSI");SYNO.SDS.StorageManager.ISCSI.DefaultIQN="iqn.2000-01.com.synology:default.acl";SYNO.SDS.StorageManager.ISCSI.FAKE_PWD="1234567890AB";SYNO.SDS.StorageManager.ISCSI.FAKE_PWDC="BA0987654321";SYNO.SDS.StorageManager.ISCSI.Util=function(){return{SetActionLunParentStatus:function(b){var a=function(d,e){var c;Ext.each(d,function(f){if(e===f.iscsi_lun.lid){c=f;return false}});return c};Ext.each(b,function(d){var c;if("cloning"===d.status){c=a(b,d.iscsi_lun.parent.plid);if(Ext.isDefined(c)&&!c.is_actioning){c.status="using";c.is_actioning=true}}})},LunParentRender:function(d,a){var f,c,e,b;if(!Ext.isObject(a.parent)||a.lid===a.parent.plid){return false}f=d.getMatched(function(){if(this.get("iscsi_lun").lid===a.parent.plid){return true}});if(0===f.length){return false}c=f[0].get("iscsi_lun");e=c.name;if(0===a.parent.psid){return e}Ext.each(c.snapshots,function(g){if(a.parent.psid===g.sid){b=g.name;return false}});if(b){return e+" / "+b}else{return e}},SupportSnapshot:function(){if("yes"===_D("support_vaai","no")){return true}return false},genNewSnapShotName:function(c){var b="SnapShot-",a=b.length,d=0;Ext.each(c,function(e){var f=parseInt(e.name.slice(a),10);if(d<f){d=f}});d=d+1;return b+d},isUpToiSCSISnapShotActionCount:function(c){var a=SYNO.SDS.StorageManager.Limits.MAX_SNAPSHOT_ACTIONING_COUNT,b,d=0;Ext.each(c,function(e){b=e.get("status");if(!e.get("iscsi_lun").extent_based){return true}if("cloning"===b||"restoring"===b){d=d+1}else{Ext.each(e.get("iscsi_lun").snapshots,function(f){if("creating"===f.status.type){d=d+1}})}});return d>=a},renderPermission:function(b){var a={rw:_T("share","share_permission_writable"),r:_T("share","share_permission_readonly"),"-":_T("share","share_permission_none")};if(b in a){return a[b]}else{return b}},renderIQN:function(c,b){var a=(SYNO.SDS.StorageManager.ISCSI.DefaultIQN===c)?_T("iscsitrg","iscsitrg_masking_default"):c;if(b){b.attr='ext:qtip="'+Ext.util.Format.htmlEncode(a)+'"'}return a}}}();SYNO.SDS.StorageUtils.CheckFailedMsg=function(b){var d,a,c="pass";if(!b){return c}for(d in b){if(b.hasOwnProperty(d)){if("hard_failed"===c){break}for(a in b[d]){if(b[d].hasOwnProperty(a)){if(b[d][a].hard){c="hard_failed";break}else{if(b[d][a].soft){c="soft_failed"}}}}}}return c};SYNO.SDS.StorageUtils.UpdateGridCheckMsg=function(b,d,a){var c,e;for(c=0;c<d.length;++c){e=SYNO.SDS.Utils.GetFeasibilityCheckMsg(d[c]);if(0===c){a.appendSub(b,e)}else{a.appendSub("",e)}}};SYNO.SDS.StorageUtils.CheckMsg=function(b,g,e,c){var f,a=SYNO.SDS.StorageUtils,d;if(!b||!b[e]){return}for(f in b[e]){if(b[e].hasOwnProperty(f)){if("volumes"===e){d=SYNO.SDS.Utils.StorageUtils.VolumeNameRenderer(f)}else{if("pools"===e){d=SYNO.SDS.Utils.StorageUtils.SpaceIDParser(f).str}else{d=f}}if(g){if(b[e][f].hard){a.UpdateGridCheckMsg(d,b[e][f].hard,c)}}else{if(b[e][f].soft){a.UpdateGridCheckMsg(d,b[e][f].soft,c)}}}}};SYNO.SDS.StorageUtils.ReportWebapiFailure=function(b,e,g){var d,a;var c=b.getMsgBox?b:b.owner;var f=c.getMsgBox;if(undefined===e||undefined===b){return}if(undefined===f){throw Error("Does not found 'getMsgBox'")}if("string"===typeof e.text){d=e.text}else{d=e.errors?this.getErrorMsg(e.errors):_T("error","error_subject")}a=[].slice.call(arguments,SYNO.SDS.StorageUtils.ReportWebapiFailure.length);f.call(c).alert(b.title,d,function(){if(g){g.apply(b,a)}})};SYNO.SDS.StorageUtils.DiskSort=function(l,k){var j=l.numId;var h=k.numId;var e=l.ctnOrder;var c=k.ctnOrder;var i=("cache"===l.portType)?2:1;var g=("cache"===k.portType)?2:1;var f=l.pciSlot;var d=k.pciSlot;if(e>c){return 1}if(e<c){return -1}if(i>g){return 1}if(i<g){return -1}if(f>d){return 1}if(f<d){return -1}if(j>h){return 1}if(j<h){return -1}return 0};SYNO.SDS.StorageUtils.IsFeasibilityFail=function(a,b){if(a.errors&&a.errors.feasibility){b.soft=a.errors.feasibility.soft||[];b.hard=a.errors.feasibility.hard||[];if(b.soft.length>0||b.hard.length>0){return true}}return false};SYNO.SDS.StorageUtils.ConfirmFeasibilityFail=function(i,f,h){var j,e,c;var b=[];var g="{0}</br></br>{1}";var d;var a;if(!i){throw Error("No scope")}if(i.getMsgBox){d=i.getMsgBox;a=i}else{if(i.owner&&i.owner.getMsgBox){d=i.owner.getMsgBox;a=i.owner}else{throw Error("Does not found 'getMsgBox'")}}if(0<f.hard.length){f.hard.forEach(function(k){c=SYNO.SDS.Utils.GetFeasibilityCheckMsg(k);b.push(c)});j=String.format(g,_T("volume","hard_check_fail"),b.join("</br>"));d.call(a).alert(i.title,j)}else{if(0<f.soft.length){f.soft.forEach(function(k){c=SYNO.SDS.Utils.GetFeasibilityCheckMsg(JSON.parse(k).task_i18n);b.push(c)});j=String.format(g,_T("volume","soft_check_fail"),b.join("</br>"));e=[].slice.call(arguments,SYNO.SDS.StorageUtils.ConfirmFeasibilityFail.length);d.call(a).confirm(i.title,j,function(k){if("yes"==k){h.apply(this,e)}},i)}}};SYNO.SDS.StorageUtils.IsBlockedInSDR=function(a){var b="{0}</br></br>{1}";var c="";if("test"===_S("systemdr_role")){c=String.format(b,_T("volume","hard_check_fail"),_TT("SYNO.SDS.SystemDR.Instance","feasibility","sdr_in_test"))}else{if("main_site"===_S("systemdr_role")&&("kvmx64"===_D("synobios")||"nextkvmx64"===_D("synobios"))){c=String.format(b,_T("volume","hard_check_fail"),_TT("SYNO.SDS.SystemDR.Instance","feasibility","sdr_in_vdsm"))}}if(""!==c){a.getMsgBox().alert(_TT("SYNO.SDS.SystemDR.Instance","uicommon","name"),c);return true}return false};SYNO.SDS.StorageUtils.DiskDisplayNameGet=function(b){var d=0;var a=_D("upnpmodelname");var c;c=b.get("pciSlot");if(!b.isCacheTray()&&-1===c){return SYNO.SDS.Utils.StorageUtils.UiRenderHelper.DiskNameRenderer(b.get("name"),b.isInSystemSlot())}if(b.isCacheTray()){switch(a.toLowerCase()){case"rs3413xs+":case"rs10613xs+":d=10;return String.format("{0} {1}",_T("volume","dedicated_ssd_cache"),b.get("num_id")-d);default:break}if(0===c){return String.format("{0} {1}",_T("volume","dedicated_ssd_cache"),b.get("num_id"))}return String.format("{0} {1}-{2}",_T("volume","dedicated_ssd_cache"),c,b.get("num_id"))}else{if(0===c){return String.format("{0} {1}",_T("volume","expansion_disk"),b.get("num_id"))}return String.format("{0} {1}-{2}",_T("volume","expansion_disk"),c,b.get("num_id"))}};SYNO.SDS.StorageUtils.DiskNameHashValueGet=function(b,d,a){var c=("cache"===a)?2:1;return b*1000+c*100+d};SYNO.SDS.StorageUtils.DisableButtonsBySDR=function(a,b){a.forEach(function(c){c.disable();c.setTooltip(b)})};SYNO.SDS.StorageUtils.ReplaceWebapiSHA=function(c,a){if(c){var b={remote_api:a.api,remote_method:a.method,remote_version:a.version,remote_params:a.params,remote_download:false};a.api="SYNO.SHA.Util";a.method="send_remote_webapi";a.version=1;a.params=b}return a};SYNO.SDS.StorageUtils.ReplaceWebapiSHADownload=function(c,a){if(c){var b={remote_api:a.api,remote_method:a.method,remote_version:a.version,remote_params:a.params,remote_download:true};a.api="SYNO.SHA.Util";a.method="send_remote_webapi";a.version=1;a.params=b}return a};SYNO.SDS.StorageUtils.RAIDDiskMinMaxCountGet=function(e,b){var d=SYNO.SDS.StorageManager.StoragePool.RaidLevelDesc[e];var a,c;a=d.max;c=d.min;if(b===parseInt(b,10)){a=Math.min(a,b)}if("yes"===_D("supportraidgroup","no")){if(e==="raid_linear"){c=2}}return{max:a,min:c,raidGroup:d.raidGroup}};SYNO.SDS.StorageUtils.GetEboxBayNumber=function(c){var d,b,a;d=c.split("-");if(2!=d.length||3>d[0].length){return 0}b=d[0].match(/\d+/);if(!b||0===b.length){return 0}a=parseInt(b[0].substr(0,b[0].length-2),10);if(isNaN(a)){return 0}return a};SYNO.SDS.StorageUtils.IsDiskCompatible=function(a){if("support"===a||"disabled"===a){return true}return false};SYNO.SDS.StorageUtils.IsPoolContainAbnormalDisks=function(a){if(true===SYNO.SDS.StorageUtils.IsDiskCompatible(a.get("compatibility"))&&true===SYNO.SDS.StorageUtils.IsDiskCompatible(a.get("remote_info").compatibility)&&0===a.get("unc")&&0===a.get("remote_info").unc){return false}return true};SYNO.SDS.StorageUtils.AlertBadsectorBit=(1<<0);SYNO.SDS.StorageUtils.AlertIncompatibleBit=(1<<1);SYNO.SDS.StorageUtils.AlertUnverifiedBit=(1<<2);SYNO.SDS.StorageUtils.ShowDiskWarningBox=function(c,b,C,p){var s=SYNO.SDS.StorageUtils.AlertBadsectorBit;var q=SYNO.SDS.StorageUtils.AlertIncompatibleBit;var k=SYNO.SDS.StorageUtils.AlertUnverifiedBit;var w=null;var f="";var l="";var e=0;var a="";var o="";var r="";var d=[];var t=[];var i=[];var D=[];var u=[];var x=[];var m="";var v="";var n=0;var h=0;var g="";var z="";C=Ext.isArray(C)?C:[C];C.forEach(function(F){var E=false;var G=false;if(0<F.get("unc")){d.push(F.get("name"));e|=s;E=true}if(0<F.get("remote_info").unc){D.push(F.get("name"));e|=s;G=true}a=F.get("compatibility");if(true===SYNO.SDS.StorageUtils.IsDiskCompatible(a)){}else{if("not_support"===a){t.push(F.get("name"));e|=q;r=(0===r.length)?F.get("container").str:r;E=true}else{i.push(F.get("name"));e|=k;r=(0===r.length)?F.get("container").str:r;E=true}}o=F.get("remote_info").compatibility;if(true===SYNO.SDS.StorageUtils.IsDiskCompatible(o)){}else{if("not_support"===o){u.push(F.get("name"));e|=q;r=(0===r.length)?F.get("container").str:r;G=true}else{x.push(F.get("name"));e|=k;r=(0===r.length)?F.get("container").str:r;G=true}}if(true===E){n+=1}if(true===G){h+=1}});r=r.replace(/((DX|RX)[\w]+)(-[\d]+$)/,"$1");switch(e){case 0:return;case s:l=_T("disk_info","disk_alert_suggest_badsector");break;case q:l=String.format(_T("disk_info","disk_alert_suggest_incompatibility"),encodeURIComponent(r));break;case k:l=String.format(_T("disk_info","disk_alert_suggest_unverified"),encodeURIComponent(r));break;case (s|q):l=String.format(_T("disk_info","disk_alert_suggest_badsector_incompatibility"),encodeURIComponent(r));break;case (s|k):l=String.format(_T("disk_info","disk_alert_suggest_badsector_unverified"),encodeURIComponent(r));break;case (q|k):l=String.format(_T("disk_info","disk_alert_suggest_incompatibility_unverified"),encodeURIComponent(r));break;case (s|q|k):l=String.format(_T("disk_info","disk_alert_suggest_badsector_incompatibility_unverified"),encodeURIComponent(r));break;default:SYNO.Debug("Invalid disk alert type",e);return}if(_S("ha_running")&&n>0){g+=_TT("SYNO.SDS.HA.Instance","ui","active_server");g+=_T("common","colon")}if(0<t.length){m+=String.format('<li type="square"><span class="sm-disk-alert-item-title">{0}</span> {1}</li>',_T("disk_info","disk_alert_status_incompatibility"),t.join(", "))}if(0<i.length){m+=String.format('<li type="square"><span class="sm-disk-alert-item-title">{0}</span> {1}</li>',_T("disk_info","disk_alert_status_unverified"),i.join(", "))}if(1<d.length){m+=String.format('<li type="square"><span class="sm-disk-alert-item-title">{0}</span> {1}</li>',_T("disk_info","disk_alert_status_badsector"),d.join(", "))}else{if(1===d.length){m+=String.format('<li type="square"><span class="sm-disk-alert-item-title">{0}</span> {1}</li>',_T("disk_info","disk_alert_status_badsector_singular"),d.join(", "))}}if(_S("ha_running")&&h>0){z+=_TT("SYNO.SDS.HA.Instance","ui","passive_server");z+=_T("common","colon")}if(0<u.length){v+=String.format('<li type="square"><span class="sm-disk-alert-item-title">{0}</span> {1}</li>',_T("disk_info","disk_alert_status_incompatibility"),u.join(", "))}if(0<x.length){v+=String.format('<li type="square"><span class="sm-disk-alert-item-title">{0}</span> {1}</li>',_T("disk_info","disk_alert_status_unverified"),x.join(", "))}if(1<D.length){v+=String.format('<li type="square"><span class="sm-disk-alert-item-title">{0}</span> {1}</li>',_T("disk_info","disk_alert_status_badsector"),D.join(", "))}else{if(1===D.length){v+=String.format('<li type="square"><span class="sm-disk-alert-item-title">{0}</span> {1}</li>',_T("disk_info","disk_alert_status_badsector_singular"),D.join(", "))}}m=String.format("<div style='margin-left: 30px;'><ul>{0}</ul></div>",m);v=String.format("<div style='margin-left: 30px;'><ul>{0}</ul></div>",v);if(_S("ha_running")){m=String.format("<br>{0}{1}{2}{3}",g,m,z,v)}if(1<n+h){f=String.format(_T("disk_info","disk_alert_selected_disks"),m,l)}else{f=String.format(_T("disk_info","disk_alert_selected_disk"),m,l)}var y={yes:{text:_T("common","continue"),btnStyle:"red"},no:{text:Ext.MessageBox.buttonText.cancel}};var j=function(){if(!w||w.isDestroyed){w=new SYNO.SDS.MessageBoxV5({owner:b})}return w.getWrapper()};var B=function(E){if("no"===E){p()}return};var A=j();A.show({title:"",msg:f,fn:B,scope:c,buttons:y,icon:Ext.MessageBox.QUESTION,minWidth:720,maxWidth:720})};SYNO.SDS.StorageUtils.HclTipOnGridRender=function(d){var b=d.getStore();var a=d.getView();d.tip=new Ext.ToolTip({target:a.mainBody,delegate:a.rowSelector,trackMouse:true,renderTo:document.body,listeners:{beforeshow:function c(e){var g=a.findRowIndex(e.triggerElement);var f=SYNO.SDS.StorageUtils.DiskCompatibilityGet("tooltip",b.getAt(g).get("compatibility"));if(!Ext.isEmpty(f)){e.body.dom.innerHTML=f}else{return false}}}})};SYNO.SDS.StorageUtils.DataViewToolTipsAdd=function(c){var a=c?c.getEl():null;var b=a?a.query(".sm-tip-placeholder"):[];Ext.each(b,function(e){var f=SYNO.SDS.Utils.AddTip(e,e.getAttribute("tip"));for(var d=0;d<f.childNodes.length;d++){f.childNodes[d].style="vertical-align: middle; position: relative;"}})};SYNO.SDS.StorageUtils.SpaceRepairCheck=function(a,c,f){var e=[],b=[],d="";a.forEach(function(g){if("crashed"===g.get("status")){return true}if("normal"!==g.get("overview_status")){b.push(g.get("name"))}else{if(0<g.get("unc")){e.push(g.get("name"))}}});if(0<b.length&&0<e.length){d=String.format(_T("volume","space_repair_unc_abnormal"),b.join(", "),e.join(", "))}else{if(0<b.length){d=String.format(_T("volume","space_repair_abnormal"),b.join(", "))}else{if(0<e.length){d=String.format(_T("volume","space_repair_unc"),e.join(", "))}}}if(0===d.length){f()}else{c.owner.getMsgBox().confirm("",d,function(g){if("yes"===g){f()}},c)}};SYNO.SDS.StorageUtils.ControllerToString=function(a){if(!Ext.isNumber(a)||a<0){return""}return String.fromCharCode(("A".charCodeAt(0))+a)};SYNO.SDS.StorageUtils.ControllerRenderer=function(b,a){var c=SYNO.SDS.StorageUtils.ControllerToString(b);if(!c){return"-"}a=a||_T("volume","controller_i");return String.format(a,c)};SYNO.SDS.StorageUtils.IsOnlySupportSas=function(){if("yes"===_D("support_dual_head","no")||"yes"===_D("support_xa","no")){return true}else{return false}};